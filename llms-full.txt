=== PIXONUI CORE CONTEXT ===

# PixonUI - AI Context & Guidelines

This document provides a comprehensive overview of PixonUI for LLMs. Use this context to generate accurate, high-performance, and idiomatic code using the PixonUI library.

## 1. Core Philosophy: Native-First
PixonUI is built to be lightweight, stable, and performant by leveraging native browser APIs instead of heavy third-party libraries.

- **No Radix/Headless UI**: We build our own logic for accessibility and behavior.
- **Native Overlays**: We use the HTML5 `<dialog>` tag for Modals/Dialogs.
- **Native Validation**: We use the `ValidityState` API for forms.
- **Native Motion**: We use CSS Transitions, WAAPI, and View Transitions API.
- **Performance**: We use `content-visibility: auto` for large data displays like Tables.

## 2. Design System (Tailwind CSS)
- **Theme**: Dark mode by default.
- **Glassmorphism**: Use `bg-white/[0.03]`, `backdrop-blur`, and `border-white/10`.
- **Shapes**: Standard radius is `rounded-2xl`.
- **Animations**: Use `transition-all duration-200` and `animate-in` from `tailwindcss-animate`.

## 3. Key Components & Usage

### Layout
- `Surface`: The base container. `<Surface className="p-6">...</Surface>`
- `Card`: Glassmorphic card. Supports `glow` prop for mouse-follow effect.
- `Kanban`: Board with native DnD. Uses `columns` and `tasks` props.

### Overlays (Native-First)
- `Dialog`: Uses `<dialog>`. Props: `isOpen`, `onClose`.
- `DropdownMenu`: Positioned via `useFloating`.
- `Popover`: Lightweight overlay for settings/info.
- `Tooltip`: Portal-based, high-performance tooltips.

### Motion
- `Reveal`: Mask-based entry animation. `<Reveal direction="up">...</Reveal>`
- `Magnetic`: Cursor attraction. `<Magnetic strength={0.5}><Button>...</Button></Magnetic>`
- `NumberTicker`: Animated counter. `<NumberTicker value={100} />`
- `ScrollProgress`: Page reading indicator.

## 4. Native Hooks
- `useFloating(triggerRef, contentRef, options)`: For custom overlays.
- `useForm({ initialValues, onSubmit })`: Returns `register`, `handleSubmit`, `errors`.
- `useScroll()`: Returns `scrollProgressY` (0 to 1).
- `useResponsive()`: Includes `useBreakpoint` and `useContainerQuery`.
- `useIntersection(ref)`: For lazy-loading and scroll animations.

## 5. Implementation Rules for AI
1. **Always use `cn()`** for merging Tailwind classes.
2. **Prefer `fixed` positioning** for portals (Dropdowns, Tooltips).
3. **Use `asChild` pattern** (via Radix Slot if available, or custom implementation) when nesting interactive elements.
4. **Strict TypeScript**: Never use `any`. Define interfaces for all props.
5. **Accessibility**: Always include `aria-*` attributes and ensure keyboard navigation works (native in `<dialog>`).

## 6. Example: Modern Form with Native Validation
```tsx
import { useForm, TextInput, Button, Surface } from '@pixonui/react';

export function ContactForm() {
  const { register, handleSubmit, errors } = useForm({
    initialValues: { email: '', message: '' },
    onSubmit: (values) => console.log(values),
  });

  return (
    <Surface className="p-6 max-w-md">
      <form onSubmit={handleSubmit} className="space-y-4">
        <TextInput 
          label="Email"
          required
          type="email"
          {...register('email')}
        />
        <TextInput 
          label="Message"
          required
          minLength={10}
          {...register('message')}
        />
        <Button type="submit" variant="primary">Send</Button>
      </form>
    </Surface>
  );
}
```




=== FILE: packages\ui\src\components\ai\AIPromptInput.tsx ===

import React, { useState, useRef, useEffect } from 'react';
import { cva, type VariantProps } from 'class-variance-authority';
import { cn } from '../../utils/cn';
import { Sparkles, Paperclip, ArrowUp, Square, Mic, X, File } from 'lucide-react';
import { Button } from '../button/Button';

const aiPromptInputVariants = cva(
  "relative flex w-full flex-col rounded-3xl border transition-all duration-200 focus-within:ring-4",
  {
    variants: {
      variant: {
        default: "bg-white border-gray-200 shadow-sm focus-within:border-purple-500/50 focus-within:ring-purple-500/10 dark:bg-white/[0.03] dark:border-white/10 dark:shadow-none",
        ghost: "bg-transparent border-transparent shadow-none focus-within:bg-white/50 dark:focus-within:bg-white/5",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
);

export interface Attachment {
  id: string;
  name: string;
  type?: string;
  url?: string;
}

export interface AIPromptInputProps 
  extends Omit<React.TextareaHTMLAttributes<HTMLTextAreaElement>, 'onSubmit'>,
    VariantProps<typeof aiPromptInputVariants> {
  /** Callback fired when the user submits the prompt (Enter or Click) */
  onSubmit?: (value: string) => void;
  /** Whether the AI is currently generating a response */
  isGenerating?: boolean;
  /** Callback fired when the attach button is clicked. If onFilesSelected is provided, this is ignored. */
  onAttach?: () => void;
  /** Callback fired when files are selected via the built-in file picker */
  onFilesSelected?: (files: FileList) => void;
  /** Callback fired when the stop button is clicked */
  onStop?: () => void;
  /** Callback fired when the microphone button is clicked */
  onMic?: () => void;
  /** Maximum number of characters allowed */
  maxLength?: number;
  /** Custom footer content to render below the input */
  footer?: React.ReactNode;
  /** List of attached files to display */
  attachments?: Attachment[];
  /** Callback fired when an attachment is removed */
  onRemoveAttachment?: (attachmentId: string) => void;
  /** Accepted file types for the built-in file picker */
  accept?: string;
  /** Whether to allow multiple files in the built-in file picker */
  multiple?: boolean;
}

/**
 * A specialized input component for AI prompts with support for attachments, 
 * voice input, and generation control.
 */
export const AIPromptInput = React.forwardRef<HTMLTextAreaElement, AIPromptInputProps>(
  ({ 
    className, 
    variant,
    onSubmit, 
    isGenerating, 
    onAttach, 
    onFilesSelected,
    onStop,
    onMic,
    maxLength,
    footer,
    attachments,
    onRemoveAttachment,
    accept,
    multiple,
    placeholder = "Ask AI anything...", 
    value: controlledValue,
    onChange,
    ...props 
  }, ref) => {
    const [internalValue, setInternalValue] = useState('');
    const isControlled = controlledValue !== undefined;
    const value = isControlled ? (controlledValue as string) : internalValue;
    
    const textareaRef = useRef<HTMLTextAreaElement | null>(null);
    const fileInputRef = useRef<HTMLInputElement | null>(null);

    const adjustHeight = () => {
      if (textareaRef.current) {
        textareaRef.current.style.height = 'auto';
        textareaRef.current.style.height = `${textareaRef.current.scrollHeight}px`;
      }
    };

    useEffect(() => {
      adjustHeight();
    }, [value]);

    const handleInput = (e: React.ChangeEvent<HTMLTextAreaElement>) => {
      const newValue = e.target.value;
      if (maxLength && newValue.length > maxLength) return;
      
      if (!isControlled) {
        setInternalValue(newValue);
      }
      onChange?.(e);
    };

    const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        if (value.trim() && !isGenerating) {
          onSubmit?.(value);
          if (!isControlled) setInternalValue('');
        }
      }
      props.onKeyDown?.(e);
    };

    const handleSubmit = () => {
      if (isGenerating && onStop) {
        onStop();
      } else if (value.trim()) {
        onSubmit?.(value);
        if (!isControlled) setInternalValue('');
      }
    };

    const handleAttachClick = () => {
      if (onFilesSelected && fileInputRef.current) {
        fileInputRef.current.click();
      } else {
        onAttach?.();
      }
    };

    const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {
      if (e.target.files && e.target.files.length > 0) {
        onFilesSelected?.(e.target.files);
      }
      // Reset value to allow selecting the same file again
      if (fileInputRef.current) {
        fileInputRef.current.value = '';
      }
    };

    return (
      <div className={cn(aiPromptInputVariants({ variant, className }))}>
        {/* Hidden File Input */}
        <input
          type="file"
          ref={fileInputRef}
          className="hidden"
          onChange={handleFileChange}
          accept={accept}
          multiple={multiple}
        />

        {/* Attachments Area */}
        {attachments && attachments.length > 0 && (
          <div className="flex flex-wrap gap-2 px-4 pt-4">
            {attachments.map((att) => (
              <div 
                key={att.id} 
                className="group relative flex items-center gap-2 rounded-lg border border-gray-200 bg-gray-50 px-3 py-1.5 text-sm transition-colors hover:bg-gray-100 dark:border-white/10 dark:bg-white/5 dark:hover:bg-white/10"
              >
                <div className="flex h-5 w-5 items-center justify-center rounded bg-white dark:bg-white/10">
                  <File className="h-3 w-3 text-purple-500" />
                </div>
                <span className="max-w-[120px] truncate text-gray-700 dark:text-gray-300">
                  {att.name}
                </span>
                <button 
                  onClick={() => onRemoveAttachment?.(att.id)}
                  className="ml-1 rounded-full p-0.5 text-gray-400 opacity-0 transition-all hover:bg-gray-200 hover:text-gray-600 group-hover:opacity-100 dark:hover:bg-white/20 dark:hover:text-white"
                  type="button"
                >
                  <X className="h-3 w-3" />
                </button>
              </div>
            ))}
          </div>
        )}

        <textarea
          ref={(node) => {
            textareaRef.current = node;
            if (typeof ref === 'function') ref(node);
            else if (ref) (ref as React.MutableRefObject<HTMLTextAreaElement | null>).current = node;
          }}
          value={value}
          onChange={handleInput}
          onKeyDown={handleKeyDown}
          placeholder={placeholder}
          rows={1}
          className={cn(
            "w-full resize-none bg-transparent px-4 py-4 text-base outline-none max-h-[200px]",
            "text-gray-900 placeholder:text-gray-400",
            "dark:text-white dark:placeholder:text-white/40"
          )}
          disabled={isGenerating && !onStop}
          {...props}
        />
        
        <div className="flex items-center justify-between px-2 pb-2">
          <div className="flex items-center gap-1">
            <Button 
              variant="ghost" 
              size="icon" 
              className="text-gray-400 hover:text-gray-600 dark:text-white/40 dark:hover:text-white"
              onClick={handleAttachClick}
              type="button"
              title="Attach file"
            >
              <Paperclip className="h-5 w-5" />
            </Button>
            
            {onMic && (
              <Button 
                variant="ghost" 
                size="icon" 
                className="text-gray-400 hover:text-gray-600 dark:text-white/40 dark:hover:text-white"
                onClick={onMic}
                type="button"
                title="Use microphone"
              >
                <Mic className="h-5 w-5" />
              </Button>
            )}
          </div>

          <div className="flex items-center gap-3">
            {maxLength && (
              <span className="text-xs text-gray-400 dark:text-white/30">
                {value.length}/{maxLength}
              </span>
            )}

            <Button
              size="icon"
              disabled={(!value.trim() && !isGenerating) || (isGenerating && !onStop)}
              onClick={handleSubmit}
              className={cn(
                "h-8 w-8 rounded-full transition-all duration-200",
                (value.trim() || isGenerating)
                  ? "bg-purple-600 text-white hover:bg-purple-500 shadow-lg shadow-purple-500/25" 
                  : "bg-gray-100 text-gray-400 dark:bg-white/10 dark:text-white/20"
              )}
            >
              {isGenerating ? (
                onStop ? (
                  <Square className="h-3 w-3 fill-current" />
                ) : (
                  <Sparkles className="h-4 w-4 animate-pulse" />
                )
              ) : (
                <ArrowUp className="h-4 w-4" />
              )}
            </Button>
          </div>
        </div>
        
        {footer && (
          <div className="border-t border-gray-100 px-4 py-2 text-xs text-gray-400 dark:border-white/5 dark:text-white/30">
            {footer}
          </div>
        )}
      </div>
    );
  }
);

AIPromptInput.displayName = 'AIPromptInput';



=== FILE: packages\ui\src\components\ai\AIResponse.tsx ===

import React from 'react';
import { cva, type VariantProps } from 'class-variance-authority';
import { cn } from '../../utils/cn';
import { Copy, RefreshCw, ThumbsUp, ThumbsDown, Sparkles, Share, Edit, ExternalLink } from 'lucide-react';
import { Button } from '../button/Button';

const aiResponseVariants = cva(
  "group relative overflow-hidden rounded-2xl border transition-all duration-200",
  {
    variants: {
      variant: {
        default: "bg-gray-50 border-gray-200 dark:bg-white/[0.02] dark:border-white/10",
        ghost: "bg-transparent border-transparent",
        outline: "bg-transparent border-gray-200 dark:border-white/10",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
);

export interface AIResponseSource {
  title: string;
  url: string;
}

export interface AIResponseProps 
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof aiResponseVariants> {
  /** The content of the response */
  children: React.ReactNode;
  /** Callback fired when the copy button is clicked */
  onCopy?: () => void;
  /** Callback fired when the regenerate button is clicked */
  onRegenerate?: () => void;
  /** Callback fired when feedback buttons are clicked */
  onFeedback?: (type: 'up' | 'down') => void;
  /** Callback fired when the share button is clicked */
  onShare?: () => void;
  /** Callback fired when the edit button is clicked */
  onEdit?: () => void;
  /** Timestamp string to display (e.g., "Just now", "2 mins ago") */
  timestamp?: string;
  /** List of sources/citations to display */
  sources?: AIResponseSource[];
  /** Name of the model used (e.g., "GPT-4") */
  model?: string;
  /** Usage information (e.g., "245 tokens") */
  usage?: string | number;
}

/**
 * A container component for displaying AI-generated responses with 
 * built-in actions for copying, regenerating, and providing feedback.
 */
export const AIResponse = React.forwardRef<HTMLDivElement, AIResponseProps>(
  ({ 
    className, 
    variant,
    children, 
    onCopy, 
    onRegenerate, 
    onFeedback, 
    onShare, 
    onEdit,
    timestamp,
    sources,
    model,
    usage,
    ...props 
  }, ref) => {
    return (
      <div 
        ref={ref}
        className={cn(aiResponseVariants({ variant, className }))}
        {...props}
      >
        {/* Header / Icon */}
        <div className="absolute left-4 top-4 flex items-center gap-3">
          <div className="flex h-6 w-6 items-center justify-center rounded-full bg-gradient-to-br from-purple-500 to-blue-500 shadow-lg shadow-purple-500/20">
            <Sparkles className="h-3.5 w-3.5 text-white" />
          </div>
          {timestamp && (
            <span className="text-xs font-medium text-gray-400 dark:text-white/30">
              {timestamp}
            </span>
          )}
        </div>

        {/* Content */}
        <div className="pl-14 pr-4 py-4">
          <div className="prose prose-sm dark:prose-invert max-w-none text-gray-700 dark:text-gray-300">
            {children}
          </div>

          {/* Sources */}
          {sources && sources.length > 0 && (
            <div className="mt-4 flex flex-wrap gap-2">
              {sources.map((source, index) => (
                <a
                  key={index}
                  href={source.url}
                  target="_blank"
                  rel="noopener noreferrer"
                  className={cn(
                    "flex items-center gap-1.5 rounded-full border px-3 py-1 text-xs transition-colors",
                    "border-gray-200 bg-white text-gray-600 hover:bg-gray-50",
                    "dark:border-white/10 dark:bg-white/5 dark:text-white/60 dark:hover:bg-white/10"
                  )}
                >
                  <span className="max-w-[150px] truncate">{source.title}</span>
                  <ExternalLink className="h-3 w-3 opacity-50" />
                </a>
              ))}
            </div>
          )}
        </div>

        {/* Actions Footer */}
        <div className="flex items-center justify-between border-t border-gray-200 bg-white/50 px-2 py-1.5 backdrop-blur dark:border-white/5 dark:bg-white/[0.02]">
          
          {/* Meta Info (Model/Usage) */}
          <div className="flex items-center gap-3 px-2 text-[10px] font-medium text-gray-400 dark:text-white/20">
            {model && <span>{model}</span>}
            {usage && <span>{usage}</span>}
          </div>

          {/* Action Buttons */}
          <div className="flex items-center gap-1">
            <Button 
              variant="ghost" 
              size="sm" 
              className="h-7 px-2 text-xs text-gray-500 hover:text-gray-900 dark:text-white/40 dark:hover:text-white"
              onClick={onCopy}
            >
              <Copy className="mr-1.5 h-3.5 w-3.5" />
              Copy
            </Button>

            {onShare && (
              <Button 
                variant="ghost" 
                size="icon" 
                className="h-7 w-7 text-gray-500 hover:text-gray-900 dark:text-white/40 dark:hover:text-white"
                onClick={onShare}
                title="Share"
              >
                <Share className="h-3.5 w-3.5" />
              </Button>
            )}

            {onEdit && (
              <Button 
                variant="ghost" 
                size="icon" 
                className="h-7 w-7 text-gray-500 hover:text-gray-900 dark:text-white/40 dark:hover:text-white"
                onClick={onEdit}
                title="Edit"
              >
                <Edit className="h-3.5 w-3.5" />
              </Button>
            )}
            
            <div className="mx-1 h-3 w-px bg-gray-200 dark:bg-white/10" />
            
            <Button 
              variant="ghost" 
              size="icon" 
              className="h-7 w-7 text-gray-500 hover:text-gray-900 dark:text-white/40 dark:hover:text-white"
              onClick={onRegenerate}
              title="Regenerate"
            >
              <RefreshCw className="h-3.5 w-3.5" />
            </Button>
            
            <Button 
              variant="ghost" 
              size="icon" 
              className="h-7 w-7 text-gray-500 hover:text-gray-900 dark:text-white/40 dark:hover:text-white"
              onClick={() => onFeedback?.('up')}
              title="Helpful"
            >
              <ThumbsUp className="h-3.5 w-3.5" />
            </Button>
            
            <Button 
              variant="ghost" 
              size="icon" 
              className="h-7 w-7 text-gray-500 hover:text-gray-900 dark:text-white/40 dark:hover:text-white"
              onClick={() => onFeedback?.('down')}
              title="Not helpful"
            >
              <ThumbsDown className="h-3.5 w-3.5" />
            </Button>
          </div>
        </div>
      </div>
    );
  }
);

AIResponse.displayName = 'AIResponse';



=== FILE: packages\ui\src\components\button\Button.tsx ===

import React from 'react';
import { cva, type VariantProps } from 'class-variance-authority';
import { Slot } from '@radix-ui/react-slot';
import { cn } from '../../utils/cn';

const buttonVariants = cva(
  "group relative inline-flex items-center justify-center font-semibold tracking-tight transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-purple-400/40 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 disabled:active:scale-100 hover:scale-[1.02] active:scale-[0.98]",
  {
    variants: {
      variant: {
        primary: "bg-gradient-to-r from-blue-600 via-purple-600 to-blue-600 text-white border-transparent",
        secondary: "bg-gray-100 text-gray-900 border border-gray-200 hover:bg-gray-200 dark:bg-white/[0.05] dark:text-white dark:border-white/10 dark:hover:bg-white/[0.10] dark:hover:border-white/20",
        outline: "bg-transparent text-gray-900 border border-gray-300 hover:bg-gray-100 dark:text-white dark:border-white/20 dark:hover:bg-white/[0.05] dark:hover:border-white/30",
        ghost: "bg-transparent text-gray-600 hover:text-gray-900 hover:bg-gray-100 dark:text-white/80 dark:hover:text-white dark:hover:bg-white/[0.05] border-transparent",
        danger: "bg-rose-500/10 text-rose-600 border border-rose-500/20 hover:bg-rose-500/20 hover:border-rose-500/30 hover:text-rose-700 dark:text-rose-400 dark:hover:text-rose-300",
        success: "bg-emerald-500/10 text-emerald-600 border border-emerald-500/20 hover:bg-emerald-500/20 hover:border-emerald-500/30 hover:text-emerald-700 dark:text-emerald-400 dark:hover:text-emerald-300",
        alert: "bg-amber-500/10 text-amber-600 border border-amber-500/20 hover:bg-amber-500/20 hover:border-amber-500/30 hover:text-amber-700 dark:text-amber-400 dark:hover:text-amber-300",
      },
      size: {
        sm: "h-9 px-3 text-xs gap-1.5",
        md: "h-11 px-5 text-sm gap-2",
        lg: "h-14 px-8 text-base gap-3",
        icon: "h-10 w-10 p-0 flex items-center justify-center",
      },
      shape: {
        default: "rounded-2xl",
        pill: "rounded-full",
        square: "rounded-lg",
      },
      shadow: {
        true: "",
        false: "",
      },
    },
    compoundVariants: [
      {
        variant: "primary",
        shadow: true,
        class: "shadow-[0_12px_40px_rgba(99,102,241,.45)] hover:shadow-[0_18px_60px_rgba(99,102,241,.6)]",
      },
      {
        variant: "secondary",
        shadow: true,
        class: "shadow-sm",
      }
    ],
    defaultVariants: {
      variant: "primary",
      size: "md",
      shape: "default",
      shadow: true,
    },
  }
);

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean;
  leftIcon?: React.ReactNode;
  rightIcon?: React.ReactNode;
  isLoading?: boolean;
}

export const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ 
    className, 
    variant, 
    size, 
    shape,
    shadow,
    asChild = false,
    leftIcon, 
    rightIcon, 
    isLoading,
    children,
    disabled,
    ...props 
  }, ref) => {
    const Comp = asChild ? Slot : "button";
    
    return (
      <Comp
        ref={ref}
        disabled={disabled || isLoading}
        className={cn(buttonVariants({ variant, size, shape, shadow, className }))}
        {...props}
      >
        {variant === 'primary' && !asChild && (
          <span className="pointer-events-none absolute inset-0 rounded-[inherit] bg-gradient-to-r from-white/18 via-white/5 to-white/18 opacity-0 blur-lg transition-opacity duration-300 group-hover:opacity-100" />
        )}
        
        <span className="relative inline-flex items-center justify-center">
          {isLoading && (
            <svg className="animate-spin -ml-1 mr-2 h-4 w-4 text-current" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
              <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
          )}
          {!isLoading && leftIcon && <span className={cn("mr-2", size === 'sm' && "mr-1.5")}>{leftIcon}</span>}
          {children}
          {!isLoading && rightIcon && <span className={cn("ml-2", size === 'sm' && "ml-1.5")}>{rightIcon}</span>}
        </span>
      </Comp>
    );
  }
);

Button.displayName = 'Button';



=== FILE: packages\ui\src\components\button\GlowButton.tsx ===

import React, { useRef } from 'react';
import { cn } from '../../utils/cn';

export interface GlowButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  children: React.ReactNode;
  leftIcon?: React.ReactNode;
  rightIcon?: React.ReactNode;
}

export const GlowButton = React.forwardRef<HTMLButtonElement, GlowButtonProps>(
  ({ children, className, leftIcon, rightIcon, ...props }, ref) => {
    const localRef = useRef<HTMLButtonElement>(null);

    const handleMove = (e: React.MouseEvent<HTMLButtonElement>) => {
      const el = localRef.current;
      if (!el) return;
      const rect = el.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      el.style.setProperty('--x', `${x}px`);
      el.style.setProperty('--y', `${y}px`);
    };

    // Merge refs
    React.useImperativeHandle(ref, () => localRef.current as HTMLButtonElement);

    return (
      <button
        ref={localRef}
        onMouseMove={handleMove}
        type={props.type ?? 'button'}
        className={cn(
          'group relative inline-flex items-center justify-center gap-2 rounded-2xl px-6 py-3',
          'bg-white/[0.03] border border-white/10',
          'text-white font-semibold tracking-tight overflow-hidden',
          'transition-all duration-300',
          'hover:bg-white/[0.05] hover:scale-[1.02]',
          'active:scale-[0.98]',
          'focus:outline-none focus:ring-2 focus:ring-purple-400/40',
          className
        )}
        {...props}
      >
        {/* Mouse follow glow */}
        <div 
          className="pointer-events-none absolute -inset-px opacity-0 transition-opacity duration-300 group-hover:opacity-100"
          style={{
            background: 'radial-gradient(600px circle at var(--x) var(--y), rgba(255,255,255,0.4), transparent 40%)'
          }}
        />
        
        {/* Border glow */}
        <div 
          className="pointer-events-none absolute -inset-px rounded-2xl opacity-0 transition-opacity duration-300 group-hover:opacity-100"
          style={{
            background: 'radial-gradient(300px circle at var(--x) var(--y), rgba(255,255,255,0.6), transparent 40%)',
            maskImage: 'linear-gradient(#fff, #fff), linear-gradient(#fff, #fff)',
            maskClip: 'content-box, border-box',
            maskComposite: 'exclude',
            WebkitMaskComposite: 'xor',
            padding: '1px'
          }}
        />

        <span className="relative inline-flex items-center gap-2 z-10">
          {leftIcon}
          {children}
          {rightIcon}
        </span>
      </button>
    );
  }
);

GlowButton.displayName = 'GlowButton';



=== FILE: packages\ui\src\components\button\PrimaryButton.tsx ===

import React from 'react';
import { cn } from '../../utils/cn';

interface PrimaryButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  children: React.ReactNode;
  leftIcon?: React.ReactNode;
  rightIcon?: React.ReactNode;
}

export const PrimaryButton = React.forwardRef<HTMLButtonElement, PrimaryButtonProps>(
  ({ children, className, leftIcon, rightIcon, ...props }, ref) => {
    return (
      <button
        ref={ref}
        type={props.type ?? 'button'}
        className={cn(
          'group relative inline-flex items-center justify-center gap-2 rounded-2xl px-5 py-3',
          'bg-gradient-to-r from-blue-600 via-purple-600 to-blue-600',
          'text-white font-semibold tracking-tight',
          'shadow-[0_12px_40px_rgba(99,102,241,.45)]',
          'transition-all duration-300',
          'hover:scale-[1.03] hover:shadow-[0_18px_60px_rgba(99,102,241,.6)]',
          'active:scale-[0.98]',
          'disabled:opacity-50 disabled:cursor-not-allowed',
          'focus:outline-none focus:ring-2 focus:ring-purple-400/40',
          className
        )}
        {...props}
      >
        <span className="pointer-events-none absolute inset-0 rounded-2xl bg-gradient-to-r from-white/18 via-white/5 to-white/18 opacity-0 blur-lg transition-opacity duration-300 group-hover:opacity-100" />
        <span className="relative inline-flex items-center gap-2">
          {leftIcon}
          {children}
          {rightIcon}
        </span>
      </button>
    );
  }
);

PrimaryButton.displayName = 'PrimaryButton';


=== FILE: packages\ui\src\components\card\Card.tsx ===

import React from 'react';
import { cn } from '../../utils/cn';
import { Surface } from '../../primitives/Surface';

export const Card = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <Surface
    ref={ref}
    className={className}
    {...props}
  />
));
Card.displayName = "Card";

export const CardHeader = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex flex-col space-y-1.5 p-6", className)}
    {...props}
  />
));
CardHeader.displayName = "CardHeader";

export const CardTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h3
    ref={ref}
    className={cn(
      "text-2xl font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
));
CardTitle.displayName = "CardTitle";

export const CardDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <p
    ref={ref}
    className={cn("text-sm text-gray-500 dark:text-white/50", className)}
    {...props}
  />
));
CardDescription.displayName = "CardDescription";

export const CardContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
));
CardContent.displayName = "CardContent";

export const CardFooter = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("flex items-center p-6 pt-0", className)}
    {...props}
  />
));
CardFooter.displayName = "CardFooter";



=== FILE: packages\ui\src\components\card\MetricCard.tsx ===

import React, { useRef } from 'react';
import { cn } from '../../utils/cn';

// Internal components for MetricCard
function TokenBadge({
  accent = 'teal',
  children,
}: {
  accent?: 'teal' | 'amber' | 'violet' | 'blue' | 'rose' | 'emerald' | 'indigo';
  children: React.ReactNode;
}) {
  const map: Record<string, string> = {
    teal: 'bg-teal-500/90',
    amber: 'bg-amber-400/95',
    violet: 'bg-violet-500/90',
    blue: 'bg-blue-500/90',
    rose: 'bg-rose-500/90',
    emerald: 'bg-emerald-500/90',
    indigo: 'bg-indigo-500/90',
  };

  return (
    <div className={cn('flex h-11 w-11 items-center justify-center rounded-2xl', map[accent] ?? map.teal)}>
      {children}
    </div>
  );
}

function AccentGlow({ accent = 'teal' }: { accent?: 'teal' | 'amber' | 'violet' | 'blue' | 'rose' | 'emerald' | 'indigo' }) {
  const map: Record<string, string> = {
    teal: 'from-teal-400/25 via-teal-400/10 to-transparent',
    amber: 'from-amber-300/25 via-amber-300/10 to-transparent',
    violet: 'from-violet-400/25 via-violet-400/10 to-transparent',
    blue: 'from-blue-400/25 via-blue-400/10 to-transparent',
    rose: 'from-rose-400/25 via-rose-400/10 to-transparent',
    emerald: 'from-emerald-400/25 via-emerald-400/10 to-transparent',
    indigo: 'from-indigo-400/25 via-indigo-400/10 to-transparent',
  };

  return (
    <div
      className={cn(
        'pointer-events-none absolute -right-12 top-1/2 h-40 w-48 -translate-y-1/2 rotate-12',
        'bg-gradient-to-l blur-2xl',
        map[accent] ?? map.teal
      )}
    />
  );
}

function SparkWave({ color = 'currentColor' }: { color?: string }) {
  return (
    <svg
      viewBox="0 0 120 40"
      className="h-6 w-16"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      aria-hidden="true"
    >
      <path
        d="M2 22c10 0 10-10 20-10s10 10 20 10 10-10 20-10 10 10 20 10 10-10 20-10"
        stroke={color}
        strokeWidth="4"
        strokeLinecap="round"
        strokeLinejoin="round"
        opacity="0.95"
      />
    </svg>
  );
}

export interface MetricCardProps extends React.HTMLAttributes<HTMLDivElement> {
  accent?: 'teal' | 'amber' | 'violet' | 'blue' | 'rose' | 'emerald' | 'indigo';
  icon: React.ReactNode;
  value: React.ReactNode;
  subtext?: React.ReactNode;
  showWave?: boolean;
  onClick?: () => void;
}

export const MetricCard = React.forwardRef<HTMLDivElement, MetricCardProps>(
  ({ accent = 'teal', icon, value, subtext, showWave = false, onClick, className, ...props }, ref) => {
    const localRef = useRef<HTMLDivElement | null>(null);

    const setCenter = () => {
      const el = localRef.current;
      if (!el) return;
      const r = el.getBoundingClientRect();
      el.style.setProperty('--x', `${Math.round(r.width / 2)}px`);
      el.style.setProperty('--y', `${Math.round(r.height / 2)}px`);
    };

    const handleMove = (e: React.MouseEvent) => {
      const el = localRef.current;
      if (!el) return;
      const r = el.getBoundingClientRect();
      el.style.setProperty('--x', `${e.clientX - r.left}px`);
      el.style.setProperty('--y', `${e.clientY - r.top}px`);
    };

    const waveColors: Record<string, string> = {
      teal: 'rgba(45,212,191,.95)',
      amber: 'rgba(251,191,36,.95)',
      violet: 'rgba(167,139,250,.95)',
      blue: 'rgba(96,165,250,.95)',
      rose: 'rgba(251,113,133,.95)',
      emerald: 'rgba(52,211,153,.95)',
      indigo: 'rgba(129,140,248,.95)',
    };

    const waveColor = waveColors[accent] ?? waveColors.teal;

    return (
      <div
        ref={(node) => {
            localRef.current = node;
            if (typeof ref === 'function') ref(node);
            else if (ref) (ref as React.MutableRefObject<HTMLDivElement | null>).current = node;
        }}
        onMouseEnter={setCenter}
        onMouseMove={handleMove}
        onClick={onClick}
        className={cn(
          'group relative overflow-hidden rounded-2xl',
          'bg-white border border-gray-200 shadow-sm',
          'dark:bg-transparent dark:bg-gradient-to-b dark:from-white/[0.06] dark:to-white/[0.03]',
          'dark:border-white/[0.10]',
          'dark:shadow-[0_18px_55px_rgba(0,0,0,.55)]',
          'transition-transform duration-300 hover:scale-[1.015]',
          onClick && 'cursor-pointer',
          className
        )}
        {...props}
      >
        <div
          className="pointer-events-none absolute inset-0 opacity-0 transition-opacity duration-300 group-hover:opacity-100"
          style={{
            background:
              'radial-gradient(180px at var(--x, 50%) var(--y, 50%), rgba(255,255,255,.16), transparent 60%)',
          }}
        />
        <div className="pointer-events-none absolute inset-0 bg-[radial-gradient(220px_140px_at_18%_18%,rgba(255,255,255,.08),transparent_60%)]" />
        <AccentGlow accent={accent} />

        <div className="relative p-5">
          <div className="flex items-start justify-between gap-4">
            <TokenBadge accent={accent}>{icon}</TokenBadge>
          </div>

          <div className="mt-4 flex items-end justify-between gap-4">
            <div className="min-w-0">
              <div className="truncate text-2xl font-semibold tracking-tight text-gray-900 dark:text-white">{value}</div>
              {subtext ? <div className="mt-1 text-sm text-gray-500 dark:text-white/45">{subtext}</div> : null}
            </div>
            {showWave ? <SparkWave color={waveColor} /> : null}
          </div>
        </div>
      </div>
    );
  }
);

MetricCard.displayName = 'MetricCard';


=== FILE: packages\ui\src\components\chat\ChatHeader.tsx ===

import React from 'react';
import { cn } from '../../utils/cn';
import { User } from './types';
import { Avatar } from '../data-display/Avatar';
import { Phone, Video, MoreVertical, ArrowLeft } from 'lucide-react';

interface ChatHeaderProps extends React.HTMLAttributes<HTMLDivElement> {
  user: User;
  onBack?: () => void;
  onInfo?: () => void;
}

export function ChatHeader({ user, onBack, onInfo, className, ...props }: ChatHeaderProps) {
  return (
    <div 
      className={cn(
        "flex h-16 items-center justify-between border-b border-gray-200 dark:border-white/10 bg-white/80 dark:bg-black/40 backdrop-blur px-4 sticky top-0 z-10",
        className
      )} 
      {...props}
    >
      <div className="flex items-center gap-3">
        {onBack && (
          <button onClick={onBack} className="md:hidden p-2 -ml-2 rounded-full hover:bg-gray-100 dark:hover:bg-white/10">
            <ArrowLeft className="h-5 w-5 text-gray-600 dark:text-white/70" />
          </button>
        )}
        
        <div className="relative cursor-pointer" onClick={onInfo}>
          <Avatar src={user.avatar} alt={user.name} fallback={user.name[0]} />
          {user.status === 'online' && (
            <span className="absolute bottom-0 right-0 h-3 w-3 rounded-full bg-green-500 border-2 border-white dark:border-black" />
          )}
        </div>
        
        <div className="cursor-pointer" onClick={onInfo}>
          <h3 className="font-semibold text-gray-900 dark:text-white leading-none mb-1">{user.name}</h3>
          <p className="text-xs text-gray-500 dark:text-white/50">
            {user.status === 'online' ? 'Online' : `Last seen ${user.lastSeen?.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`}
          </p>
        </div>
      </div>

      <div className="flex items-center gap-1">
        <button className="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-white/10 text-gray-600 dark:text-white/60 transition-colors">
          <Phone className="h-5 w-5" />
        </button>
        <button className="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-white/10 text-gray-600 dark:text-white/60 transition-colors">
          <Video className="h-5 w-5" />
        </button>
        <button 
          onClick={onInfo}
          className="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-white/10 text-gray-600 dark:text-white/60 transition-colors"
        >
          <MoreVertical className="h-5 w-5" />
        </button>
      </div>
    </div>
  );
}



=== FILE: packages\ui\src\components\chat\ChatInput.tsx ===

import React, { useState, useRef, useEffect, useMemo } from 'react';
import { cn } from '../../utils/cn';
import { Send, Paperclip, Smile, Mic, Image as ImageIcon, AtSign } from 'lucide-react';
import { Button } from '../button/Button';
import { User } from './types';
import { Surface } from '../../primitives/Surface';
import { Avatar } from '../data-display/Avatar';

interface ChatInputProps extends React.HTMLAttributes<HTMLDivElement> {
  onSend?: (content: string) => void;
  onAttach?: () => void;
  placeholder?: string;
  users?: User[];
}

export function ChatInput({ 
  onSend, 
  onAttach, 
  placeholder = "Type a message...", 
  users = [],
  className, 
  ...props 
}: ChatInputProps) {
  const [content, setContent] = useState("");
  const [isUploading, setIsUploading] = useState(false);
  const [mentionSearch, setMentionSearch] = useState<string | null>(null);
  const [mentionIndex, setMentionIndex] = useState(0);
  const textareaRef = useRef<HTMLTextAreaElement>(null);

  const filteredUsers = useMemo(() => {
    if (mentionSearch === null) return [];
    return users.filter(u => 
      u.name.toLowerCase().includes(mentionSearch.toLowerCase())
    ).slice(0, 5);
  }, [users, mentionSearch]);

  const handleInput = (e: React.ChangeEvent<HTMLTextAreaElement>) => {
    const value = e.target.value;
    setContent(value);
    
    // Mention logic
    const lastChar = value[e.target.selectionStart - 1];
    const textBeforeCursor = value.slice(0, e.target.selectionStart);
    const mentionMatch = textBeforeCursor.match(/@(\w*)$/);

    if (mentionMatch) {
      setMentionSearch(mentionMatch[1] || "");
      setMentionIndex(0);
    } else {
      setMentionSearch(null);
    }

    // Auto-resize
    if (textareaRef.current) {
      textareaRef.current.style.height = 'auto';
      textareaRef.current.style.height = `${Math.min(textareaRef.current.scrollHeight, 120)}px`;
    }
  };

  const insertMention = (user: User) => {
    if (!textareaRef.current) return;
    const start = textareaRef.current.selectionStart;
    const textBefore = content.slice(0, start).replace(/@\w*$/, `@${user.name} `);
    const textAfter = content.slice(start);
    setContent(textBefore + textAfter);
    setMentionSearch(null);
    textareaRef.current.focus();
  };

  const handleKeyDown = (e: React.KeyboardEvent) => {
    if (mentionSearch !== null && filteredUsers.length > 0) {
      if (e.key === 'ArrowDown') {
        e.preventDefault();
        setMentionIndex(prev => (prev + 1) % filteredUsers.length);
      } else if (e.key === 'ArrowUp') {
        e.preventDefault();
        setMentionIndex(prev => (prev - 1 + filteredUsers.length) % filteredUsers.length);
      } else if (e.key === 'Enter' || e.key === 'Tab') {
        e.preventDefault();
        insertMention(filteredUsers[mentionIndex]!);
      } else if (e.key === 'Escape') {
        setMentionSearch(null);
      }
      return;
    }

    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSend();
    }
  };

  const handleSend = () => {
    if (!content.trim()) return;
    onSend?.(content);
    setContent("");
    if (textareaRef.current) {
      textareaRef.current.style.height = 'auto';
    }
  };

  const handleAttachClick = () => {
    setIsUploading(true);
    // Simulate upload
    setTimeout(() => {
      setIsUploading(false);
      onAttach?.();
    }, 1000);
  };

  return (
    <div className={cn("relative p-4 border-t border-white/10 bg-white/[0.02]", className)} {...props}>
      {/* Mentions Popover */}
      {mentionSearch !== null && filteredUsers.length > 0 && (
        <Surface className="absolute bottom-full left-4 mb-2 w-64 overflow-hidden shadow-2xl animate-in fade-in slide-in-from-bottom-2">
          <div className="p-2 border-b border-white/10 bg-white/[0.02]">
            <span className="text-[10px] font-bold uppercase tracking-wider text-white/40 px-2">
              Mention User
            </span>
          </div>
          <div className="max-h-48 overflow-y-auto p-1">
            {filteredUsers.map((user: User, idx: number) => (
              <button
                key={user.id}
                onClick={() => insertMention(user)}
                className={cn(
                  "w-full flex items-center gap-3 px-3 py-2 rounded-lg transition-colors text-left",
                  idx === mentionIndex ? "bg-white/10" : "hover:bg-white/5"
                )}
              >
                <Avatar src={user.avatar} alt={user.name} size="sm" />
                <div className="flex-1 min-w-0">
                  <div className="text-sm font-medium text-white truncate">{user.name}</div>
                  <div className="text-xs text-white/40 truncate">@{user.name.toLowerCase().replace(/\s/g, '')}</div>
                </div>
                {idx === mentionIndex && (
                  <div className="text-[10px] bg-white/10 px-1.5 py-0.5 rounded text-white/60">Enter</div>
                )}
              </button>
            ))}
          </div>
        </Surface>
      )}

      <div className="flex items-end gap-2 max-w-4xl mx-auto">
        <div className="flex gap-1 mb-1">
          <Button variant="ghost" size="icon" className="h-9 w-9 rounded-xl text-white/40 hover:text-white" onClick={handleAttachClick} disabled={isUploading}>
            <Paperclip className={cn("w-5 h-5", isUploading && "animate-pulse text-blue-500")} />
          </Button>
        </div>
        
        <div className="flex-1 relative group">
          <textarea
            ref={textareaRef}
            value={content}
            onChange={handleInput}
            onKeyDown={handleKeyDown}
            placeholder={isUploading ? "Uploading..." : placeholder}
            rows={1}
            className="w-full bg-white/[0.03] border border-white/10 rounded-2xl px-4 py-2.5 text-sm text-white placeholder:text-white/20 focus:outline-none focus:ring-2 focus:ring-white/10 resize-none transition-all min-h-[44px]"
          />
          <div className="absolute right-3 bottom-2.5 flex items-center gap-2 opacity-0 group-focus-within:opacity-100 transition-opacity">
            <button className="text-white/20 hover:text-white/60 transition-colors">
              <Smile className="w-4 h-4" />
            </button>
            <button className="text-white/20 hover:text-white/60 transition-colors">
              <AtSign className="w-4 h-4" />
            </button>
          </div>
        </div>

        <div className="flex gap-2 mb-1">
          {content.trim() ? (
            <Button 
              onClick={handleSend}
              className="h-9 w-9 rounded-xl bg-white text-black hover:bg-white/90 p-0"
            >
              <Send className="w-4 h-4" />
            </Button>
          ) : (
            <Button variant="ghost" size="icon" className="h-9 w-9 rounded-xl text-white/40 hover:text-white">
              <Mic className="w-5 h-5" />
            </Button>
          )}
        </div>
      </div>
    </div>
  );
}



=== FILE: packages\ui\src\components\chat\ChatLayout.tsx ===

import React from 'react';
import { cn } from '../../utils/cn';

interface ChatLayoutProps extends React.HTMLAttributes<HTMLDivElement> {
  children: React.ReactNode;
}

export function ChatLayout({ children, className, ...props }: ChatLayoutProps) {
  return (
    <div 
      className={cn(
        "flex h-[800px] w-full overflow-hidden rounded-3xl border border-gray-200 dark:border-white/10 bg-white dark:bg-black/40 backdrop-blur-xl shadow-2xl",
        className
      )} 
      {...props}
    >
      {children}
    </div>
  );
}



=== FILE: packages\ui\src\components\chat\ChatProfile.tsx ===

import React from 'react';
import { cn } from '../../utils/cn';
import { User } from './types';
import { Avatar } from '../data-display/Avatar';
import { Bell, Ban, Trash2, Image, FileText, Link as LinkIcon, X } from 'lucide-react';
import { ScrollArea } from '../data-display/ScrollArea';
import { Separator } from '../data-display/Separator';
import { Switch } from '../form/Switch';

interface ChatProfileProps extends React.HTMLAttributes<HTMLDivElement> {
  user: User;
  onClose?: () => void;
}

export function ChatProfile({ user, onClose, className, ...props }: ChatProfileProps) {
  return (
    <div className={cn("w-80 border-l border-gray-200 dark:border-white/10 bg-white dark:bg-black/20 flex flex-col", className)} {...props}>
      <div className="h-16 flex items-center px-4 border-b border-gray-200 dark:border-white/10">
        <button onClick={onClose} className="p-2 -ml-2 rounded-full hover:bg-gray-100 dark:hover:bg-white/10">
          <X className="h-5 w-5 text-gray-500" />
        </button>
        <span className="ml-2 font-semibold text-gray-900 dark:text-white">Contact Info</span>
      </div>

      <ScrollArea className="flex-1">
        <div className="p-6 flex flex-col items-center text-center">
          <Avatar src={user.avatar} alt={user.name} fallback={user.name[0]} className="h-24 w-24 mb-4 text-2xl" />
          <h2 className="text-xl font-bold text-gray-900 dark:text-white">{user.name}</h2>
          <p className="text-sm text-gray-500 dark:text-white/50 mt-1">{user.phone || '+1 (555) 000-0000'}</p>
          
          <div className="mt-6 w-full">
            <p className="text-sm text-gray-500 dark:text-white/50 mb-1 text-left">About</p>
            <p className="text-sm text-gray-900 dark:text-white text-left">{user.bio || "Hey there! I am using Pixon Chat."}</p>
          </div>
        </div>

        <Separator />

        <div className="p-4 space-y-4">
          <h3 className="text-xs font-semibold text-gray-500 dark:text-white/40 uppercase tracking-wider">Media & Docs</h3>
          <div className="grid grid-cols-3 gap-2">
            {[1, 2, 3, 4, 5, 6].map((i) => (
              <div key={i} className="aspect-square rounded-lg bg-gray-100 dark:bg-white/5 overflow-hidden relative group cursor-pointer">
                <div className="absolute inset-0 flex items-center justify-center text-gray-400">
                  <Image className="h-6 w-6" />
                </div>
                <div className="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity" />
              </div>
            ))}
          </div>
        </div>

        <Separator />

        <div className="p-4 space-y-4">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3 text-gray-700 dark:text-white/80">
              <Bell className="h-5 w-5" />
              <span className="text-sm font-medium">Mute Notifications</span>
            </div>
            <Switch />
          </div>
        </div>

        <Separator />

        <div className="p-4 space-y-2">
          <button className="w-full flex items-center gap-3 p-3 rounded-xl hover:bg-red-50 dark:hover:bg-red-500/10 text-red-600 dark:text-red-400 transition-colors text-sm font-medium">
            <Ban className="h-5 w-5" />
            Block {user.name}
          </button>
          <button className="w-full flex items-center gap-3 p-3 rounded-xl hover:bg-red-50 dark:hover:bg-red-500/10 text-red-600 dark:text-red-400 transition-colors text-sm font-medium">
            <Trash2 className="h-5 w-5" />
            Delete Chat
          </button>
        </div>
      </ScrollArea>
    </div>
  );
}



=== FILE: packages\ui\src\components\chat\ChatSidebar.tsx ===

import React from 'react';
import { cn } from '../../utils/cn';
import { Search, Plus } from 'lucide-react';
import { Conversation } from './types';
import { Avatar } from '../data-display/Avatar';
import { ScrollArea } from '../data-display/ScrollArea';

interface ChatSidebarProps extends Omit<React.HTMLAttributes<HTMLDivElement>, 'onSelect'> {
  conversations: Conversation[];
  activeId?: string;
  onSelect?: (id: string) => void;
  onNewChat?: () => void;
}

export function ChatSidebar({ 
  conversations, 
  activeId, 
  onSelect, 
  onNewChat,
  className,
  ...props 
}: ChatSidebarProps) {
  return (
    <div className={cn("flex w-80 flex-col border-r border-gray-200 dark:border-white/10 bg-gray-50/50 dark:bg-white/[0.02]", className)} {...props}>
      <div className="p-4 space-y-4">
        <div className="flex items-center justify-between">
          <h2 className="text-xl font-bold text-gray-900 dark:text-white">Messages</h2>
          <button 
            onClick={onNewChat}
            className="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-white/10 text-gray-600 dark:text-white/60 transition-colors"
          >
            <Plus className="h-5 w-5" />
          </button>
        </div>
        
        <div className="relative">
          <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400" />
          <input 
            type="text" 
            placeholder="Search messages..." 
            className="w-full h-10 pl-9 pr-4 rounded-xl bg-white dark:bg-white/5 border border-gray-200 dark:border-white/10 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition-all placeholder:text-gray-400"
          />
        </div>
      </div>

      <ScrollArea className="flex-1">
        <div className="p-2 space-y-1">
          {conversations.map((chat) => (
            <button
              key={chat.id}
              onClick={() => onSelect?.(chat.id)}
              className={cn(
                "w-full flex items-center gap-3 p-3 rounded-xl transition-all text-left group",
                activeId === chat.id 
                  ? "bg-blue-500/10 dark:bg-white/10 shadow-[0_0_15px_rgba(59,130,246,0.1)] dark:shadow-[0_0_15px_rgba(255,255,255,0.05)]" 
                  : "hover:bg-gray-100 dark:hover:bg-white/5"
              )}
            >
              <div className="relative">
                <Avatar src={chat.user.avatar} alt={chat.user.name} fallback={chat.user.name[0]} />
                {chat.user.status === 'online' && (
                  <span className="absolute bottom-0 right-0 h-3 w-3 rounded-full bg-green-500 border-2 border-white dark:border-black" />
                )}
              </div>
              
              <div className="flex-1 min-w-0">
                <div className="flex items-center justify-between mb-0.5">
                  <span className={cn(
                    "font-medium truncate",
                    activeId === chat.id ? "text-blue-600 dark:text-white" : "text-gray-900 dark:text-white/90"
                  )}>
                    {chat.user.name}
                  </span>
                  {chat.lastMessage && (
                    <span className="text-xs text-gray-400 whitespace-nowrap ml-2">
                      {chat.lastMessage.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                    </span>
                  )}
                </div>
                <div className="flex items-center justify-between">
                  <p className={cn(
                    "text-sm truncate pr-2",
                    activeId === chat.id ? "text-blue-600/80 dark:text-white/70" : "text-gray-500 dark:text-white/50",
                    chat.isTyping && "text-blue-500 italic"
                  )}>
                    {chat.isTyping ? 'Typing...' : chat.lastMessage?.content}
                  </p>
                  {chat.unreadCount ? (
                    <span className="flex h-5 min-w-[1.25rem] items-center justify-center rounded-full bg-blue-500 px-1.5 text-[10px] font-bold text-white">
                      {chat.unreadCount}
                    </span>
                  ) : null}
                </div>
              </div>
            </button>
          ))}
        </div>
      </ScrollArea>
    </div>
  );
}



=== FILE: packages\ui\src\components\chat\MessageBubble.tsx ===

import React from 'react';
import { cn } from '../../utils/cn';
import { Message } from './types';
import { Check, CheckCheck, MoreHorizontal, Reply, Trash2, Copy, Smile } from 'lucide-react';
import { Motion } from '../feedback/Motion';
import { 
  DropdownMenu, 
  DropdownMenuTrigger, 
  DropdownMenuContent, 
  DropdownMenuItem 
} from '../overlay/DropdownMenu';
import { Image } from '../data-display/Image';

interface MessageBubbleProps {
  message: Message;
  isOwn: boolean;
  showAvatar?: boolean;
  showStatus?: boolean;
  className?: string;
  onReply?: (message: Message) => void;
  onReact?: (message: Message, emoji: string) => void;
  onDelete?: (message: Message) => void;
}

export function MessageBubble({ 
  message, 
  isOwn, 
  showAvatar, 
  showStatus = true, 
  className,
  onReply,
  onReact,
  onDelete
}: MessageBubbleProps) {
  return (
    <Motion 
      preset="spring"
      className={cn(
        "flex w-full gap-2 mb-1 group relative",
        isOwn ? "justify-end" : "justify-start",
        className
      )}
    >
      {/* Actions Menu (Hover) */}
      <div className={cn(
        "absolute top-2 opacity-0 group-hover:opacity-100 transition-opacity z-10",
        isOwn ? "left-0 -translate-x-full pr-2" : "right-0 translate-x-full pl-2"
      )}>
        <DropdownMenu>
          <DropdownMenuTrigger className="p-1 rounded-full hover:bg-gray-100 dark:hover:bg-white/10 text-gray-400">
            <MoreHorizontal className="h-4 w-4" />
          </DropdownMenuTrigger>
          <DropdownMenuContent align={isOwn ? "end" : "start"}>
            <DropdownMenuItem onClick={() => onReply?.(message)}>
              <Reply className="h-4 w-4 mr-2" /> Reply
            </DropdownMenuItem>
            <DropdownMenuItem onClick={() => navigator.clipboard.writeText(message.content)}>
              <Copy className="h-4 w-4 mr-2" /> Copy
            </DropdownMenuItem>
            <DropdownMenuItem onClick={() => onReact?.(message, '')}>
              <Smile className="h-4 w-4 mr-2" /> React
            </DropdownMenuItem>
            {isOwn && (
              <DropdownMenuItem onClick={() => onDelete?.(message)} className="text-red-500">
                <Trash2 className="h-4 w-4 mr-2" /> Delete
              </DropdownMenuItem>
            )}
          </DropdownMenuContent>
        </DropdownMenu>
      </div>

      <div className={cn(
        "relative max-w-[70%] px-4 py-2 rounded-2xl shadow-sm transition-all",
        isOwn 
          ? "bg-blue-600 text-white rounded-tr-sm" 
          : "bg-white dark:bg-white/10 text-gray-900 dark:text-white rounded-tl-sm border border-gray-200 dark:border-transparent"
      )}>
        {/* Reply Context */}
        {message.replyToId && (
          <div className={cn(
            "mb-2 rounded px-2 py-1 text-xs border-l-2 opacity-80",
            isOwn ? "bg-white/10 border-white/50" : "bg-gray-100 dark:bg-black/20 border-blue-500"
          )}>
            Replying to message...
          </div>
        )}

        {/* Attachments */}
        {message.attachments && message.attachments.length > 0 && (
          <div className="mb-2 space-y-2">
            {message.attachments.map(att => (
              att.type === 'image' ? (
                <Image 
                  key={att.id} 
                  src={att.url} 
                  alt="Attachment" 
                  className="rounded-lg max-h-60 object-cover w-full"
                />
              ) : (
                <div key={att.id} className="flex items-center gap-2 p-2 rounded bg-black/5 dark:bg-white/10">
                  <div className="h-8 w-8 bg-gray-200 dark:bg-white/20 rounded flex items-center justify-center text-xs font-bold">
                    FILE
                  </div>
                  <div className="text-xs truncate flex-1">{att.name || 'File'}</div>
                </div>
              )
            ))}
          </div>
        )}

        {/* Content */}
        <div className="text-sm whitespace-pre-wrap break-words leading-relaxed">
          {message.content}
        </div>

        {/* Metadata */}
        <div className={cn(
          "flex items-center justify-end gap-1 mt-1 select-none",
          isOwn ? "text-blue-100" : "text-gray-400 dark:text-white/40"
        )}>
          <span className="text-[10px]">
            {message.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
          </span>
          {isOwn && showStatus && (
            <span className="flex items-center">
              {message.status === 'read' ? (
                <CheckCheck className="h-3 w-3 text-blue-200" />
              ) : message.status === 'delivered' ? (
                <CheckCheck className="h-3 w-3 text-blue-200/50" />
              ) : (
                <Check className="h-3 w-3 text-blue-200/50" />
              )}
            </span>
          )}
        </div>

        {/* Reactions */}
        {message.reactions && Object.keys(message.reactions).length > 0 && (
          <div className="absolute -bottom-2 right-4 flex gap-1">
            {Object.entries(message.reactions).map(([emoji, users]) => (
              <div key={emoji} className="bg-white dark:bg-gray-800 shadow-sm border border-gray-100 dark:border-white/10 rounded-full px-1.5 py-0.5 text-[10px] flex items-center gap-1">
                <span>{emoji}</span>
                <span className="text-gray-500">{users.length}</span>
              </div>
            ))}
          </div>
        )}
      </div>
    </Motion>
  );
}



=== FILE: packages\ui\src\components\chat\MessageList.tsx ===

import React, { useRef, useEffect, useState, useMemo } from 'react';
import { cn } from '../../utils/cn';
import { Message } from './types';
import { MessageBubble } from './MessageBubble';
import { ScrollArea } from '../data-display/ScrollArea';
import { MessageSquare } from 'lucide-react';

interface MessageListProps extends React.HTMLAttributes<HTMLDivElement> {
  messages: Message[];
  currentUserId: string;
  onReply?: (message: Message) => void;
  onReact?: (message: Message, emoji: string) => void;
  onDelete?: (message: Message) => void;
  onLoadMore?: () => void;
  hasMore?: boolean;
  isLoadingMore?: boolean;
}

export function MessageList({ 
  messages, 
  currentUserId, 
  className, 
  onReply,
  onReact,
  onDelete,
  onLoadMore,
  hasMore,
  isLoadingMore,
  ...props 
}: MessageListProps) {
  const bottomRef = useRef<HTMLDivElement>(null);
  const [shouldAutoScroll, setShouldAutoScroll] = useState(true);

  useEffect(() => {
    if (shouldAutoScroll) {
      bottomRef.current?.scrollIntoView({ behavior: 'smooth' });
    }
  }, [messages, shouldAutoScroll]);

  const handleScroll = (e: React.UIEvent<HTMLDivElement>) => {
    const target = e.currentTarget;
    const isAtBottom = Math.abs(target.scrollHeight - target.clientHeight - target.scrollTop) < 50;
    setShouldAutoScroll(isAtBottom);

    if (target.scrollTop === 0 && hasMore && !isLoadingMore && onLoadMore) {
      onLoadMore();
    }
  };

  // Group messages by date
  const groupedMessages = useMemo(() => {
    return messages.reduce((groups, message) => {
      const date = message.timestamp.toLocaleDateString();
      if (!groups[date]) {
        groups[date] = [];
      }
      groups[date].push(message);
      return groups;
    }, {} as Record<string, Message[]>);
  }, [messages]);

  if (messages.length === 0 && !isLoadingMore) {
    return (
      <div className={cn("flex-1 flex items-center justify-center p-8 text-center text-gray-500 dark:text-white/40", className)} {...props}>
        <div className="max-w-sm space-y-4">
          <div className="w-24 h-24 bg-blue-500/10 dark:bg-white/5 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse">
            <MessageSquare className="h-12 w-12 text-blue-500" />
          </div>
          <h3 className="text-xl font-medium text-gray-900 dark:text-white">No messages yet</h3>
          <p>Start the conversation by sending a message below.</p>
        </div>
      </div>
    );
  }

  return (
    <ScrollArea 
      className={cn("flex-1 p-4", className)} 
      onScroll={handleScroll}
      role="log"
      aria-live="polite"
      aria-relevant="additions"
      {...props}
    >
      <div className="space-y-6 pb-4">
        {hasMore && (
          <div className="flex justify-center py-4">
            {isLoadingMore ? (
              <div className="flex items-center gap-2 text-xs text-white/40">
                <div className="w-4 h-4 border-2 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin" />
                Loading older messages...
              </div>
            ) : (
              <button 
                onClick={onLoadMore}
                className="text-xs text-cyan-500/60 hover:text-cyan-500 transition-colors"
              >
                Load older messages
              </button>
            )}
          </div>
        )}

        {Object.entries(groupedMessages).map(([date, msgs]) => (
          <div key={date} className="space-y-4">
            <div className="flex justify-center sticky top-0 z-10 py-2">
              <span className="px-3 py-1 rounded-full bg-gray-100/80 dark:bg-white/5 text-[10px] uppercase tracking-wider font-bold text-gray-500 dark:text-white/40 backdrop-blur-md border border-white/5 shadow-sm">
                {date}
              </span>
            </div>
            
            <div className="space-y-1">
              {msgs.map((msg, index) => {
                const isOwn = msg.senderId === currentUserId;
                const prevMsg = msgs[index - 1];
                const nextMsg = msgs[index + 1];
                
                // Logic to group bubbles visually
                const isFirstInGroup = !prevMsg || prevMsg.senderId !== msg.senderId;
                const isLastInGroup = !nextMsg || nextMsg.senderId !== msg.senderId;

                return (
                  <MessageBubble 
                    key={msg.id} 
                    message={msg} 
                    isOwn={isOwn}
                    className={cn(
                      !isLastInGroup && "mb-0.5"
                    )}
                    onReply={onReply}
                    onReact={onReact}
                    onDelete={onDelete}
                  />
                );
              })}
            </div>
          </div>
        ))}
        <div ref={bottomRef} className="h-px" />
      </div>
    </ScrollArea>
  );
}



=== FILE: packages\ui\src\components\chat\types.ts ===

export type UserStatus = 'online' | 'offline' | 'away' | 'busy';

export interface User {
  id: string;
  name: string;
  avatar?: string;
  status?: UserStatus;
  lastSeen?: Date;
  bio?: string;
  phone?: string;
}

export type MessageType = 'text' | 'image' | 'file' | 'system';
export type MessageStatus = 'sending' | 'sent' | 'delivered' | 'read' | 'failed';

export interface ChatAttachment {
  id: string;
  type: 'image' | 'file';
  url: string;
  name?: string;
  size?: string;
}

export interface Message {
  id: string;
  content: string;
  senderId: string;
  timestamp: Date;
  status?: MessageStatus;
  type?: MessageType;
  attachments?: ChatAttachment[];
  replyToId?: string;
  reactions?: Record<string, string[]>;
}

export interface Conversation {
  id: string;
  user: User;
  lastMessage?: Message;
  unreadCount?: number;
  isTyping?: boolean;
}



=== FILE: packages\ui\src\components\data-display\Accordion.tsx ===

import React, { createContext, useContext, useState } from 'react';
import { cn } from '../../utils/cn';
import { ChevronDown } from 'lucide-react';

interface AccordionContextValue {
  value: string | string[];
  onValueChange: (value: string) => void;
  type: 'single' | 'multiple';
}

const AccordionContext = createContext<AccordionContextValue | undefined>(undefined);

export interface AccordionProps extends React.HTMLAttributes<HTMLDivElement> {
  type?: 'single' | 'multiple';
  defaultValue?: string | string[];
  value?: string | string[];
  onValueChange?: (value: string | string[]) => void;
  children: React.ReactNode;
}

export function Accordion({
  type = 'single',
  defaultValue,
  value,
  onValueChange,
  className,
  children,
  ...props
}: AccordionProps) {
  const [internalValue, setInternalValue] = useState<string | string[]>(
    defaultValue || (type === 'multiple' ? [] : '')
  );

  const currentValue = value !== undefined ? value : internalValue;

  const handleValueChange = (itemValue: string) => {
    let newValue: string | string[];

    if (type === 'multiple') {
      const arrayValue = Array.isArray(currentValue) ? currentValue : [];
      if (arrayValue.includes(itemValue)) {
        newValue = arrayValue.filter((v) => v !== itemValue);
      } else {
        newValue = [...arrayValue, itemValue];
      }
    } else {
      newValue = currentValue === itemValue ? '' : itemValue;
    }

    if (value === undefined) {
      setInternalValue(newValue);
    }
    
    onValueChange?.(newValue as any);
  };

  return (
    <AccordionContext.Provider
      value={{ value: currentValue, onValueChange: handleValueChange, type }}
    >
      <div className={cn("space-y-2", className)} {...props}>
        {children}
      </div>
    </AccordionContext.Provider>
  );
}

// Helper context for Item
const AccordionItemContext = createContext<{ value: string; isOpen: boolean }>({ value: '', isOpen: false });

export interface AccordionItemProps extends React.HTMLAttributes<HTMLDivElement> {
  value: string;
  children: React.ReactNode;
}

export function AccordionItem({ className, value, children, ...props }: AccordionItemProps) {
  const context = useContext(AccordionContext);
  const isOpen = Array.isArray(context?.value)
    ? context?.value.includes(value)
    : context?.value === value;

  return (
    <AccordionItemContext.Provider value={{ value, isOpen: !!isOpen }}>
      <div
        className={cn(
          "overflow-hidden rounded-2xl border border-gray-200 dark:border-white/5 bg-gray-50 dark:bg-white/[0.03] transition-all duration-200",
          isOpen && "bg-white dark:bg-white/[0.04] border-gray-300 dark:border-white/10",
          className
        )}
        {...props}
      >
        {children}
      </div>
    </AccordionItemContext.Provider>
  );
}

export interface AccordionTriggerProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  children: React.ReactNode;
}

export function AccordionTrigger({ className, children, ...props }: AccordionTriggerProps) {
  const context = useContext(AccordionContext);
  const { value, isOpen } = useContext(AccordionItemContext);
  
  return (
    <button
      type="button"
      onClick={() => context?.onValueChange(value)}
      aria-expanded={isOpen}
      aria-controls={`accordion-content-${value}`}
      id={`accordion-trigger-${value}`}
      className={cn(
        "flex w-full items-center justify-between px-4 py-3 text-sm font-medium text-gray-900 dark:text-white transition-all hover:text-gray-700 dark:hover:text-white/90 focus:outline-none",
        className
      )}
      {...props}
    >
      {children}
      <ChevronDown
        className={cn(
          "h-4 w-4 shrink-0 text-gray-400 dark:text-white/50 transition-transform duration-200",
          isOpen && "rotate-180 text-gray-900 dark:text-white"
        )}
      />
    </button>
  );
}

export interface AccordionContentProps extends React.HTMLAttributes<HTMLDivElement> {
  children: React.ReactNode;
}

export function AccordionContent({ className, children, ...props }: AccordionContentProps) {
  const { isOpen, value } = useContext(AccordionItemContext);

  if (!isOpen) return null;

  return (
    <div
      id={`accordion-content-${value}`}
      role="region"
      aria-labelledby={`accordion-trigger-${value}`}
      className={cn(
        "px-4 pb-3 pt-0 text-sm text-gray-600 dark:text-white/70 animate-in slide-in-from-top-1 fade-in duration-200",
        className
      )}
      {...props}
    >
      {children}
    </div>
  );
}



=== FILE: packages\ui\src\components\data-display\Avatar.tsx ===

import React, { useState, useEffect } from 'react';
import { cn } from '../../utils/cn';

interface AvatarProps extends React.HTMLAttributes<HTMLDivElement> {
  src?: string;
  alt?: string;
  fallback?: React.ReactNode;
  size?: 'sm' | 'md' | 'lg' | 'xl';
}

const sizeClasses = {
  sm: 'h-8 w-8 text-xs',
  md: 'h-10 w-10 text-sm',
  lg: 'h-14 w-14 text-base',
  xl: 'h-20 w-20 text-xl',
};

export const Avatar = React.forwardRef<HTMLDivElement, AvatarProps>(
  ({ className, src, alt, fallback, size = 'md', ...props }, ref) => {
    const [imageError, setImageError] = useState(false);

    useEffect(() => {
      setImageError(false);
    }, [src]);

    return (
      <div
        ref={ref}
        className={cn(
          "relative flex shrink-0 overflow-hidden rounded-full bg-gray-200 dark:bg-white/10",
          sizeClasses[size],
          className
        )}
        {...props}
      >
        {src && !imageError ? (
          <img
            src={src}
            alt={alt}
            className="aspect-square h-full w-full object-cover"
            onError={() => setImageError(true)}
          />
        ) : (
          <div className="flex h-full w-full items-center justify-center bg-gray-100 dark:bg-white/5 text-gray-600 dark:text-white/70 font-medium">
            {fallback || (alt ? alt.charAt(0).toUpperCase() : '?')}
          </div>
        )}
      </div>
    );
  }
);

Avatar.displayName = 'Avatar';



=== FILE: packages\ui\src\components\data-display\Calendar.tsx ===

import React, { useState } from 'react';
import { cn } from '../../utils/cn';
import { ChevronLeft, ChevronRight } from 'lucide-react';

export interface CalendarProps {
  className?: string;
  value?: Date;
  onChange?: (date: Date) => void;
  minDate?: Date;
  maxDate?: Date;
}

const DAYS = ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'];
const MONTHS = [
  'January', 'February', 'March', 'April', 'May', 'June',
  'July', 'August', 'September', 'October', 'November', 'December'
];

export function Calendar({ className, value, onChange, minDate, maxDate }: CalendarProps) {
  const [currentDate, setCurrentDate] = useState(value || new Date());
  const [viewDate, setViewDate] = useState(value || new Date());

  const getDaysInMonth = (year: number, month: number) => {
    return new Date(year, month + 1, 0).getDate();
  };

  const getFirstDayOfMonth = (year: number, month: number) => {
    return new Date(year, month, 1).getDay();
  };

  const handlePrevMonth = () => {
    setViewDate(new Date(viewDate.getFullYear(), viewDate.getMonth() - 1, 1));
  };

  const handleNextMonth = () => {
    setViewDate(new Date(viewDate.getFullYear(), viewDate.getMonth() + 1, 1));
  };

  const handleDateClick = (day: number) => {
    const newDate = new Date(viewDate.getFullYear(), viewDate.getMonth(), day);
    if (onChange) {
      onChange(newDate);
    }
    setCurrentDate(newDate);
  };

  const isSelected = (day: number) => {
    return value && 
      value.getDate() === day &&
      value.getMonth() === viewDate.getMonth() &&
      value.getFullYear() === viewDate.getFullYear();
  };

  const isToday = (day: number) => {
    const today = new Date();
    return today.getDate() === day &&
      today.getMonth() === viewDate.getMonth() &&
      today.getFullYear() === viewDate.getFullYear();
  };

  const renderDays = () => {
    const daysInMonth = getDaysInMonth(viewDate.getFullYear(), viewDate.getMonth());
    const firstDay = getFirstDayOfMonth(viewDate.getFullYear(), viewDate.getMonth());
    const days = [];

    // Empty cells for previous month
    for (let i = 0; i < firstDay; i++) {
      days.push(<div key={`empty-${i}`} className="h-9 w-9" />);
    }

    // Days of current month
    for (let day = 1; day <= daysInMonth; day++) {
      const selected = isSelected(day);
      const today = isToday(day);
      
      days.push(
        <button
          key={day}
          onClick={() => handleDateClick(day)}
          type="button"
          className={cn(
            "h-9 w-9 rounded-xl text-sm font-medium transition-all duration-200",
            "hover:bg-gray-100 dark:hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-gray-400 dark:focus:ring-white/20",
            selected && "bg-gray-900 text-white dark:bg-white dark:text-black shadow-md dark:shadow-[0_0_15px_rgba(255,255,255,0.3)] hover:bg-gray-800 dark:hover:bg-white/90",
            !selected && today && "bg-gray-100 dark:bg-white/5 text-gray-900 dark:text-white border border-gray-200 dark:border-white/10",
            !selected && !today && "text-gray-700 dark:text-white/70 hover:text-gray-900 dark:hover:text-white"
          )}
        >
          {day}
        </button>
      );
    }

    return days;
  };

  return (
    <div className={cn("p-4 bg-white dark:bg-black/40 backdrop-blur-xl border border-gray-200 dark:border-white/10 rounded-2xl w-fit", className)}>
      <div className="flex items-center justify-between mb-4 px-1">
        <div className="font-semibold text-gray-900 dark:text-white">
          {MONTHS[viewDate.getMonth()]} <span className="text-gray-500 dark:text-white/50">{viewDate.getFullYear()}</span>
        </div>
        <div className="flex gap-1">
          <button
            onClick={handlePrevMonth}
            type="button"
            className="p-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-white/10 text-gray-600 dark:text-white/70 hover:text-gray-900 dark:hover:text-white transition-colors"
          >
            <ChevronLeft className="h-4 w-4" />
          </button>
          <button
            onClick={handleNextMonth}
            type="button"
            className="p-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-white/10 text-gray-600 dark:text-white/70 hover:text-gray-900 dark:hover:text-white transition-colors"
          >
            <ChevronRight className="h-4 w-4" />
          </button>
        </div>
      </div>
      
      <div className="grid grid-cols-7 gap-1 mb-2 text-center">
        {DAYS.map(day => (
          <div key={day} className="h-9 w-9 flex items-center justify-center text-xs font-medium text-gray-400 dark:text-white/40">
            {day}
          </div>
        ))}
      </div>
      
      <div className="grid grid-cols-7 gap-1">
        {renderDays()}
      </div>
    </div>
  );
}



=== FILE: packages\ui\src\components\data-display\chart\AreaChart.tsx ===

import React from 'react';
import { useChart, normalize } from './Chart';
import { cn } from '../../../utils/cn';

export interface AreaChartProps {
  color?: 'cyan' | 'purple' | 'emerald' | 'amber' | 'rose';
  showValues?: boolean;
  animationDelay?: number;
  onValueClick?: (data: any) => void;
}

export function AreaChart({ 
  color = 'purple', 
  showValues = false, 
  animationDelay = 0,
  onValueClick 
}: AreaChartProps) {
  const { width, height, padding, data, maxValue, setHoveredIndex, hoveredIndex } = useChart();
  const chartWidth = width - padding.left - padding.right;
  const chartHeight = height - padding.top - padding.bottom;
  const itemWidth = chartWidth / (data.length - 1); // Points are on edges

  const colors = {
    cyan: { stroke: '#06b6d4', fill: 'rgba(6, 182, 212, 0.2)' },
    purple: { stroke: '#8b5cf6', fill: 'rgba(139, 92, 246, 0.2)' },
    emerald: { stroke: '#10b981', fill: 'rgba(16, 185, 129, 0.2)' },
    amber: { stroke: '#f59e0b', fill: 'rgba(245, 158, 11, 0.2)' },
    rose: { stroke: '#f43f5e', fill: 'rgba(244, 63, 94, 0.2)' },
  };

  const theme = colors[color];

  // Generate Path Data
  const points = data.map((point, i) => {
    const x = padding.left + itemWidth * i;
    const y = height - padding.bottom - normalize(point.value, maxValue, chartHeight);
    return { x, y };
  });

  // Simple Line Path
  const linePath = points.map((p, i) => (i === 0 ? `M ${p.x} ${p.y}` : `L ${p.x} ${p.y}`)).join(' ');

  // Area Path (closes the loop)
  const areaPath = `
    ${linePath}
    L ${width - padding.right} ${height - padding.bottom}
    L ${padding.left} ${height - padding.bottom}
    Z
  `;

  return (
    <g>
      {/* Area Fill */}
      <path
        d={areaPath}
        fill={theme.fill}
        style={{ 
            opacity: 0,
            animation: `fade-in 1s ease-out ${animationDelay}s forwards` 
        }}
      />

      {/* Stroke Line */}
      <path
        d={linePath}
        fill="none"
        stroke={theme.stroke}
        strokeWidth={3}
        strokeLinecap="round"
        strokeLinejoin="round"
        className="animate-draw-line"
        style={{
            strokeDasharray: 2000,
            strokeDashoffset: 2000,
            animation: `draw-line 2s ease-out ${animationDelay}s forwards`
        }}
      />

      {/* Interactive Points */}
      {points.map((p, i) => (
        <g 
            key={i} 
            onMouseEnter={() => setHoveredIndex(i)}
            onMouseLeave={() => setHoveredIndex(null)}
            onClick={() => onValueClick?.(data[i])}
            className={cn("cursor-crosshair", onValueClick && "cursor-pointer")}
        >
            {/* Invisible Hit Area */}
            <rect 
                x={p.x - itemWidth / 2} 
                y={padding.top} 
                width={itemWidth} 
                height={chartHeight} 
                fill="transparent" 
            />
            
            {/* Active Point Indicator */}
            {(hoveredIndex === i || showValues) && (
                <>
                    {hoveredIndex === i && (
                      <line
                          x1={p.x}
                          y1={padding.top}
                          x2={p.x}
                          y2={height - padding.bottom}
                          stroke="white"
                          strokeWidth={1}
                          strokeDasharray="4 4"
                          className="opacity-50"
                      />
                    )}
                    <circle
                        cx={p.x}
                        cy={p.y}
                        r={hoveredIndex === i ? 6 : 4}
                        fill={theme.stroke}
                        stroke="white"
                        strokeWidth={2}
                        style={{
                            transition: 'r 0.2s ease-out'
                        }}
                    />
                    {showValues && (
                      <text
                          x={p.x}
                          y={p.y - 12}
                          textAnchor="middle"
                          fill="white"
                          fontSize={12}
                          fontWeight={500}
                          style={{ 
                              opacity: 0,
                              animation: `fade-in-up 0.5s ease-out ${animationDelay + 1 + i * 0.1}s forwards`,
                              textShadow: '0 2px 4px rgba(0,0,0,0.5)'
                          }}
                      >
                          {data[i]?.value}
                      </text>
                    )}
                </>
            )}
        </g>
      ))}

      <style>{`
        @keyframes draw-line {
          to { stroke-dashoffset: 0; }
        }
        @keyframes fade-in {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        @keyframes fade-in-up {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }
      `}</style>
    </g>
  );
}



=== FILE: packages\ui\src\components\data-display\chart\BarChart.tsx ===

import React from 'react';
import { useChart, normalize } from './Chart';
import { cn } from '../../../utils/cn';

export interface BarChartProps {
  color?: 'cyan' | 'purple' | 'emerald' | 'amber' | 'rose';
  showValues?: boolean;
  animationDelay?: number;
  onValueClick?: (data: any) => void;
}

export function BarChart({ 
  color = 'cyan', 
  showValues = false, 
  animationDelay = 0,
  onValueClick 
}: BarChartProps) {
  const { width, height, padding, data, maxValue, setHoveredIndex, hoveredIndex } = useChart();
  const chartWidth = width - padding.left - padding.right;
  const chartHeight = height - padding.top - padding.bottom;
  const itemWidth = chartWidth / data.length;
  const barWidth = itemWidth * 0.6; // 60% of slot width

  const colors = {
    cyan: 'from-cyan-500 to-blue-600',
    purple: 'from-purple-500 to-indigo-600',
    emerald: 'from-emerald-500 to-teal-600',
    amber: 'from-amber-400 to-orange-600',
    rose: 'from-rose-500 to-pink-600',
  };

  return (
    <g>
      {data.map((point, i) => {
        const barHeight = normalize(point.value, maxValue, chartHeight);
        const x = padding.left + itemWidth * i + (itemWidth - barWidth) / 2;
        const y = height - padding.bottom - barHeight;
        const isHovered = hoveredIndex === i;
        const delay = i * 0.1 + animationDelay; // Slower stagger for smoothness

        return (
          <g 
            key={i} 
            onMouseEnter={() => setHoveredIndex(i)}
            onMouseLeave={() => setHoveredIndex(null)}
            onClick={() => onValueClick?.(point)}
            className={cn("cursor-pointer", onValueClick && "cursor-pointer")}
          >
            {/* Invisible hit area for easier hovering */}
            <rect
              x={padding.left + itemWidth * i}
              y={padding.top}
              width={itemWidth}
              height={chartHeight}
              fill="transparent"
            />
            
            {/* The Bar */}
            <rect
              x={x}
              y={y}
              width={barWidth}
              height={barHeight}
              rx={4}
              className={cn(
                "transition-all duration-300 ease-out",
                isHovered ? "brightness-125 filter" : "opacity-80"
              )}
              style={{
                transformOrigin: `center ${height - padding.bottom}px`,
                animation: `grow-up 0.8s cubic-bezier(0.16, 1, 0.3, 1) ${delay}s backwards`
              }}
            >
               {/* Gradient Definition would be better in defs, but inline style works for dynamic colors if needed. 
                   Here we use classes for gradients. */}
            </rect>
            
            {/* Gradient Overlay via Class */}
            <rect
               x={x}
               y={y}
               width={barWidth}
               height={barHeight}
               rx={4}
               className={cn("bg-gradient-to-b", colors[color])}
               style={{
                pointerEvents: 'none',
                transformOrigin: `center ${height - padding.bottom}px`,
                animation: `grow-up 0.8s cubic-bezier(0.16, 1, 0.3, 1) ${delay}s backwards`
               }}
            />

            {/* Value Label */}
            {showValues && (
              <text
                x={x + barWidth / 2}
                y={y - 8}
                textAnchor="middle"
                fill="white"
                fontSize={12}
                fontWeight={500}
                style={{ 
                  opacity: 0,
                  animation: `fade-in-up 0.5s ease-out ${delay + 0.4}s forwards`,
                  textShadow: '0 2px 4px rgba(0,0,0,0.5)'
                }}
              >
                {point.value}
              </text>
            )}
          </g>
        );
      })}
      <style>{`
        @keyframes grow-up {
          from { transform: scaleY(0); }
          to { transform: scaleY(1); }
        }
        @keyframes fade-in-up {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }
      `}</style>
    </g>
  );
}



=== FILE: packages\ui\src\components\data-display\chart\Chart.tsx ===

import React, { createContext, useContext, useState, useMemo } from 'react';
import { cn } from '../../../utils/cn';

// --- Types ---
export interface ChartDataPoint {
  label: string;
  value: number;
  [key: string]: any;
}

export interface ChartContextValue {
  width: number;
  height: number;
  data: ChartDataPoint[];
  maxValue: number;
  padding: { top: number; right: number; bottom: number; left: number };
  hoveredIndex: number | null;
  setHoveredIndex: (index: number | null) => void;
}

// --- Context ---
const ChartContext = createContext<ChartContextValue | undefined>(undefined);

export function useChart() {
  const context = useContext(ChartContext);
  if (!context) throw new Error('Chart components must be used within a ChartContainer');
  return context;
}

// --- Utils ---
export function normalize(value: number, max: number, height: number) {
  if (max === 0) return 0;
  return (value / max) * height;
}

// --- Components ---

export interface ChartContainerProps extends React.HTMLAttributes<HTMLDivElement> {
  data: ChartDataPoint[];
  height?: number;
  padding?: { top: number; right: number; bottom: number; left: number };
  children: React.ReactNode;
}

export function ChartContainer({
  data,
  height = 300,
  padding = { top: 20, right: 20, bottom: 40, left: 40 },
  className,
  children,
  ...props
}: ChartContainerProps) {
  const [hoveredIndex, setHoveredIndex] = useState<number | null>(null);
  const [containerWidth, setContainerWidth] = useState(0);
  const containerRef = React.useRef<HTMLDivElement>(null);

  // Responsive width
  React.useEffect(() => {
    if (!containerRef.current) return;
    const observer = new ResizeObserver((entries) => {
      if (entries[0]) {
        setContainerWidth(entries[0].contentRect.width);
      }
    });
    observer.observe(containerRef.current);
    return () => observer.disconnect();
  }, []);

  const maxValue = useMemo(() => {
    return Math.max(...data.map((d) => d.value)) * 1.1; // Add 10% headroom
  }, [data]);

  return (
    <ChartContext.Provider
      value={{
        width: containerWidth,
        height,
        data,
        maxValue,
        padding,
        hoveredIndex,
        setHoveredIndex,
      }}
    >
      <div
        ref={containerRef}
        className={cn("relative w-full select-none", className)}
        style={{ height }}
        {...props}
      >
        {containerWidth > 0 && (
          <svg
            width="100%"
            height="100%"
            viewBox={`0 0 ${containerWidth} ${height}`}
            className="overflow-visible"
          >
            {children}
          </svg>
        )}
      </div>
    </ChartContext.Provider>
  );
}

export function ChartGrid({ lines = 5 }: { lines?: number }) {
  const { width, height, padding } = useChart();
  const chartHeight = height - padding.top - padding.bottom;

  return (
    <g className="text-gray-200 dark:text-white/5">
      {Array.from({ length: lines + 1 }).map((_, i) => {
        const y = padding.top + (chartHeight / lines) * i;
        return (
          <line
            key={i}
            x1={padding.left}
            y1={y}
            x2={width - padding.right}
            y2={y}
            stroke="currentColor"
            strokeWidth={1}
            strokeDasharray="4 4"
          />
        );
      })}
    </g>
  );
}

export function ChartXAxis() {
  const { width, height, padding, data } = useChart();
  const chartWidth = width - padding.left - padding.right;
  const itemWidth = chartWidth / data.length;

  return (
    <g>
      {data.map((point, i) => {
        const x = padding.left + itemWidth * i + itemWidth / 2;
        const y = height - padding.bottom + 20;
        return (
          <text
            key={i}
            x={x}
            y={y}
            textAnchor="middle"
            className="fill-gray-400 dark:fill-white/40 text-xs font-medium"
          >
            {point.label}
          </text>
        );
      })}
    </g>
  );
}

export function ChartTooltip({ 
  renderTooltip 
}: { 
  renderTooltip?: (data: ChartDataPoint) => React.ReactNode 
}) {
  const { hoveredIndex, data, width, padding } = useChart();
  
  if (hoveredIndex === null) return null;

  const chartWidth = width - padding.left - padding.right;
  const itemWidth = chartWidth / data.length;
  const x = padding.left + itemWidth * hoveredIndex + itemWidth / 2;
  const point = data[hoveredIndex];

  if (!point) return null;

  // Simple default tooltip if none provided
  const content = renderTooltip ? renderTooltip(point) : (
    <div className="rounded-lg border border-gray-200 dark:border-white/10 bg-white/90 dark:bg-black/80 px-3 py-2 text-xs shadow-xl backdrop-blur-md">
      <div className="font-semibold text-gray-900 dark:text-white">{point.label}</div>
      <div className="text-gray-500 dark:text-white/70">Value: {point.value}</div>
    </div>
  );

  return (
    <foreignObject
      x={x - 75} // Center roughly (150px width assumed)
      y={0}
      width={150}
      height="100%"
      className="pointer-events-none overflow-visible"
    >
      <div className="flex h-full flex-col justify-center items-center">
         <div className="animate-in fade-in zoom-in-95 duration-200">
            {content}
         </div>
      </div>
    </foreignObject>
  );
}

export function ChartSkeleton() {
  return (
    <div className="w-full h-full flex items-end justify-between gap-2 p-4 animate-pulse bg-gray-100 dark:bg-white/[0.02] rounded-xl border border-gray-200 dark:border-white/5">
      {[...Array(6)].map((_, i) => (
        <div
          key={i}
          className="bg-gray-200 dark:bg-white/10 rounded-t-md w-full"
          style={{ height: `${Math.random() * 60 + 20}%` }}
        />
      ))}
    </div>
  );
}



=== FILE: packages\ui\src\components\data-display\chart\LineChart.tsx ===

import React from 'react';
import { useChart, normalize } from './Chart';
import { cn } from '../../../utils/cn';

export interface LineChartProps {
  color?: 'cyan' | 'purple' | 'emerald' | 'amber' | 'rose';
  showValues?: boolean;
  animationDelay?: number;
  curve?: 'linear' | 'smooth' | 'step';
  strokeWidth?: number;
  align?: 'center' | 'edge';
  onValueClick?: (data: any) => void;
}

export function LineChart({ 
  color = 'cyan', 
  showValues = false, 
  animationDelay = 0,
  curve = 'smooth',
  strokeWidth = 3,
  align = 'edge',
  onValueClick 
}: LineChartProps) {
  const { width, height, padding, data, maxValue, setHoveredIndex, hoveredIndex } = useChart();
  const chartWidth = width - padding.left - padding.right;
  const chartHeight = height - padding.top - padding.bottom;
  
  // Align 'center' matches BarChart (bands), 'edge' matches AreaChart (points)
  const itemWidth = align === 'center' 
    ? chartWidth / data.length 
    : chartWidth / (data.length - 1);

  const colors = {
    cyan: '#06b6d4',
    purple: '#8b5cf6',
    emerald: '#10b981',
    amber: '#f59e0b',
    rose: '#f43f5e',
  };

  const strokeColor = colors[color];

  // Generate Points
  const points = data.map((point, i) => {
    let x;
    if (align === 'center') {
      // Center of the band
      x = padding.left + itemWidth * i + itemWidth / 2;
    } else {
      // Edge
      x = padding.left + itemWidth * i;
    }
    
    const y = height - padding.bottom - normalize(point.value, maxValue, chartHeight);
    return { x, y };
  });

  // Generate Path Command
  let d = '';
  if (points.length > 0) {
    d = `M ${points[0]!.x} ${points[0]!.y}`;
    
    if (curve === 'smooth') {
      // Simple Catmull-Rom or Bezier approximation could go here, 
      // but for now let's use a simple cubic bezier strategy or just straight lines if complex.
      // Actually, let's do a simple smoothing by using midpoints for control points if requested,
      // or just standard SVG commands.
      // For simplicity and robustness without a library like d3-shape, let's stick to linear or a basic smooth approximation.
      
      // Basic smooth strategy: Cubic Bezier between points
      for (let i = 0; i < points.length - 1; i++) {
        const p0 = points[i]!;
        const p1 = points[i + 1]!;
        const cp1x = p0.x + (p1.x - p0.x) / 2;
        const cp1y = p0.y;
        const cp2x = p0.x + (p1.x - p0.x) / 2;
        const cp2y = p1.y;
        d += ` C ${cp1x} ${cp1y}, ${cp2x} ${cp2y}, ${p1.x} ${p1.y}`;
      }
    } else if (curve === 'step') {
      for (let i = 0; i < points.length - 1; i++) {
        const p0 = points[i]!;
        const p1 = points[i + 1]!;
        d += ` L ${p1.x} ${p0.y} L ${p1.x} ${p1.y}`;
      }
    } else {
      // Linear
      for (let i = 1; i < points.length; i++) {
        d += ` L ${points[i]!.x} ${points[i]!.y}`;
      }
    }
  }

  return (
    <g>
      {/* The Line */}
      <path
        d={d}
        fill="none"
        stroke={strokeColor}
        strokeWidth={strokeWidth}
        strokeLinecap="round"
        strokeLinejoin="round"
        className="animate-draw-line"
        style={{
            strokeDasharray: 3000,
            strokeDashoffset: 3000,
            animation: `draw-line 2.5s ease-out ${animationDelay}s forwards`
        }}
      />

      {/* Interactive Points */}
      {points.map((p, i) => (
        <g 
            key={i} 
            onMouseEnter={() => setHoveredIndex(i)}
            onMouseLeave={() => setHoveredIndex(null)}
            onClick={() => onValueClick?.(data[i])}
            className={cn("cursor-crosshair", onValueClick && "cursor-pointer")}
        >
            {/* Invisible Hit Area */}
            <rect 
                x={p.x - itemWidth / 2} 
                y={padding.top} 
                width={itemWidth} 
                height={chartHeight} 
                fill="transparent" 
            />
            
            {/* Active Point Indicator */}
            {(hoveredIndex === i || showValues) && (
                <>
                    {hoveredIndex === i && (
                      <line
                          x1={p.x}
                          y1={padding.top}
                          x2={p.x}
                          y2={height - padding.bottom}
                          stroke="white"
                          strokeWidth={1}
                          strokeDasharray="4 4"
                          className="opacity-50"
                      />
                    )}
                    <circle
                        cx={p.x}
                        cy={p.y}
                        r={hoveredIndex === i ? 6 : 4}
                        fill={strokeColor}
                        stroke="white"
                        strokeWidth={2}
                        style={{ transition: 'r 0.2s ease-out' }}
                    />
                    {showValues && (
                      <text
                          x={p.x}
                          y={p.y - 12}
                          textAnchor="middle"
                          fill="white"
                          fontSize={12}
                          fontWeight={500}
                          style={{ 
                              opacity: 0,
                              animation: `fade-in-up 0.5s ease-out ${animationDelay + 1 + i * 0.1}s forwards`,
                              textShadow: '0 2px 4px rgba(0,0,0,0.5)'
                          }}
                      >
                          {data[i]?.value}
                      </text>
                    )}
                </>
            )}
        </g>
      ))}

      <style>{`
        @keyframes draw-line {
          to { stroke-dashoffset: 0; }
        }
        @keyframes fade-in-up {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }
      `}</style>
    </g>
  );
}



=== FILE: packages\ui\src\components\data-display\chart\PieChart.tsx ===

import React, { useMemo } from 'react';
import { useChart } from './Chart';
import { cn } from '../../../utils/cn';

export interface PieChartProps {
  innerRadius?: number; // 0 for Pie, >0 for Donut (0-1 relative to radius, or absolute pixels?) Let's say 0-1 relative.
  padAngle?: number;
  showLabels?: boolean;
  colors?: string[];
}

export function PieChart({ 
  innerRadius = 0, 
  padAngle = 0.02, 
  showLabels = false,
  colors = ['#06b6d4', '#8b5cf6', '#10b981', '#f59e0b', '#f43f5e', '#3b82f6', '#ec4899']
}: PieChartProps) {
  const { width, height, data, setHoveredIndex, hoveredIndex } = useChart();
  
  const radius = Math.min(width, height) / 2 * 0.8; // 80% of half-size to leave room for labels/hover
  const centerX = width / 2;
  const centerY = height / 2;
  
  const total = useMemo(() => data.reduce((acc, cur) => acc + cur.value, 0), [data]);
  
  let currentAngle = 0;
  
  const slices = data.map((point, i) => {
    const percentage = point.value / total;
    const angle = percentage * 2 * Math.PI;
    
    const startAngle = currentAngle;
    const endAngle = currentAngle + angle;
    
    currentAngle += angle;
    
    return {
      ...point,
      startAngle,
      endAngle,
      color: colors[i % colors.length],
      percentage
    };
  });

  // Helper to get coordinates
  const getCoordinatesForPercent = (percent: number, r: number) => {
    const x = centerX + r * Math.cos(percent);
    const y = centerY + r * Math.sin(percent);
    return [x, y];
  };

  return (
    <g>
      {slices.map((slice, i) => {
        // Calculate path
        // We need to handle the gap (padAngle) if multiple slices
        const effectiveStartAngle = slice.startAngle + (slices.length > 1 ? padAngle / 2 : 0);
        const effectiveEndAngle = slice.endAngle - (slices.length > 1 ? padAngle / 2 : 0);
        
        // If the slice is too small due to padding, just skip or render a line? 
        // For simplicity, let's just clamp.
        if (effectiveEndAngle <= effectiveStartAngle) return null;

        const [startX, startY] = getCoordinatesForPercent(effectiveStartAngle, radius);
        const [endX, endY] = getCoordinatesForPercent(effectiveEndAngle, radius);
        
        const largeArcFlag = effectiveEndAngle - effectiveStartAngle > Math.PI ? 1 : 0;
        
        // Inner radius (for donut)
        const rInner = radius * innerRadius;
        const [innerStartX, innerStartY] = getCoordinatesForPercent(effectiveEndAngle, rInner);
        const [innerEndX, innerEndY] = getCoordinatesForPercent(effectiveStartAngle, rInner);

        const pathData = [
          `M ${startX} ${startY}`,
          `A ${radius} ${radius} 0 ${largeArcFlag} 1 ${endX} ${endY}`,
          innerRadius > 0 ? `L ${innerStartX} ${innerStartY}` : `L ${centerX} ${centerY}`,
          innerRadius > 0 ? `A ${rInner} ${rInner} 0 ${largeArcFlag} 0 ${innerEndX} ${innerEndY}` : '',
          'Z'
        ].join(' ');

        const isHovered = hoveredIndex === i;
        
        // Label position (centroid)
        const midAngle = (slice.startAngle + slice.endAngle) / 2;
        const labelRadius = radius * (innerRadius > 0 ? (1 + innerRadius) / 2 : 0.7);
        const [labelX, labelY] = getCoordinatesForPercent(midAngle, labelRadius);

        return (
          <g 
            key={i}
            onMouseEnter={() => setHoveredIndex(i)}
            onMouseLeave={() => setHoveredIndex(null)}
            className="cursor-pointer"
          >
            <path
              d={pathData}
              fill={slice.color}
              className={cn(
                "transition-all duration-300 ease-out",
                isHovered ? "opacity-100 brightness-110" : "opacity-90"
              )}
              style={{
                transformOrigin: `${centerX}px ${centerY}px`,
                transform: isHovered ? 'scale(1.05)' : 'scale(1)',
                animation: `pie-enter 0.6s ease-out ${i * 0.05}s backwards`
              }}
            />
            
            {(showLabels || isHovered) && (
              <text
                x={labelX}
                y={labelY}
                textAnchor="middle"
                dominantBaseline="middle"
                fill="white"
                fontSize={12}
                fontWeight={600}
                className="pointer-events-none"
                style={{ textShadow: '0 1px 2px rgba(0,0,0,0.5)' }}
              >
                {Math.round(slice.percentage * 100)}%
              </text>
            )}
          </g>
        );
      })}
      <style>{`
        @keyframes pie-enter {
          from { opacity: 0; transform: scale(0.8) rotate(-10deg); }
          to { opacity: 0.9; transform: scale(1) rotate(0); }
        }
      `}</style>
    </g>
  );
}



=== FILE: packages\ui\src\components\data-display\chart\RadarChart.tsx ===

import React, { useMemo, useState } from 'react';
import { cn } from '../../../utils/cn';

export interface RadarDataPoint {
  subject: string;
  [key: string]: any;
}

export interface RadarChartProps extends React.HTMLAttributes<HTMLDivElement> {
  data: RadarDataPoint[];
  keys: string[]; // Keys to plot (e.g. ['A', 'B'])
  colors?: string[]; // Colors for each key
  maxValue?: number;
  height?: number;
}

export function RadarChart({
  data,
  keys,
  colors = ['cyan', 'purple', 'emerald'],
  maxValue: userMaxValue,
  height = 300,
  className,
  ...props
}: RadarChartProps) {
  const [containerWidth, setContainerWidth] = useState(0);
  const containerRef = React.useRef<HTMLDivElement>(null);

  // Responsive width
  React.useEffect(() => {
    if (!containerRef.current) return;
    const observer = new ResizeObserver((entries) => {
      if (entries[0]) {
        setContainerWidth(entries[0].contentRect.width);
      }
    });
    observer.observe(containerRef.current);
    return () => observer.disconnect();
  }, []);

  const center = { x: containerWidth / 2, y: height / 2 };
  const radius = Math.min(containerWidth, height) / 2 - 40; // 40px padding

  const maxValue = useMemo(() => {
    if (userMaxValue) return userMaxValue;
    let max = 0;
    data.forEach(d => {
      keys.forEach(k => {
        if (d[k] > max) max = d[k];
      });
    });
    return max * 1.1;
  }, [data, keys, userMaxValue]);

  const angleSlice = (Math.PI * 2) / data.length;

  const colorMap: Record<string, string> = {
    cyan: 'rgba(6, 182, 212, 0.5)',
    purple: 'rgba(139, 92, 246, 0.5)',
    emerald: 'rgba(16, 185, 129, 0.5)',
    amber: 'rgba(245, 158, 11, 0.5)',
    rose: 'rgba(244, 63, 94, 0.5)',
  };
  
  const strokeMap: Record<string, string> = {
    cyan: '#06b6d4',
    purple: '#8b5cf6',
    emerald: '#10b981',
    amber: '#f59e0b',
    rose: '#f43f5e',
  };

  if (containerWidth === 0) return <div ref={containerRef} style={{ height }} />;

  return (
    <div
      ref={containerRef}
      className={cn("relative w-full select-none", className)}
      style={{ height }}
      {...props}
    >
      <svg width="100%" height="100%" viewBox={`0 0 ${containerWidth} ${height}`} className="overflow-visible">
        {/* Grid */}
        {[1, 2, 3, 4, 5].map((level) => {
          const levelRadius = (radius / 5) * level;
          const points = data.map((_, i) => {
            const angle = angleSlice * i - Math.PI / 2;
            return `${center.x + Math.cos(angle) * levelRadius},${center.y + Math.sin(angle) * levelRadius}`;
          }).join(' ');
          
          return (
            <polygon
              key={level}
              points={points}
              fill="none"
              stroke="rgba(255,255,255,0.1)"
              strokeWidth="1"
            />
          );
        })}

        {/* Axes & Labels */}
        {data.map((d, i) => {
          const angle = angleSlice * i - Math.PI / 2;
          const x = center.x + Math.cos(angle) * radius;
          const y = center.y + Math.sin(angle) * radius;
          
          // Label position (slightly outside)
          const labelX = center.x + Math.cos(angle) * (radius + 20);
          const labelY = center.y + Math.sin(angle) * (radius + 20);

          return (
            <g key={i}>
              <line
                x1={center.x}
                y1={center.y}
                x2={x}
                y2={y}
                stroke="rgba(255,255,255,0.1)"
                strokeWidth="1"
              />
              <text
                x={labelX}
                y={labelY}
                textAnchor="middle"
                dominantBaseline="middle"
                fill="rgba(255,255,255,0.6)"
                fontSize="12"
              >
                {d.subject}
              </text>
            </g>
          );
        })}

        {/* Data Polygons */}
        {keys.map((key, kIndex) => {
          const points = data.map((d, i) => {
            const value = d[key] || 0;
            const r = (value / maxValue) * radius;
            const angle = angleSlice * i - Math.PI / 2;
            return `${center.x + Math.cos(angle) * r},${center.y + Math.sin(angle) * r}`;
          }).join(' ');

          const colorName = colors[kIndex % colors.length] || 'cyan';
          const fill = colorMap[colorName];
          const stroke = strokeMap[colorName];

          return (
            <polygon
              key={key}
              points={points}
              fill={fill}
              fillOpacity={0.3}
              stroke={stroke}
              strokeWidth={2}
              className="transition-all duration-500 ease-out hover:fill-opacity-50"
            />
          );
        })}
      </svg>
    </div>
  );
}



=== FILE: packages\ui\src\components\data-display\chart\Sparkline.tsx ===

import React from 'react';
import { cn } from '../../../utils/cn';

export interface SparklineProps extends React.HTMLAttributes<HTMLDivElement> {
  data: number[];
  color?: 'cyan' | 'purple' | 'emerald' | 'amber' | 'rose' | 'white';
  height?: number;
  strokeWidth?: number;
  fill?: boolean;
}

export function Sparkline({
  data,
  color = 'emerald',
  height = 40,
  strokeWidth = 2,
  fill = false,
  className,
  ...props
}: SparklineProps) {
  const max = Math.max(...data);
  const min = Math.min(...data);
  const range = max - min || 1;

  const colors = {
    cyan: '#06b6d4',
    purple: '#8b5cf6',
    emerald: '#10b981',
    amber: '#f59e0b',
    rose: '#f43f5e',
    white: '#ffffff',
  };

  const strokeColor = colors[color];

  // Generate points
  // We assume width is 100% (viewBox 0 0 100 100) but we need aspect ratio.
  // To make it responsive without JS, we can use preserveAspectRatio="none" on the SVG
  // and map x from 0 to 100.
  
  const points = data.map((val, i) => {
    const x = (i / (data.length - 1)) * 100;
    // Invert Y because SVG 0 is top
    // Normalize value between 0 and 100 (height of viewBox)
    // Add some padding (5%) so stroke doesn't clip
    const normalized = ((val - min) / range);
    const y = 95 - (normalized * 90); 
    return { x, y };
  });

  let d = '';
  if (points.length > 0) {
    d = `M ${points[0]!.x} ${points[0]!.y}`;
    // Simple smoothing
    for (let i = 0; i < points.length - 1; i++) {
      const p0 = points[i]!;
      const p1 = points[i + 1]!;
      const cp1x = p0.x + (p1.x - p0.x) / 2;
      const cp1y = p0.y;
      const cp2x = p0.x + (p1.x - p0.x) / 2;
      const cp2y = p1.y;
      d += ` C ${cp1x} ${cp1y}, ${cp2x} ${cp2y}, ${p1.x} ${p1.y}`;
    }
  }

  const fillPath = fill 
    ? `${d} L 100 100 L 0 100 Z` 
    : undefined;

  return (
    <div 
      className={cn("w-full overflow-hidden", className)} 
      style={{ height }} 
      {...props}
    >
      <svg
        width="100%"
        height="100%"
        viewBox="0 0 100 100"
        preserveAspectRatio="none"
        className="overflow-visible"
      >
        {fill && (
          <path
            d={fillPath}
            fill={strokeColor}
            fillOpacity={0.1}
            stroke="none"
          />
        )}
        <path
          d={d}
          fill="none"
          stroke={strokeColor}
          strokeWidth={strokeWidth}
          strokeLinecap="round"
          strokeLinejoin="round"
          vectorEffect="non-scaling-stroke" // Keeps stroke width constant despite scaling
        />
      </svg>
    </div>
  );
}



=== FILE: packages\ui\src\components\data-display\chart\YAxis.tsx ===

import React from 'react';
import { useChart } from './Chart';

export interface YAxisProps {
  ticks?: number;
  format?: (value: number) => string;
}

export function ChartYAxis({ ticks = 5, format = (v) => v.toString() }: YAxisProps) {
  const { height, padding, maxValue } = useChart();
  const chartHeight = height - padding.top - padding.bottom;

  return (
    <g>
      {Array.from({ length: ticks + 1 }).map((_, i) => {
        const value = (maxValue / ticks) * i;
        const y = height - padding.bottom - (chartHeight / ticks) * i;
        
        return (
          <text
            key={i}
            x={padding.left - 10}
            y={y}
            textAnchor="end"
            dominantBaseline="middle"
            className="fill-gray-400 dark:fill-white/40 text-xs font-medium"
          >
            {format(Math.round(value))}
          </text>
        );
      })}
    </g>
  );
}



=== FILE: packages\ui\src\components\data-display\Collapse.tsx ===

import React, { useState, useRef, useEffect } from 'react';
import { cn } from '../../utils/cn';
import { ChevronDown } from 'lucide-react';

export interface CollapseProps extends Omit<React.HTMLAttributes<HTMLDivElement>, 'title'> {
  title?: React.ReactNode;
  open?: boolean;
  defaultOpen?: boolean;
  onOpenChange?: (open: boolean) => void;
  disabled?: boolean;
  children: React.ReactNode;
  triggerClassName?: string;
  contentClassName?: string;
}

export function Collapse({
  title,
  open: controlledOpen,
  defaultOpen = false,
  onOpenChange,
  disabled = false,
  children,
  className,
  triggerClassName,
  contentClassName,
  ...props
}: CollapseProps) {
  const [uncontrolledOpen, setUncontrolledOpen] = useState(defaultOpen);
  const isControlled = controlledOpen !== undefined;
  const isOpen = isControlled ? controlledOpen : uncontrolledOpen;

  const handleToggle = () => {
    if (disabled) return;
    const newState = !isOpen;
    if (!isControlled) {
      setUncontrolledOpen(newState);
    }
    onOpenChange?.(newState);
  };

  return (
    <div 
      className={cn(
        'w-full overflow-hidden rounded-xl border border-gray-200 bg-white dark:border-white/10 dark:bg-white/[0.02]',
        className
      )} 
      {...props}
    >
      {title && (
        <button
          type="button"
          onClick={handleToggle}
          disabled={disabled}
          className={cn(
            'flex w-full items-center justify-between px-4 py-3 text-sm font-medium transition-colors hover:bg-gray-50 dark:hover:bg-white/[0.02]',
            disabled && 'cursor-not-allowed opacity-50',
            triggerClassName
          )}
        >
          {title}
          <ChevronDown
            className={cn(
              'h-4 w-4 shrink-0 text-gray-500 transition-transform duration-200 dark:text-gray-400',
              isOpen && 'rotate-180'
            )}
          />
        </button>
      )}
      
      <div
        className={cn(
          'grid transition-all duration-300 ease-in-out',
          isOpen ? 'grid-rows-[1fr]' : 'grid-rows-[0fr]'
        )}
      >
        <div className="overflow-hidden">
          <div className={cn('px-4 pb-4 pt-0', title && 'pt-1', contentClassName)}>
            {children}
          </div>
        </div>
      </div>
    </div>
  );
}



=== FILE: packages\ui\src\components\data-display\DataTable.tsx ===

import React, { useState, useMemo } from 'react';
import { Search, ArrowUpDown, ArrowUp, ArrowDown } from 'lucide-react';
import { Table, TableHeader, TableBody, TableRow, TableHead, TableCell } from './Table';
import { TextInput } from '../form/TextInput';
import { cn } from '../../utils/cn';

export interface Column<T> {
  key: keyof T | string;
  header: string;
  sortable?: boolean;
  render?: (item: T) => React.ReactNode;
  className?: string;
}

interface DataTableProps<T> {
  data: T[];
  columns: Column<T>[];
  searchPlaceholder?: string;
  searchKeys?: (keyof T)[];
  onRowClick?: (item: T) => void;
  className?: string;
  maxHeight?: number;
  rounded?: boolean;
}

export function DataTable<T extends Record<string, unknown>>({
  data,
  columns,
  searchPlaceholder = "Search...",
  searchKeys,
  onRowClick,
  className,
  maxHeight,
  rounded = true
}: DataTableProps<T>) {
  const [search, setSearch] = useState('');
  const [sortConfig, setSortConfig] = useState<{ key: keyof T | string; direction: 'asc' | 'desc' | null }>({
    key: '',
    direction: null
  });

  // Optimized search and sort logic with useMemo
  const processedData = useMemo(() => {
    let filtered = [...data];

    // Search
    if (search && searchKeys) {
      filtered = filtered.filter(item =>
        searchKeys.some(key => 
          String(item[key] ?? '').toLowerCase().includes(search.toLowerCase())
        )
      );
    }

    // Sort
    if (sortConfig.key && sortConfig.direction) {
      filtered.sort((a, b) => {
        const aValue = a[sortConfig.key as keyof T];
        const bValue = b[sortConfig.key as keyof T];
        
        if (aValue === undefined || bValue === undefined) return 0;
        if (aValue < bValue) return sortConfig.direction === 'asc' ? -1 : 1;
        if (aValue > bValue) return sortConfig.direction === 'asc' ? 1 : -1;
        return 0;
      });
    }

    return filtered;
  }, [data, search, searchKeys, sortConfig]);

  const handleSort = (key: keyof T | string) => {
    setSortConfig(prev => ({
      key,
      direction: prev.key === key && prev.direction === 'asc' ? 'desc' : 'asc'
    }));
  };

  return (
    <div className={cn("space-y-4", className)}>
      {searchKeys && (
        <div className="relative max-w-sm">
          <TextInput
            placeholder={searchPlaceholder}
            value={search}
            onChange={(e) => setSearch(e.target.value)}
            leftIcon={<Search className="w-4 h-4 text-white/40" />}
          />
        </div>
      )}

      <Table rounded={rounded} maxHeight={maxHeight}>
        <TableHeader>
          <TableRow>
            {columns.map((col) => (
              <TableHead 
                key={String(col.key)} 
                className={cn(col.sortable && "cursor-pointer select-none hover:text-cyan-500 transition-colors", col.className)}
                onClick={() => col.sortable && handleSort(col.key)}
              >
                <div className="flex items-center gap-2">
                  {col.header}
                  {col.sortable && (
                    <span className="text-white/30">
                      {sortConfig.key === col.key ? (
                        sortConfig.direction === 'asc' ? <ArrowUp className="w-3 h-3 text-cyan-500" /> : <ArrowDown className="w-3 h-3 text-cyan-500" />
                      ) : (
                        <ArrowUpDown className="w-3 h-3" />
                      )}
                    </span>
                  )}
                </div>
              </TableHead>
            ))}
          </TableRow>
        </TableHeader>
        <TableBody>
          {processedData.map((item, idx) => (
            <TableRow 
              key={idx} 
              onClick={() => onRowClick?.(item)}
              className={cn(onRowClick && "cursor-pointer hover:bg-white/5 transition-colors group")}
            >
              {columns.map((col) => (
                <TableCell key={String(col.key)} className={col.className}>
                  {col.render ? col.render(item) : item[col.key as keyof T]}
                </TableCell>
              ))}
            </TableRow>
          ))}
          {processedData.length === 0 && (
            <TableRow>
              <TableCell colSpan={columns.length} className="h-32 text-center text-white/40">
                No results found for "{search}"
              </TableCell>
            </TableRow>
          )}
        </TableBody>
      </Table>
    </div>
  );
}



=== FILE: packages\ui\src\components\data-display\Image.tsx ===

import React, { useState } from 'react';
import { cn } from '../../utils/cn';
import { Skeleton } from '../feedback/Skeleton';

export interface ImageProps extends React.ImgHTMLAttributes<HTMLImageElement> {
  fallback?: React.ReactNode;
  containerClassName?: string;
}

export const Image = React.forwardRef<HTMLImageElement, ImageProps>(
  ({ className, containerClassName, alt, src, fallback, onLoad, onError, ...props }, ref) => {
    const [isLoading, setIsLoading] = useState(true);
    const [hasError, setHasError] = useState(false);

    const handleLoad = (e: React.SyntheticEvent<HTMLImageElement, Event>) => {
      setIsLoading(false);
      onLoad?.(e);
    };

    const handleError = (e: React.SyntheticEvent<HTMLImageElement, Event>) => {
      setIsLoading(false);
      setHasError(true);
      onError?.(e);
    };

    if (hasError && fallback) {
      return <>{fallback}</>;
    }

    return (
      <div className={cn("relative overflow-hidden rounded-2xl bg-gray-100 dark:bg-white/[0.02] border border-gray-200 dark:border-white/10", containerClassName)}>
        {isLoading && (
           <Skeleton className="absolute inset-0 h-full w-full" />
        )}
        <img
          ref={ref}
          src={src}
          alt={alt}
          onLoad={handleLoad}
          onError={handleError}
          className={cn(
            "h-full w-full object-cover transition-opacity duration-300",
            isLoading ? "opacity-0" : "opacity-100",
            className
          )}
          {...props}
        />
      </div>
    );
  }
);
Image.displayName = "Image";



=== FILE: packages\ui\src\components\data-display\Kanban.tsx ===

import React, { useState, useMemo, useCallback, useRef } from 'react';
import { cn } from '../../utils/cn';
import { Surface } from '../../primitives/Surface';
import { Badge } from '../../primitives/Badge';
import { Heading } from '../typography/Heading';
import { Text } from '../typography/Text';
import { Button } from '../button/Button';
import { Checkbox } from '../form/Checkbox';
import { Separator } from '../data-display/Separator';
import { 
  MoreHorizontal, 
  Plus, 
  GripVertical, 
  MessageSquare, 
  Paperclip, 
  Clock, 
  Trash2, 
  Archive, 
  AlertCircle,
  Lock,
  Play,
  Pause,
  CheckSquare,
  Calendar as CalendarIcon,
  Filter as FilterIcon,
  Settings
} from 'lucide-react';
import { Motion } from '../feedback/Motion';
import { MotionGroup } from '../feedback/MotionGroup';
import { 
  DropdownMenu, 
  DropdownMenuTrigger, 
  DropdownMenuContent,
  DropdownMenuItem
} from '../overlay/DropdownMenu';

export interface KanbanTask {
  id: string;
  title: string;
  description?: string;
  priority?: 'low' | 'medium' | 'high' | 'urgent';
  tags?: string[];
  assignee?: {
    name: string;
    avatar?: string;
  };
  comments?: number;
  attachments?: number;
  dueDate?: string;
  columnId: string;
  progress?: number; // 0 to 100
  blockedBy?: string[]; // IDs of tasks that block this one
  timeSpent?: number; // in seconds
  archived?: boolean;
  customFields?: Record<string, unknown>;
}

export interface KanbanColumn {
  id: string;
  title: string;
  color?: string;
  limit?: number; // WIP Limit
}

export interface KanbanProps {
  columns: KanbanColumn[];
  tasks: KanbanTask[];
  onTaskMove?: (taskId: string, toColumnId: string, newIndex?: number) => void;
  onColumnMove?: (columnId: string, newIndex: number) => void;
  onTaskClick?: (task: KanbanTask) => void;
  onTaskAdd?: (columnId: string, title?: string) => void;
  onTaskFullAdd?: (columnId: string) => void;
  onTaskTimerToggle?: (taskId: string) => void;
  onTaskSelectionChange?: (selectedIds: string[]) => void;
  onColumnAction?: (columnId: string) => void;
  renderCard?: (task: KanbanTask) => React.ReactNode;
  groupBy?: keyof KanbanTask;
  activeTimerTaskId?: string;
  selectedTaskIds?: string[];
  selectable?: boolean;
  showDividers?: boolean;
  className?: string;
  cardClassName?: string;
  columnClassName?: string;
  showTaskCount?: boolean;
  accentColor?: string;
}

export function Kanban({
  columns,
  tasks,
  onTaskMove,
  onColumnMove,
  onTaskClick,
  onTaskAdd,
  onTaskFullAdd,
  onTaskTimerToggle,
  onTaskSelectionChange,
  onColumnAction,
  renderCard,
  groupBy,
  activeTimerTaskId,
  selectedTaskIds = [],
  selectable = false,
  showDividers = false,
  className,
  cardClassName,
  columnClassName,
  showTaskCount = true,
  accentColor = 'cyan'
}: KanbanProps) {
  const [draggedTaskId, setDraggedTaskId] = useState<string | null>(null);
  const [draggedColumnId, setDraggedColumnId] = useState<string | null>(null);
  const [dragOverColumnId, setDragOverColumnId] = useState<string | null>(null);
  const [dragOverTaskId, setDragOverTaskId] = useState<string | null>(null);
  const [quickAddColumnId, setQuickAddColumnId] = useState<string | null>(null);
  const [quickAddValue, setQuickAddValue] = useState('');

  const tasksByGroupAndColumn = useMemo(() => {
    const groups: Record<string, Record<string, KanbanTask[]>> = {};
    
    // Initialize groups
    const groupValues = groupBy 
      ? Array.from(new Set(tasks.map(t => String(t[groupBy] || 'Uncategorized'))))
      : ['default'];

    groupValues.forEach(group => {
      groups[group] = {};
      columns.forEach(col => {
        groups[group]![col.id] = [];
      });
    });

    tasks.forEach(task => {
      const group = groupBy ? String(task[groupBy] || 'Uncategorized') : 'default';
      const colTasks = groups[group]?.[task.columnId];
      if (colTasks) {
        colTasks.push(task);
      }
    });

    return groups;
  }, [columns, tasks, groupBy]);

  const handleDragStart = (e: React.DragEvent, id: string, type: 'task' | 'column') => {
    e.dataTransfer.effectAllowed = 'move';
    e.dataTransfer.setData('text/plain', id);

    if (type === 'task') {
      e.dataTransfer.setData('taskId', id);
      // Delay setting state to allow browser to capture drag image
      setTimeout(() => {
        setDraggedTaskId(id);
      }, 0);
    } else {
      e.dataTransfer.setData('columnId', id);
      setTimeout(() => {
        setDraggedColumnId(id);
      }, 0);
    }
  };

  const handleDragEnd = () => {
    setDraggedTaskId(null);
    setDraggedColumnId(null);
    setDragOverColumnId(null);
    setDragOverTaskId(null);
  };

  const handleDragOver = (e: React.DragEvent, columnId: string, taskId?: string) => {
    e.preventDefault();
    e.dataTransfer.dropEffect = 'move';
    
    if (draggedColumnId) {
      setDragOverColumnId(columnId);
    } else {
      setDragOverColumnId(columnId);
      setDragOverTaskId(taskId || null);
    }
  };

  const handleDrop = (e: React.DragEvent, toColumnId: string, toTaskId?: string) => {
    e.preventDefault();
    const taskId = draggedTaskId || e.dataTransfer.getData('taskId');
    const columnId = draggedColumnId || e.dataTransfer.getData('columnId');

    if (columnId && onColumnMove) {
      const newIndex = columns.findIndex(c => c.id === toColumnId);
      onColumnMove(columnId, newIndex);
    } else if (taskId && onTaskMove) {
      const task = tasks.find(t => t.id === taskId);
      if (!task) return;

      const columnTasks = tasks.filter(t => t.columnId === toColumnId);
      let newIndex = columnTasks.length;
      
      if (toTaskId) {
        newIndex = columnTasks.findIndex(t => t.id === toTaskId);
      }

      onTaskMove(taskId, toColumnId, newIndex);
    }

    handleDragEnd();
  };

  const handleSetQuickAdd = (columnId: string, groupName: string = 'default') => {
    setQuickAddColumnId(`${groupName}-${columnId}`);
  };

  const handleQuickAdd = (columnId: string, groupName: string = 'default') => {
    if (quickAddValue.trim() && onTaskAdd) {
      onTaskAdd(columnId, quickAddValue.trim());
      setQuickAddValue('');
      setQuickAddColumnId(null);
    }
  };

  const handleKeyDown = (e: React.KeyboardEvent, taskId: string, columnId: string) => {
    if (e.key === ' ' || e.key === 'Enter') {
      e.preventDefault();
      if (draggedTaskId === taskId) {
        // Create a synthetic drag event or refactor handleDrop to accept taskId/columnId directly
        const taskIdToDrop = draggedTaskId;
        if (taskIdToDrop && onTaskMove) {
          onTaskMove(taskIdToDrop, columnId, 0);
        }
        handleDragEnd();
      } else {
        setDraggedTaskId(taskId);
      }
    }

    if (draggedTaskId === taskId) {
      const colIndex = columns.findIndex(c => c.id === columnId);
      
      // Find task index across all groups
      let taskIndex = -1;
      let currentGroupName = 'default';
      
      for (const [groupName, columnMap] of Object.entries(tasksByGroupAndColumn)) {
        const tasks = columnMap[columnId] || [];
        const idx = tasks.findIndex(t => t.id === taskId);
        if (idx !== -1) {
          taskIndex = idx;
          currentGroupName = groupName;
          break;
        }
      }

      if (e.key === 'ArrowRight' && colIndex < columns.length - 1) {
        onTaskMove?.(taskId, columns[colIndex + 1]!.id, 0);
      } else if (e.key === 'ArrowLeft' && colIndex > 0) {
        onTaskMove?.(taskId, columns[colIndex - 1]!.id, 0);
      } else if (e.key === 'ArrowDown') {
        onTaskMove?.(taskId, columnId, taskIndex + 1);
      } else if (e.key === 'ArrowUp' && taskIndex > 0) {
        onTaskMove?.(taskId, columnId, taskIndex - 1);
      }
    }
  };

  const getPriorityColor = (priority?: string) => {
    switch (priority) {
      case 'urgent': return 'danger';
      case 'high': return 'warning';
      case 'medium': return 'info';
      case 'low': return 'success';
      default: return 'neutral';
    }
  };

  // Memoized Task Card Component
  const TaskCard = useCallback(({ task, columnId }: { task: KanbanTask, columnId: string }) => {
    if (renderCard) return renderCard(task);

    return (
      <Surface 
        className={cn(
          "p-4 border border-white/10 bg-white/[0.03] hover:bg-white/[0.06] transition-all duration-200",
          task.blockedBy && task.blockedBy.length > 0 && "border-red-500/30 bg-red-500/[0.02]",
          selectedTaskIds.includes(task.id) && "ring-2 ring-cyan-500/50 bg-cyan-500/[0.02]",
          cardClassName
        )}
      >
        <div className="flex flex-col gap-3">
          <div className="flex items-start justify-between gap-2">
            <div className="flex items-center gap-2 min-w-0">
              {selectable && (
                <Checkbox 
                  checked={selectedTaskIds.includes(task.id)}
                  onChange={(e) => {
                    const checked = e.target.checked;
                    const newSelection = checked 
                      ? [...selectedTaskIds, task.id]
                      : selectedTaskIds.filter(id => id !== task.id);
                    onTaskSelectionChange?.(newSelection);
                  }}
                  onClick={(e) => e.stopPropagation()}
                  className="mr-1"
                />
              )}
              {task.blockedBy && task.blockedBy.length > 0 && (
                <Lock className="h-3.5 w-3.5 text-red-500 flex-shrink-0" />
              )}
              <Text className={cn(
                "font-medium text-sm leading-tight group-hover:text-cyan-400 transition-colors truncate",
                task.blockedBy && task.blockedBy.length > 0 && "text-red-400/80"
              )}>
                {task.title}
              </Text>
            </div>
            <GripVertical className="h-4 w-4 text-white/20 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0" />
          </div>

          {task.description && (
            <Text className="text-xs text-white/50 line-clamp-2">
              {task.description}
            </Text>
          )}

          {task.progress !== undefined && (
            <div className="space-y-1.5">
              <div className="flex items-center justify-between text-[10px]">
                <span className="text-white/30 uppercase font-bold tracking-wider">Progress</span>
                <span className="text-white/50">{task.progress}%</span>
              </div>
              <div className="h-1 w-full bg-white/5 rounded-full overflow-hidden">
                <div 
                  className="h-full bg-cyan-500 transition-all duration-500" 
                  style={{ width: `${task.progress}%` }}
                />
              </div>
            </div>
          )}

          <div className="flex flex-wrap gap-2 mt-1">
            {task.priority && (
              <Badge variant={getPriorityColor(task.priority)} className="text-[10px] px-1.5 py-0 uppercase font-bold">
                {task.priority}
              </Badge>
            )}
            {task.tags?.map(tag => (
              <Badge key={tag} variant="neutral" className="text-[10px] px-1.5 py-0 bg-white/5 border-white/5">
                {tag}
              </Badge>
            ))}
          </div>

          <div className="flex items-center justify-between mt-2 pt-3 border-t border-white/5">
            <div className="flex items-center gap-3 text-[10px] text-white/30">
              {task.timeSpent !== undefined && (
                <div className={cn(
                  "flex items-center gap-1 px-1.5 py-0.5 rounded-md transition-colors",
                  activeTimerTaskId === task.id ? "bg-cyan-500/20 text-cyan-400" : "bg-white/5"
                )}>
                  {activeTimerTaskId === task.id ? (
                    <Pause 
                      className="h-2.5 w-2.5 cursor-pointer hover:scale-110 transition-transform" 
                      onClick={(e) => {
                        e.stopPropagation();
                        onTaskTimerToggle?.(task.id);
                      }}
                    />
                  ) : (
                    <Play 
                      className="h-2.5 w-2.5 cursor-pointer hover:scale-110 transition-transform" 
                      onClick={(e) => {
                        e.stopPropagation();
                        onTaskTimerToggle?.(task.id);
                      }}
                    />
                  )}
                  <span className="font-mono">
                    {Math.floor(task.timeSpent / 3600)}h {Math.floor((task.timeSpent % 3600) / 60)}m
                  </span>
                </div>
              )}
              {task.comments !== undefined && (
                <div className="flex items-center gap-1">
                  <MessageSquare className="h-3 w-3" />
                  {task.comments}
                </div>
              )}
              {task.attachments !== undefined && (
                <div className="flex items-center gap-1">
                  <Paperclip className="h-3 w-3" />
                  {task.attachments}
                </div>
              )}
              {task.dueDate && (
                <div className="flex items-center gap-1">
                  <Clock className="h-3 w-3" />
                  {task.dueDate}
                </div>
              )}
            </div>
            
            {task.assignee && (
              <div className="flex -space-x-2">
                <div className="h-6 w-6 rounded-full border-2 border-[#0a0a0a] bg-white/10 flex items-center justify-center text-[10px] font-bold overflow-hidden">
                  {task.assignee.avatar ? (
                    <img src={task.assignee.avatar} alt={task.assignee.name} className="h-full w-full object-cover" />
                  ) : (
                    task.assignee.name[0]
                  )}
                </div>
              </div>
            )}
          </div>
        </div>
      </Surface>
    );
  }, [renderCard, selectedTaskIds, cardClassName, selectable, activeTimerTaskId, onTaskSelectionChange, onTaskTimerToggle]);

  return (
    <div className={cn("flex flex-col overflow-x-auto pb-4 min-h-[600px] scrollbar-thin scrollbar-thumb-white/10", className)}>
      {/* Column Headers (Sticky) */}
      <div className="flex sticky top-0 z-20 bg-[#0a0a0a]/80 backdrop-blur-md border-b border-white/10">
        {columns.map((column, idx) => {
          const columnTasks = tasks.filter(t => t.columnId === column.id);
          const isOverLimit = column.limit && columnTasks.length > column.limit;

          return (
            <div 
              key={column.id}
              className={cn(
                "flex-shrink-0 w-80 flex items-center justify-between px-6 py-4 group/header",
                showDividers && idx > 0 && "border-l border-white/10"
              )}
              onDragOver={(e) => handleDragOver(e, column.id)}
              onDrop={(e) => handleDrop(e, column.id)}
            >
              <div 
                draggable
                onDragStart={(e) => handleDragStart(e, column.id, 'column')}
                onDragEnd={handleDragEnd}
                className="flex items-center gap-2 cursor-grab active:cursor-grabbing flex-1"
              >
                <div 
                  className="w-2 h-2 rounded-full" 
                  style={{ backgroundColor: column.color || `var(--${accentColor}-500)` }} 
                />
                <Heading as="h4" className="text-sm font-semibold uppercase tracking-wider">
                  {column.title}
                </Heading>
                {showTaskCount && (
                  <Badge 
                    variant={isOverLimit ? "danger" : "neutral"} 
                    className={cn(
                      "ml-1 text-[10px] px-1.5 py-0",
                      !isOverLimit && "bg-white/5 border-white/10"
                    )}
                  >
                    {columnTasks.length}{column.limit ? ` / ${column.limit}` : ''}
                  </Badge>
                )}
                {isOverLimit && (
                  <AlertCircle className="h-3 w-3 text-red-500 animate-pulse" />
                )}
              </div>
              <div className="flex items-center gap-1 opacity-0 group-hover/header:opacity-100 transition-opacity">
                <Button 
                  variant="ghost" 
                  size="sm" 
                  className="h-8 w-8 p-0 hover:bg-white/5"
                  onClick={() => handleSetQuickAdd(column.id)}
                >
                  <Plus className="h-4 w-4" />
                </Button>
                
                <DropdownMenu>
                  <DropdownMenuTrigger className="h-8 w-8 p-0 hover:bg-white/5 rounded-lg flex items-center justify-center text-white/40 hover:text-white transition-colors">
                    <MoreHorizontal className="h-4 w-4" />
                  </DropdownMenuTrigger>
                  <DropdownMenuContent align="end" className="w-48 bg-[#1a1a1a] border border-white/10 p-1 shadow-2xl z-50">
                    <DropdownMenuItem 
                      onClick={() => onColumnAction?.(column.id)}
                      className="gap-2 text-xs text-white/70 hover:text-white"
                    >
                      <Settings className="h-3.5 w-3.5" /> Column Settings
                    </DropdownMenuItem>
                    <DropdownMenuItem className="gap-2 text-xs text-white/70 hover:text-white">
                      <Archive className="h-3.5 w-3.5" /> Archive All
                    </DropdownMenuItem>
                    <div className="h-px bg-white/5 my-1" />
                    <DropdownMenuItem className="gap-2 text-xs text-red-400 hover:text-red-300 hover:bg-red-500/10">
                      <Trash2 className="h-3.5 w-3.5" /> Delete Column
                    </DropdownMenuItem>
                  </DropdownMenuContent>
                </DropdownMenu>
              </div>
            </div>
          );
        })}
      </div>

      {/* Swimlanes / Groups */}
      {Object.entries(tasksByGroupAndColumn).map(([groupName, columnMap]) => (
        <div key={groupName} className="flex flex-col">
          {groupBy && (
            <div className="sticky top-[65px] z-10 flex items-center gap-3 px-6 py-2 bg-[#0a0a0a]/60 backdrop-blur-sm border-b border-white/5">
              <Badge variant="neutral" className="bg-white/10 border-white/10 text-[10px] uppercase font-bold tracking-widest px-3">
                {groupName}
              </Badge>
              <div className="h-px flex-1 bg-white/5" />
            </div>
          )}
          
          <div className="flex">
            {columns.map((column, idx) => (
              <div 
                key={column.id}
                className={cn(
                  "flex-shrink-0 w-80 flex flex-col gap-4 transition-all duration-200 min-h-[200px] p-3",
                  showDividers && idx > 0 && "border-l border-white/10",
                  draggedColumnId === column.id ? "opacity-20" : "opacity-100",
                  dragOverColumnId === column.id && draggedColumnId ? "bg-cyan-500/5" : "",
                  columnClassName
                )}
                onDragOver={(e) => handleDragOver(e, column.id)}
                onDrop={(e) => handleDrop(e, column.id)}
              >
                {/* Tasks Container */}
                <div 
                  className={cn(
                    "flex-1 flex flex-col gap-4 p-1 rounded-2xl transition-colors duration-200",
                    dragOverColumnId === column.id && !dragOverTaskId && !draggedColumnId ? "bg-white/[0.02] ring-2 ring-dashed ring-white/10" : ""
                  )}
                >
                  {(columnMap[column.id] || []).map((task) => (
                    <React.Fragment key={task.id}>
                      {/* Ghost Placeholder */}
                      {dragOverTaskId === task.id && draggedTaskId !== task.id && (
                        <div className="h-24 w-full rounded-2xl border-2 border-dashed border-white/10 bg-white/[0.01] mb-4 animate-pulse" />
                      )}
                      
                      <div
                        draggable
                        tabIndex={0}
                        role="listitem"
                        aria-grabbed={draggedTaskId === task.id}
                        onDragStart={(e) => handleDragStart(e, task.id, 'task')}
                        onDragEnd={handleDragEnd}
                        onDragOver={(e) => handleDragOver(e, column.id, task.id)}
                        onKeyDown={(e) => handleKeyDown(e, task.id, column.id)}
                        onClick={() => onTaskClick?.(task)}
                        className={cn(
                          "group relative cursor-grab active:cursor-grabbing focus:outline-none focus:ring-2 focus:ring-cyan-500/50 rounded-2xl transition-opacity",
                          draggedTaskId === task.id ? "opacity-20" : "opacity-100"
                        )}
                      >
                        <TaskCard task={task} columnId={column.id} />
                      </div>
                    </React.Fragment>
                  ))}

                  {/* Ghost Placeholder for end of column */}
                  {dragOverColumnId === column.id && !dragOverTaskId && draggedTaskId && (
                    <div className="h-24 w-full rounded-2xl border-2 border-dashed border-white/10 bg-white/[0.01] animate-pulse" />
                  )}
                  
                  {/* Quick Add Input */}
                  {quickAddColumnId === `${groupName}-${column.id}` ? (
                    <Surface className="p-2 border-cyan-500/50 bg-cyan-500/5 mt-2">
                      <textarea
                        autoFocus
                        className="w-full bg-transparent border-none focus:ring-0 text-sm resize-none p-1 placeholder:text-white/20"
                        placeholder="What needs to be done?"
                        rows={3}
                        value={quickAddValue}
                        onChange={(e) => setQuickAddValue(e.target.value)}
                        onKeyDown={(e) => {
                          if (e.key === 'Enter' && !e.shiftKey) {
                            e.preventDefault();
                            handleQuickAdd(column.id, groupName);
                          }
                          if (e.key === 'Escape') {
                            setQuickAddColumnId(null);
                            setQuickAddValue('');
                          }
                        }}
                      />
                      <div className="flex items-center justify-end gap-2 mt-2">
                        <Button variant="ghost" size="sm" onClick={() => setQuickAddColumnId(null)}>Cancel</Button>
                        <Button size="sm" onClick={() => handleQuickAdd(column.id, groupName)}>Add Task</Button>
                      </div>
                    </Surface>
                  ) : (
                    <div className="group/add relative mt-2">
                      <Button 
                        variant="ghost" 
                        className="w-full justify-start gap-2 text-white/40 hover:text-white/60 hover:bg-white/5 border border-dashed border-transparent hover:border-white/10 rounded-xl py-2"
                        onClick={() => handleSetQuickAdd(column.id, groupName)}
                      >
                        <Plus className="h-4 w-4" />
                        <span className="text-xs">Add Task</span>
                      </Button>
                      
                      <div className="absolute right-2 top-1/2 -translate-y-1/2 flex gap-1 opacity-0 group-hover/add:opacity-100 transition-opacity">
                        <Button 
                          size="sm" 
                          variant="secondary" 
                          className="h-7 px-2 text-[10px]"
                          onClick={(e) => {
                            e.stopPropagation();
                            handleSetQuickAdd(column.id, groupName);
                          }}
                        >
                          Quick
                        </Button>
                        <Button 
                          size="sm" 
                          variant="primary" 
                          className="h-7 px-2 text-[10px]"
                          onClick={(e) => {
                            e.stopPropagation();
                            onTaskFullAdd?.(column.id);
                          }}
                        >
                          Full
                        </Button>
                      </div>
                    </div>
                  )}

                  {/* Empty State */}
                  {(columnMap[column.id] || []).length === 0 && !quickAddColumnId && (
                    <div className="flex-1 flex items-center justify-center border-2 border-dashed border-white/5 rounded-2xl min-h-[60px]">
                      <Text className="text-[10px] text-white/10 uppercase tracking-widest">Empty</Text>
                    </div>
                  )}
                </div>
              </div>
            ))}
          </div>
        </div>
      ))}
    </div>
  );
}



=== FILE: packages\ui\src\components\data-display\KanbanCalendarView.tsx ===

import React, { useState } from 'react';
import { cn } from '../../utils/cn';
import { Surface } from '../../primitives/Surface';
import { Text } from '../typography/Text';
import { Button } from '../button/Button';
import { ChevronLeft, ChevronRight, Plus } from 'lucide-react';
import { KanbanTask } from './Kanban';

interface KanbanCalendarViewProps {
  tasks: KanbanTask[];
  onTaskClick?: (task: KanbanTask) => void;
  onAddTask?: (date: Date) => void;
  className?: string;
}

export function KanbanCalendarView({ 
  tasks, 
  onTaskClick, 
  onAddTask,
  className 
}: KanbanCalendarViewProps) {
  const [currentDate, setCurrentDate] = useState(new Date());

  const daysInMonth = (year: number, month: number) => new Date(year, month + 1, 0).getDate();
  const firstDayOfMonth = (year: number, month: number) => new Date(year, month, 1).getDay();

  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();
  const totalDays = daysInMonth(year, month);
  const startDay = firstDayOfMonth(year, month);

  const prevMonth = () => setCurrentDate(new Date(year, month - 1, 1));
  const nextMonth = () => setCurrentDate(new Date(year, month + 1, 1));

  const monthNames = [
    "January", "February", "March", "April", "May", "June",
    "July", "August", "September", "October", "November", "December"
  ];

  const days = [];
  // Add empty slots for previous month
  for (let i = 0; i < startDay; i++) {
    days.push(null);
  }
  // Add days of current month
  for (let i = 1; i <= totalDays; i++) {
    days.push(new Date(year, month, i));
  }

  const getTasksForDate = (date: Date) => {
    return tasks.filter(task => {
      if (!task.dueDate) return false;
      // Simple string matching for demo, in real app use proper date objects
      // Assuming dueDate is like "Dec 24" or ISO string
      const taskDate = new Date(task.dueDate);
      if (isNaN(taskDate.getTime())) {
        // Fallback for demo strings like "Dec 24"
        const currentYear = new Date().getFullYear();
        const d = new Date(`${task.dueDate} ${currentYear}`);
        return d.getDate() === date.getDate() && 
               d.getMonth() === date.getMonth() && 
               d.getFullYear() === date.getFullYear();
      }
      return taskDate.getDate() === date.getDate() && 
             taskDate.getMonth() === date.getMonth() && 
             taskDate.getFullYear() === date.getFullYear();
    });
  };

  return (
    <Surface className={cn("flex flex-col h-[700px] overflow-hidden", className)}>
      {/* Calendar Header */}
      <div className="flex items-center justify-between p-4 border-b border-white/10">
        <div className="flex flex-col">
          <Text className="text-xl font-bold text-white">{monthNames[month]} {year}</Text>
          <Text className="text-xs text-white/40 uppercase tracking-widest font-bold">Monthly Schedule</Text>
        </div>
        <div className="flex items-center gap-2">
          <Button variant="outline" size="sm" onClick={prevMonth}>
            <ChevronLeft className="h-4 w-4" />
          </Button>
          <Button variant="outline" size="sm" onClick={() => setCurrentDate(new Date())}>
            Today
          </Button>
          <Button variant="outline" size="sm" onClick={nextMonth}>
            <ChevronRight className="h-4 w-4" />
          </Button>
        </div>
      </div>

      {/* Weekdays Header */}
      <div className="grid grid-cols-7 border-b border-white/10 bg-white/[0.02]">
        {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
          <div key={day} className="py-2 text-center">
            <Text className="text-xs font-bold text-white/40 uppercase tracking-wider">{day}</Text>
          </div>
        ))}
      </div>

      {/* Calendar Grid */}
      <div className="flex-1 grid grid-cols-7 auto-rows-fr overflow-y-auto">
        {days.map((date, i) => {
          if (!date) return <div key={`empty-${i}`} className="border-r border-b border-white/5 bg-white/[0.01]" />;
          
          const dateTasks = getTasksForDate(date);
          const isToday = new Date().toDateString() === date.toDateString();

          return (
            <div 
              key={date.toISOString()} 
              className={cn(
                "group relative border-r border-b border-white/10 p-2 min-h-[100px] transition-colors hover:bg-white/[0.02]",
                isToday && "bg-cyan-500/[0.03]"
              )}
            >
              <div className="flex items-center justify-between mb-2">
                <span className={cn(
                  "text-sm font-medium w-7 h-7 flex items-center justify-center rounded-full transition-colors",
                  isToday ? "bg-cyan-500 text-white" : "text-white/60 group-hover:text-white"
                )}>
                  {date.getDate()}
                </span>
                <button 
                  onClick={() => onAddTask?.(date)}
                  className="opacity-0 group-hover:opacity-100 p-1 hover:bg-white/10 rounded-md transition-all text-white/40 hover:text-white"
                >
                  <Plus className="h-3 w-3" />
                </button>
              </div>

              <div className="space-y-1">
                {dateTasks.map(task => (
                  <div 
                    key={task.id}
                    onClick={() => onTaskClick?.(task)}
                    className={cn(
                      "px-2 py-1 text-[10px] rounded-md border cursor-pointer transition-all truncate",
                      task.priority === 'urgent' ? "bg-red-500/10 border-red-500/20 text-red-400" :
                      task.priority === 'high' ? "bg-orange-500/10 border-orange-500/20 text-orange-400" :
                      task.priority === 'medium' ? "bg-cyan-500/10 border-cyan-500/20 text-cyan-400" :
                      "bg-gray-500/10 border-gray-500/20 text-gray-400"
                    )}
                  >
                    {task.title}
                  </div>
                ))}
              </div>
            </div>
          );
        })}
      </div>
    </Surface>
  );
}



=== FILE: packages\ui\src\components\data-display\KanbanFilterBar.tsx ===

import React, { useState } from 'react';
import { Search, Filter, X, ChevronDown, Check } from 'lucide-react';
import { cn } from '../../utils/cn';
import { Surface } from '../../primitives/Surface';
import { Button } from '../button/Button';
import { Badge } from '../../primitives/Badge';
import { Popover, PopoverTrigger, PopoverContent } from '../overlay/Popover';
import { Command, CommandInput, CommandList, CommandItem, CommandGroup } from '../overlay/Command';

export interface FilterOption {
  label: string;
  value: string;
}

export interface KanbanFilterBarProps {
  onSearchChange?: (query: string) => void;
  onFilterChange?: (filters: Record<string, string[]>) => void;
  priorityOptions?: FilterOption[];
  tagOptions?: FilterOption[];
  assigneeOptions?: FilterOption[];
  className?: string;
}

export function KanbanFilterBar({
  onSearchChange,
  onFilterChange,
  priorityOptions = [],
  tagOptions = [],
  assigneeOptions = [],
  className
}: KanbanFilterBarProps) {
  const [search, setSearch] = useState('');
  const [activeFilters, setActiveFilters] = useState<Record<string, string[]>>({});

  const toggleFilter = (category: string, value: string) => {
    const current = activeFilters[category] || [];
    const next = current.includes(value)
      ? current.filter(v => v !== value)
      : [...current, value];
    
    const newFilters = { ...activeFilters, [category]: next };
    if (next.length === 0) delete newFilters[category];
    
    setActiveFilters(newFilters);
    onFilterChange?.(newFilters);
  };

  const clearFilters = () => {
    setActiveFilters({});
    onFilterChange?.({});
  };

  const activeCount = Object.values(activeFilters).flat().length;

  return (
    <Surface className={cn("p-2 flex flex-wrap items-center gap-3", className)}>
      <div className="relative flex-1 min-w-[200px]">
        <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-white/20" />
        <input 
          type="text"
          placeholder="Search tasks..."
          className="w-full pl-10 pr-4 py-2 text-sm rounded-xl border border-white/10 bg-white/5 focus:outline-none focus:ring-2 focus:ring-cyan-500/50 transition-all placeholder:text-white/20"
          value={search}
          onChange={(e) => {
            setSearch(e.target.value);
            onSearchChange?.(e.target.value);
          }}
        />
      </div>

      <div className="flex items-center gap-2">
        {/* Priority Filter */}
        <FilterPopover 
          label="Priority" 
          options={priorityOptions} 
          selected={activeFilters['priority'] || []}
          onSelect={(val) => toggleFilter('priority', val)}
        />

        {/* Tags Filter */}
        <FilterPopover 
          label="Tags" 
          options={tagOptions} 
          selected={activeFilters['tags'] || []}
          onSelect={(val) => toggleFilter('tags', val)}
        />

        {activeCount > 0 && (
          <Button 
            variant="ghost" 
            size="sm" 
            onClick={clearFilters}
            className="h-9 px-3 text-xs text-white/40 hover:text-white gap-2"
          >
            <X className="h-3.5 w-3.5" /> Clear Filters
            <Badge variant="neutral" className="bg-white/10 border-white/10 ml-1">
              {activeCount}
            </Badge>
          </Button>
        )}
      </div>
    </Surface>
  );
}

function FilterPopover({ label, options, selected, onSelect }: { 
  label: string; 
  options: FilterOption[]; 
  selected: string[];
  onSelect: (val: string) => void;
}) {
  return (
    <Popover>
      <PopoverTrigger 
        className={cn(
          "h-9 px-3 text-xs gap-2 border border-transparent hover:border-white/10 rounded-xl transition-all",
          selected.length > 0 ? "bg-cyan-500/10 text-cyan-400 border-cyan-500/20" : "text-white/60"
        )}
      >
        <Filter className="h-3.5 w-3.5" />
        {label}
        {selected.length > 0 && (
          <Badge variant="info" className="h-4 min-w-[16px] px-1 bg-cyan-500 text-black border-none">
            {selected.length}
          </Badge>
        )}
        <ChevronDown className="h-3.5 w-3.5 opacity-40" />
      </PopoverTrigger>
      <PopoverContent className="w-56 p-0 bg-[#1a1a1a] border-white/10 shadow-2xl">
        <Command>
          <CommandInput placeholder={`Search ${label}...`} />
          <CommandList>
            <CommandGroup>
              {options.map(opt => (
                <CommandItem 
                  key={opt.value} 
                  value={opt.value}
                  onSelect={() => onSelect(opt.value)}
                  className="flex items-center justify-between"
                >
                  <span>{opt.label}</span>
                  {selected.includes(opt.value) && <Check className="h-3.5 w-3.5 text-cyan-400" />}
                </CommandItem>
              ))}
            </CommandGroup>
          </CommandList>
        </Command>
      </PopoverContent>
    </Popover>
  );
}



=== FILE: packages\ui\src\components\data-display\KanbanTaskModal.tsx ===

import React, { useState, useEffect } from 'react';
import { Modal, ModalHeader, ModalTitle, ModalFooter } from '../overlay/Modal';
import { Button } from '../button/Button';
import { TextInput } from '../form/TextInput';
import { Textarea } from '../form/Textarea';
import { Select } from '../form/Select';
import { Label } from '../form/Label';
import { FileDropzone } from '../form/FileDropzone';
import { KanbanTask } from './Kanban';
import { X, Paperclip, Tag, AlertCircle } from 'lucide-react';

export interface KanbanTaskModalProps {
  isOpen: boolean;
  onClose: () => void;
  onSave: (task: Partial<KanbanTask>) => void;
  task?: KanbanTask;
  columnId?: string;
}

export function KanbanTaskModal({ isOpen, onClose, onSave, task, columnId }: KanbanTaskModalProps) {
  const [title, setTitle] = useState('');
  const [description, setDescription] = useState('');
  const [priority, setPriority] = useState<'low' | 'medium' | 'high' | 'urgent'>('medium');
  const [tags, setTags] = useState<string[]>([]);
  const [tagInput, setTagInput] = useState('');

  useEffect(() => {
    if (task) {
      setTitle(task.title || '');
      setDescription(task.description || '');
      setPriority(task.priority || 'medium');
      setTags(task.tags || []);
    } else {
      setTitle('');
      setDescription('');
      setPriority('medium');
      setTags([]);
    }
  }, [task, isOpen]);

  const handleSave = () => {
    if (!title.trim()) return;
    onSave({
      ...task,
      title,
      description,
      priority,
      tags,
      columnId: task?.columnId || columnId
    });
    onClose();
  };

  const addTag = () => {
    if (tagInput.trim() && !tags.includes(tagInput.trim())) {
      setTags([...tags, tagInput.trim()]);
      setTagInput('');
    }
  };

  const removeTag = (tagToRemove: string) => {
    setTags(tags.filter(t => t !== tagToRemove));
  };

  return (
    <Modal isOpen={isOpen} onClose={onClose}>
      <ModalHeader>
        <ModalTitle>{task ? 'Edit Task' : 'Create New Task'}</ModalTitle>
      </ModalHeader>
      
      <div className="space-y-6 py-4">
        <div className="space-y-2">
          <Label htmlFor="task-title">Title</Label>
          <TextInput 
            id="task-title"
            placeholder="What needs to be done?" 
            value={title}
            onChange={(e) => setTitle(e.target.value)}
            autoFocus
          />
        </div>

        <div className="space-y-2">
          <Label htmlFor="task-desc">Description</Label>
          <Textarea 
            id="task-desc"
            placeholder="Add more details..." 
            value={description}
            onChange={(e) => setDescription(e.target.value)}
            rows={4}
          />
        </div>

        <div className="grid grid-cols-2 gap-4">
          <div className="space-y-2">
            <Label>Priority</Label>
            <Select 
              options={[
                { label: 'Low', value: 'low' },
                { label: 'Medium', value: 'medium' },
                { label: 'High', value: 'high' },
                { label: 'Urgent', value: 'urgent' },
              ]}
              value={priority}
              onChange={(val) => setPriority(val as any)}
            />
          </div>

          <div className="space-y-2">
            <Label>Tags</Label>
            <div className="flex gap-2">
              <TextInput 
                placeholder="Add tag..." 
                value={tagInput}
                onChange={(e) => setTagInput(e.target.value)}
                onKeyDown={(e) => e.key === 'Enter' && (e.preventDefault(), addTag())}
              />
              <Button variant="outline" onClick={addTag} type="button">Add</Button>
            </div>
            <div className="flex flex-wrap gap-2 mt-2">
              {tags.map(tag => (
                <span key={tag} className="flex items-center gap-1 px-2 py-1 rounded-lg bg-white/5 border border-white/10 text-xs text-white/70">
                  {tag}
                  <X size={12} className="cursor-pointer hover:text-white" onClick={() => removeTag(tag)} />
                </span>
              ))}
            </div>
          </div>
        </div>

        <div className="space-y-2">
          <Label>Attachments</Label>
          <FileDropzone 
            onDrop={(files: File[]) => console.log('Files selected:', files)}
            className="border-dashed border-white/10 bg-white/[0.02]"
          />
        </div>
      </div>

      <ModalFooter>
        <Button variant="ghost" onClick={onClose}>Cancel</Button>
        <Button variant="primary" onClick={handleSave} disabled={!title.trim()}>
          {task ? 'Save Changes' : 'Create Task'}
        </Button>
      </ModalFooter>
    </Modal>
  );
}



=== FILE: packages\ui\src\components\data-display\Marquee.tsx ===

import React from 'react';
import { cn } from '../../utils/cn';

export interface MarqueeProps extends React.HTMLAttributes<HTMLDivElement> {
  pauseOnHover?: boolean;
  direction?: 'left' | 'right';
  speed?: 'slow' | 'normal' | 'fast';
  children: React.ReactNode;
}

export const Marquee = ({ 
  className, 
  pauseOnHover = false, 
  direction = 'left', 
  speed = 'normal',
  children, 
  ...props 
}: MarqueeProps) => {
  
  const speeds = {
    slow: "40s",
    normal: "20s",
    fast: "10s",
  };

  return (
    <div 
      className={cn("group flex overflow-hidden p-2 [--gap:1rem] [gap:var(--gap)]", className)} 
      {...props}
    >
      <div 
        className={cn(
          "flex shrink-0 justify-around [gap:var(--gap)] min-w-full",
          direction === 'left' ? "animate-marquee" : "animate-marquee-reverse",
          pauseOnHover && "group-hover:[animation-play-state:paused]"
        )}
        style={{ animationDuration: speeds[speed] }}
      >
        {children}
      </div>
      <div 
        aria-hidden="true"
        className={cn(
          "flex shrink-0 justify-around [gap:var(--gap)] min-w-full",
          direction === 'left' ? "animate-marquee" : "animate-marquee-reverse",
          pauseOnHover && "group-hover:[animation-play-state:paused]"
        )}
        style={{ animationDuration: speeds[speed] }}
      >
        {children}
      </div>
      <style>{`
        @keyframes marquee {
          from { transform: translateX(0); }
          to { transform: translateX(calc(-100% - var(--gap))); }
        }
        @keyframes marquee-reverse {
          from { transform: translateX(calc(-100% - var(--gap))); }
          to { transform: translateX(0); }
        }
        .animate-marquee {
          animation: marquee linear infinite;
        }
        .animate-marquee-reverse {
          animation: marquee-reverse linear infinite;
        }
      `}</style>
    </div>
  );
};



=== FILE: packages\ui\src\components\data-display\ScrollArea.tsx ===

import React from 'react';
import { cn } from '../../utils/cn';

export interface ScrollAreaProps extends React.HTMLAttributes<HTMLDivElement> {
  orientation?: 'vertical' | 'horizontal' | 'both';
  scrollbarSize?: 'sm' | 'md' | 'lg';
}

export const ScrollArea = React.forwardRef<HTMLDivElement, ScrollAreaProps>(
  ({ className, children, orientation = 'vertical', scrollbarSize = 'sm', ...props }, ref) => {
    return (
      <div
        ref={ref}
        className={cn(
          'overflow-auto',
          // Scrollbar base styles
          '[&::-webkit-scrollbar]:bg-transparent',
          '[&::-webkit-scrollbar-thumb]:bg-gray-300 dark:[&::-webkit-scrollbar-thumb]:bg-white/10',
          '[&::-webkit-scrollbar-thumb]:rounded-full',
          'hover:[&::-webkit-scrollbar-thumb]:bg-gray-400 dark:hover:[&::-webkit-scrollbar-thumb]:bg-white/20',
          '[&::-webkit-scrollbar-track]:bg-transparent',
          
          // Firefox support
          '[scrollbar-width:thin] [scrollbar-color:rgba(0,0,0,0.2)_transparent] dark:[scrollbar-color:rgba(255,255,255,0.1)_transparent]',
          
          // Orientation specific
          orientation === 'vertical' && 'overflow-y-auto overflow-x-hidden',
          orientation === 'horizontal' && 'overflow-x-auto overflow-y-hidden',
          orientation === 'both' && 'overflow-auto',

          // Size specific
          scrollbarSize === 'sm' && '[&::-webkit-scrollbar]:w-1.5 [&::-webkit-scrollbar]:h-1.5',
          scrollbarSize === 'md' && '[&::-webkit-scrollbar]:w-2.5 [&::-webkit-scrollbar]:h-2.5',
          scrollbarSize === 'lg' && '[&::-webkit-scrollbar]:w-4 [&::-webkit-scrollbar]:h-4',
          
          className
        )}
        {...props}
      >
        {children}
      </div>
    );
  }
);

ScrollArea.displayName = 'ScrollArea';



=== FILE: packages\ui\src\components\data-display\Separator.tsx ===

import React from 'react';
import { cva, type VariantProps } from 'class-variance-authority';
import { cn } from '../../utils/cn';

const separatorVariants = cva(
  "shrink-0 bg-gray-200 dark:bg-white/10",
  {
    variants: {
      orientation: {
        horizontal: "h-[1px] w-full",
        vertical: "h-full w-[1px]",
      },
    },
    defaultVariants: {
      orientation: "horizontal",
    },
  }
);

export interface SeparatorProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof separatorVariants> {
  orientation?: "horizontal" | "vertical";
  decorative?: boolean;
}

export const Separator = React.forwardRef<HTMLDivElement, SeparatorProps>(
  (
    { className, orientation = "horizontal", decorative = true, ...props },
    ref
  ) => (
    <div
      ref={ref}
      role={decorative ? "none" : "separator"}
      aria-orientation={decorative ? undefined : orientation}
      className={cn(separatorVariants({ orientation, className }))}
      {...props}
    />
  )
);
Separator.displayName = "Separator";



=== FILE: packages\ui\src\components\data-display\StatusDot.tsx ===

import React from 'react';
import { cva, type VariantProps } from 'class-variance-authority';
import { cn } from '../../utils/cn';

const statusDotVariants = cva(
  "inline-block rounded-full",
  {
    variants: {
      variant: {
        success: "bg-emerald-500",
        warning: "bg-amber-500",
        error: "bg-rose-500",
        info: "bg-blue-500",
        neutral: "bg-gray-400",
      },
      size: {
        sm: "h-2 w-2",
        md: "h-2.5 w-2.5",
        lg: "h-3 w-3",
      },
      animate: {
        true: "animate-pulse",
        false: "",
      }
    },
    defaultVariants: {
      variant: "neutral",
      size: "md",
      animate: false,
    }
  }
);

export interface StatusDotProps extends React.HTMLAttributes<HTMLSpanElement>, VariantProps<typeof statusDotVariants> {}

export const StatusDot = React.forwardRef<HTMLSpanElement, StatusDotProps>(
  ({ className, variant, size, animate, ...props }, ref) => {
    return (
      <span
        ref={ref}
        className={cn(statusDotVariants({ variant, size, animate, className }))}
        {...props}
      />
    );
  }
);
StatusDot.displayName = "StatusDot";



=== FILE: packages\ui\src\components\data-display\Table.tsx ===

import React from 'react';
import { cn } from '../../utils/cn';
import { ScrollArea } from './ScrollArea';

interface TableContextValue {
  // Add context values if needed in the future
}

const TableContext = React.createContext<TableContextValue | null>(null);

export interface TableProps extends React.HTMLAttributes<HTMLTableElement> {
  wrapperClassName?: string;
  rounded?: boolean;
  maxHeight?: string | number;
}

export const Table = React.forwardRef<HTMLTableElement, TableProps>(
  ({ className, wrapperClassName, rounded = false, maxHeight, ...props }, ref) => (
    <ScrollArea 
      className={cn("w-full", rounded && "rounded-2xl border border-white/10", wrapperClassName)}
      style={{ maxHeight }}
      orientation={maxHeight ? "both" : "horizontal"}
      scrollbarSize="sm"
    >
      <table
        ref={ref}
        className={cn('w-full caption-bottom text-sm text-left', className)}
        {...props}
      />
    </ScrollArea>
  )
);
Table.displayName = 'Table';

export const TableHeader = React.forwardRef<HTMLTableSectionElement, React.HTMLAttributes<HTMLTableSectionElement>>(
  ({ className, ...props }, ref) => (
    <thead ref={ref} className={cn('bg-white/[0.02] text-white/55', className)} {...props} />
  )
);
TableHeader.displayName = 'TableHeader';

export const TableBody = React.forwardRef<HTMLTableSectionElement, React.HTMLAttributes<HTMLTableSectionElement>>(
  ({ className, ...props }, ref) => (
    <tbody ref={ref} className={cn('[&_tr:last-child]:border-0', className)} {...props} />
  )
);
TableBody.displayName = 'TableBody';

export interface TableRowProps extends React.HTMLAttributes<HTMLTableRowElement> {
  hoverable?: boolean;
  optimized?: boolean;
}

export const TableRow = React.forwardRef<HTMLTableRowElement, TableRowProps>(
  ({ className, hoverable = true, optimized = false, ...props }, ref) => (
    <tr
      ref={ref}
      className={cn(
        'border-t border-white/10 transition-colors data-[state=selected]:bg-white/[0.04]',
        hoverable && 'hover:bg-white/[0.02]',
        className
      )}
      style={optimized ? {
        contentVisibility: 'auto',
        containIntrinsicSize: '0 56px', // Estimated row height
      } : undefined}
      {...props}
    />
  )
);
TableRow.displayName = 'TableRow';

export const TableHead = React.forwardRef<HTMLTableCellElement, React.ThHTMLAttributes<HTMLTableCellElement>>(
  ({ className, ...props }, ref) => (
    <th
      ref={ref}
      className={cn(
        'h-10 px-5 py-3 text-left align-middle font-semibold text-white/55 [&:has([role=checkbox])]:pr-0 whitespace-nowrap',
        className
      )}
      {...props}
    />
  )
);
TableHead.displayName = 'TableHead';

export const TableCell = React.forwardRef<HTMLTableCellElement, React.TdHTMLAttributes<HTMLTableCellElement>>(
  ({ className, ...props }, ref) => (
    <td
      ref={ref}
      className={cn('p-5 align-middle [&:has([role=checkbox])]:pr-0 text-white/85 whitespace-nowrap', className)}
      {...props}
    />
  )
);
TableCell.displayName = 'TableCell';



=== FILE: packages\ui\src\components\data-display\Terminal.tsx ===

import React from 'react';
import { cn } from '../../utils/cn';

export interface TerminalProps extends React.HTMLAttributes<HTMLDivElement> {
  title?: string;
  children: React.ReactNode;
}

export const Terminal = React.forwardRef<HTMLDivElement, TerminalProps>(
  ({ className, title = "Terminal", children, ...props }, ref) => {
    return (
      <div
        ref={ref}
        className={cn(
          "overflow-hidden rounded-xl border border-gray-200 bg-gray-950 shadow-xl dark:border-white/10",
          className
        )}
        {...props}
      >
        <div className="flex items-center justify-between border-b border-white/10 bg-white/5 px-4 py-2">
          <div className="flex items-center gap-1.5">
            <div className="h-3 w-3 rounded-full bg-rose-500/80" />
            <div className="h-3 w-3 rounded-full bg-amber-500/80" />
            <div className="h-3 w-3 rounded-full bg-emerald-500/80" />
          </div>
          <div className="text-xs font-medium text-white/50">{title}</div>
          <div className="w-10" /> {/* Spacer for centering */}
        </div>
        <div className="p-4 font-mono text-sm text-gray-300">
          {children}
        </div>
      </div>
    );
  }
);
Terminal.displayName = "Terminal";

export const TerminalLine = ({ children, prefix = "$", className }: { children: React.ReactNode, prefix?: string, className?: string }) => (
  <div className={cn("flex gap-2", className)}>
    <span className="select-none text-emerald-400">{prefix}</span>
    <span>{children}</span>
  </div>
);



=== FILE: packages\ui\src\components\data-display\Timeline.tsx ===

import React from 'react';
import { cva, type VariantProps } from 'class-variance-authority';
import { cn } from '../../utils/cn';

const timelineItemVariants = cva(
  "relative pl-8 pb-8 last:pb-0",
  {
    variants: {
      status: {
        default: "[&>div:first-child]:bg-gray-200 dark:[&>div:first-child]:bg-white/20",
        active: "[&>div:first-child]:bg-blue-500",
        success: "[&>div:first-child]:bg-emerald-500",
        error: "[&>div:first-child]:bg-rose-500",
      }
    },
    defaultVariants: {
      status: "default"
    }
  }
);

export interface TimelineItemProps extends React.HTMLAttributes<HTMLDivElement>, VariantProps<typeof timelineItemVariants> {
  title: string;
  date?: string;
  description?: React.ReactNode;
  icon?: React.ReactNode;
  isLast?: boolean;
}

export const TimelineItem = React.forwardRef<HTMLDivElement, TimelineItemProps>(
  ({ className, status, title, date, description, icon, isLast, ...props }, ref) => {
    return (
      <div ref={ref} className={cn(timelineItemVariants({ status, className }))} {...props}>
        {/* Line */}
        {!isLast && (
          <div className="absolute left-[11px] top-[24px] bottom-0 w-px bg-gray-200 dark:bg-white/10" />
        )}
        
        {/* Dot / Icon */}
        <div className={cn(
          "absolute left-0 top-1.5 flex h-6 w-6 items-center justify-center rounded-full border-2 border-white dark:border-black ring-1 ring-transparent transition-colors",
          status === 'active' ? "bg-blue-500 ring-blue-500/30" : 
          status === 'success' ? "bg-emerald-500 ring-emerald-500/30" :
          status === 'error' ? "bg-rose-500 ring-rose-500/30" :
          "bg-gray-200 dark:bg-white/20"
        )}>
          {icon && <span className="text-white text-[10px]">{icon}</span>}
        </div>

        <div className="flex flex-col gap-1">
          <div className="flex items-center gap-2">
            <span className="text-sm font-medium text-gray-900 dark:text-white">{title}</span>
            {date && <span className="text-xs text-gray-500 dark:text-white/40">{date}</span>}
          </div>
          {description && (
            <div className="text-sm text-gray-600 dark:text-gray-400">
              {description}
            </div>
          )}
        </div>
      </div>
    );
  }
);
TimelineItem.displayName = 'TimelineItem';

export const Timeline = ({ children, className }: { children: React.ReactNode, className?: string }) => {
  return <div className={cn("flex flex-col", className)}>{children}</div>;
};



=== FILE: packages\ui\src\components\data-display\Tree.tsx ===

import React, { useState } from 'react';
import { ChevronRight, ChevronDown, Folder, File, FolderOpen } from 'lucide-react';
import { cn } from '../../utils/cn';

export interface TreeNode {
  id: string;
  label: string;
  icon?: React.ReactNode;
  children?: TreeNode[];
}

export interface TreeProps {
  data: TreeNode[];
  className?: string;
  onSelect?: (node: TreeNode) => void;
}

const TreeNodeItem = ({ node, depth = 0, onSelect }: { node: TreeNode; depth?: number; onSelect?: (node: TreeNode) => void }) => {
  const [isOpen, setIsOpen] = useState(false);
  const hasChildren = node.children && node.children.length > 0;

  const handleToggle = (e: React.MouseEvent) => {
    e.stopPropagation();
    if (hasChildren) {
      setIsOpen(!isOpen);
    }
    onSelect?.(node);
  };

  return (
    <div>
      <div
        className={cn(
          "flex items-center gap-2 rounded-lg px-2 py-1.5 text-sm text-gray-700 transition-colors hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-white/5 cursor-pointer",
        )}
        style={{ paddingLeft: `${depth * 12 + 8}px` }}
        onClick={handleToggle}
      >
        {hasChildren ? (
          <span className="text-gray-400 dark:text-white/40">
            {isOpen ? <ChevronDown className="h-4 w-4" /> : <ChevronRight className="h-4 w-4" />}
          </span>
        ) : (
          <span className="w-4" /> 
        )}
        
        {node.icon ? (
          <span className="text-gray-500 dark:text-white/50">{node.icon}</span>
        ) : (
          <span className="text-blue-500 dark:text-blue-400">
            {hasChildren ? (isOpen ? <FolderOpen className="h-4 w-4" /> : <Folder className="h-4 w-4" />) : <File className="h-4 w-4" />}
          </span>
        )}
        
        <span className="truncate">{node.label}</span>
      </div>
      
      {isOpen && hasChildren && (
        <div className="animate-in slide-in-from-top-1 fade-in duration-200">
          {node.children!.map((child) => (
            <TreeNodeItem key={child.id} node={child} depth={depth + 1} onSelect={onSelect} />
          ))}
        </div>
      )}
    </div>
  );
};

export const Tree = ({ data, className, onSelect }: TreeProps) => {
  return (
    <div className={cn("w-full select-none", className)}>
      {data.map((node) => (
        <TreeNodeItem key={node.id} node={node} onSelect={onSelect} />
      ))}
    </div>
  );
};



=== FILE: packages\ui\src\components\data-display\UserPreview.tsx ===

import React from 'react';
import { cva, type VariantProps } from 'class-variance-authority';
import { cn } from '../../utils/cn';
import { Avatar } from './Avatar';
import { Button } from '../button/Button';

const userPreviewVariants = cva(
  "flex flex-col gap-4 rounded-2xl border p-4 transition-all duration-200",
  {
    variants: {
      variant: {
        default: "bg-white border-gray-200 dark:bg-white/[0.03] dark:border-white/10",
        glass: "backdrop-blur-md bg-white/80 border-white/20 dark:bg-black/40 dark:border-white/10",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
);

export interface UserPreviewProps 
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof userPreviewVariants> {
  user: {
    name: string;
    email?: string;
    avatarSrc?: string;
    role?: string;
    bio?: string;
    stats?: { label: string; value: string | number }[];
  };
  onFollow?: () => void;
  onMessage?: () => void;
}

export const UserPreview = React.forwardRef<HTMLDivElement, UserPreviewProps>(
  ({ className, variant, user, onFollow, onMessage, ...props }, ref) => {
    return (
      <div ref={ref} className={cn(userPreviewVariants({ variant, className }))} {...props}>
        <div className="flex items-start justify-between">
          <div className="flex gap-3">
            <Avatar src={user.avatarSrc} alt={user.name} size="lg" />
            <div>
              <h4 className="text-sm font-semibold text-gray-900 dark:text-white">{user.name}</h4>
              {user.role && (
                <span className="text-xs text-gray-500 dark:text-white/50">{user.role}</span>
              )}
              {user.email && (
                <div className="text-xs text-gray-400 dark:text-white/40 mt-0.5">{user.email}</div>
              )}
            </div>
          </div>
          {onFollow && (
             <Button size="sm" variant="outline" onClick={onFollow}>Follow</Button>
          )}
        </div>
        
        {user.bio && (
          <p className="text-sm text-gray-600 dark:text-gray-300 line-clamp-2">
            {user.bio}
          </p>
        )}

        {user.stats && (
          <div className="flex gap-4 border-t border-gray-100 pt-3 dark:border-white/5">
            {user.stats.map((stat, i) => (
              <div key={i} className="flex flex-col">
                <span className="text-xs font-medium text-gray-900 dark:text-white">{stat.value}</span>
                <span className="text-[10px] text-gray-500 dark:text-white/40">{stat.label}</span>
              </div>
            ))}
          </div>
        )}
        
        {onMessage && (
            <Button className="w-full mt-2" onClick={onMessage}>Message</Button>
        )}
      </div>
    );
  }
);
UserPreview.displayName = 'UserPreview';



=== FILE: packages\ui\src\components\feedback\Alert.tsx ===

import React from 'react';
import { cn } from '../../utils/cn';

export type AlertVariant = 'default' | 'success' | 'error' | 'warning' | 'info';

export interface AlertProps extends React.HTMLAttributes<HTMLDivElement> {
  variant?: AlertVariant;
  icon?: React.ReactNode;
  title?: string;
  children?: React.ReactNode;
}

const Icons = {
  success: (
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-emerald-400">
      <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
      <polyline points="22 4 12 14.01 9 11.01" />
    </svg>
  ),
  error: (
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-rose-400">
      <circle cx="12" cy="12" r="10" />
      <line x1="12" y1="8" x2="12" y2="12" />
      <line x1="12" y1="16" x2="12.01" y2="16" />
    </svg>
  ),
  warning: (
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-amber-400">
      <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" />
      <line x1="12" y1="9" x2="12" y2="13" />
      <line x1="12" y1="17" x2="12.01" y2="17" />
    </svg>
  ),
  info: (
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-blue-400">
      <circle cx="12" cy="12" r="10" />
      <line x1="12" y1="16" x2="12" y2="12" />
      <line x1="12" y1="8" x2="12.01" y2="8" />
    </svg>
  ),
};

export const Alert = React.forwardRef<HTMLDivElement, AlertProps>(
  ({ className, variant = 'default', icon, title, children, ...props }, ref) => {
    const Icon = icon || (variant !== 'default' ? Icons[variant] : null);

    return (
      <div
        ref={ref}
        role="alert"
        className={cn(
          "relative w-full rounded-xl border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-gray-900 dark:[&>svg]:text-white",
          "bg-white dark:bg-[#0A0A0A]/50 backdrop-blur-md border-gray-200 dark:border-white/10 text-gray-900 dark:text-white",
          variant === 'error' && "border-rose-200 dark:border-rose-500/20 bg-rose-50 dark:bg-rose-950/10 text-rose-900 dark:text-rose-50 [&>svg]:text-rose-600 dark:[&>svg]:text-rose-400",
          variant === 'success' && "border-emerald-200 dark:border-emerald-500/20 bg-emerald-50 dark:bg-emerald-950/10 text-emerald-900 dark:text-emerald-50 [&>svg]:text-emerald-600 dark:[&>svg]:text-emerald-400",
          variant === 'warning' && "border-amber-200 dark:border-amber-500/20 bg-amber-50 dark:bg-amber-950/10 text-amber-900 dark:text-amber-50 [&>svg]:text-amber-600 dark:[&>svg]:text-amber-400",
          variant === 'info' && "border-blue-200 dark:border-blue-500/20 bg-blue-50 dark:bg-blue-950/10 text-blue-900 dark:text-blue-50 [&>svg]:text-blue-600 dark:[&>svg]:text-blue-400",
          className
        )}
        {...props}
      >
        {Icon}
        <div className="flex flex-col gap-1">
          {title && (
            <h5 className="mb-1 font-medium leading-none tracking-tight">
              {title}
            </h5>
          )}
          {children && (
            <div className="text-sm opacity-90 [&_p]:leading-relaxed">
              {children}
            </div>
          )}
        </div>
      </div>
    );
  }
);

Alert.displayName = 'Alert';



=== FILE: packages\ui\src\components\feedback\EmptyState.tsx ===

import React from 'react';
import { cn } from '../../utils/cn';
import { Surface } from '../../primitives/Surface';
import { Info } from 'lucide-react';

export interface EmptyStateProps extends React.HTMLAttributes<HTMLDivElement> {
  icon?: React.ReactNode;
  title: string;
  description?: string;
  action?: React.ReactNode;
}

export const EmptyState = React.forwardRef<HTMLDivElement, EmptyStateProps>(
  ({ icon, title, description, action, className, ...props }, ref) => {
    return (
      <Surface
        ref={ref}
        className={cn('p-8 text-center', className)}
        {...props}
      >
        <div className="mx-auto w-full max-w-md space-y-3">
          <div className="mx-auto grid h-12 w-12 place-items-center rounded-2xl border border-white/10 bg-white/[0.03] text-white/70">
            {icon ?? <Info className="h-5 w-5" />}
          </div>
          <div className="text-lg font-semibold text-white">{title}</div>
          {description ? <div className="text-sm text-white/55">{description}</div> : null}
          {action ? <div className="pt-2 flex justify-center">{action}</div> : null}
        </div>
      </Surface>
    );
  }
);

EmptyState.displayName = 'EmptyState';



=== FILE: packages\ui\src\components\feedback\Magnetic.tsx ===

import React, { useRef, useState, useEffect } from 'react';
import { cn } from '../../utils/cn';

export interface MagneticProps {
  children: React.ReactElement;
  strength?: number;
  className?: string;
}

export function Magnetic({ children, strength = 0.5, className }: MagneticProps) {
  const ref = useRef<HTMLDivElement>(null);
  const [position, setPosition] = useState({ x: 0, y: 0 });

  const handleMouseMove = (e: MouseEvent) => {
    if (!ref.current) return;
    
    const { clientX, clientY } = e;
    const { left, top, width, height } = ref.current.getBoundingClientRect();
    
    const centerX = left + width / 2;
    const centerY = top + height / 2;
    
    const distanceX = clientX - centerX;
    const distanceY = clientY - centerY;
    
    // Only apply if mouse is relatively close
    const threshold = Math.max(width, height) * 1.5;
    if (Math.abs(distanceX) < threshold && Math.abs(distanceY) < threshold) {
      setPosition({ 
        x: distanceX * strength, 
        y: distanceY * strength 
      });
    } else {
      setPosition({ x: 0, y: 0 });
    }
  };

  const handleMouseLeave = () => {
    setPosition({ x: 0, y: 0 });
  };

  useEffect(() => {
    window.addEventListener('mousemove', handleMouseMove);
    return () => window.removeEventListener('mousemove', handleMouseMove);
  }, [strength]);

  return (
    <div
      ref={ref}
      className={cn("inline-block transition-transform duration-300 ease-out will-change-transform", className)}
      onMouseLeave={handleMouseLeave}
      style={{
        transform: `translate3d(${position.x}px, ${position.y}px, 0)`,
      }}
    >
      {children}
    </div>
  );
}



=== FILE: packages\ui\src\components\feedback\Motion.tsx ===

import React from 'react';
import { cva, type VariantProps } from 'class-variance-authority';
import { Slot } from '@radix-ui/react-slot';
import { cn } from '../../utils/cn';
import { useInView } from '../../hooks/useInView';

const motionVariants = cva(
  'transition-all duration-700 ease-out', 
  {
    variants: {
      preset: {
        'fade': 'opacity-0 translate-y-4',
        'spring': 'opacity-0 scale-95 translate-y-4',
        'slide-right': 'opacity-0 -translate-x-8',
        'slide-left': 'opacity-0 translate-x-8',
        'blur': 'opacity-0 blur-sm scale-105',
        '3d-flip': 'opacity-0 rotate-x-90',
      },
      visibleState: {
        'fade': 'opacity-100 translate-y-0',
        'spring': 'opacity-100 scale-100 translate-y-0 animate-enter-spring',
        'slide-right': 'opacity-100 translate-x-0',
        'slide-left': 'opacity-100 translate-x-0',
        'blur': 'opacity-100 blur-0 scale-100',
        '3d-flip': 'opacity-100 rotate-x-0',
      }
    },
    defaultVariants: {
      preset: 'spring',
    },
  }
);

export interface MotionProps extends React.HTMLAttributes<HTMLDivElement>, Omit<VariantProps<typeof motionVariants>, 'visibleState'> {
  asChild?: boolean;
  viewport?: boolean; // If true, animates only when entering the viewport
  visible?: boolean; // Manual control override
  delay?: number; // Delay in ms
  once?: boolean; // If true, animates only once
}

export function Motion({ 
  className, 
  preset = 'spring', 
  viewport = true, 
  visible,
  delay = 0,
  once = true,
  asChild = false,
  children, 
  style,
  ...props 
}: MotionProps) {
  const { ref, isInView, hasAnimated } = useInView({ threshold: 0.1, enabled: viewport && visible === undefined });
  
  // Determine if we should show the final state
  const internalShow = viewport ? (once ? hasAnimated : isInView) : true;
  const shouldShow = visible !== undefined ? visible : internalShow;

  // We manually construct the class string to ensure the correct preset is applied in the visible state
  // This is a bit of a hack because CVA doesn't support "conditional variants" based on external state easily
  // without defining a new variant like "state: visible".
  // But here we want to map 'preset' to 'visible' styles when shouldShow is true.
  
  // Let's simplify:
  // If shouldShow is true, we want the styles from `visible: [preset]`.
  // If shouldShow is false, we want the styles from `preset: [preset]`.
  
  // However, CVA `visible` variant keys match `preset` keys.
  // So we can just pass `visible: shouldShow ? preset : null`? No, that would remove the base styles.
  
  // Correct approach with the current CVA definition:
  // The `preset` variant defines the INITIAL state (hidden).
  // The `visible` variant defines the FINAL state (shown).
  // We need to apply `preset` ALWAYS (as base), and then override with `visible` when shown?
  // No, `preset` has opacity-0. If we keep it, we need `visible` to have opacity-100 and override it.
  // Tailwind classes override based on order in CSS, but here they are utility classes.
  // `opacity-100` usually overrides `opacity-0` if generated later, but `cn` merges them.
  
  // Let's try to be cleaner:
  // We will use the `preset` prop to get the initial state classes.
  // And we will manually append the visible classes if `shouldShow` is true.
  
  const initialClasses = motionVariants({ preset });
  const visibleClasses = shouldShow ? motionVariants({ visibleState: preset as any }) : '';
  
  // If visibleClasses is applied, we want it to win over initialClasses.
  // `cn` (tailwind-merge) handles this conflict resolution perfectly.
  
  const Comp = asChild ? Slot : 'div';

  return (
    <Comp
      ref={ref}
      className={cn(
        initialClasses,
        visibleClasses,
        className
      )}
      style={{ 
        transitionDelay: `${delay}ms`,
        willChange: 'transform, opacity',
        ...style 
      }}
      {...props}
    >
      {children}
    </Comp>
  );
}



=== FILE: packages\ui\src\components\feedback\MotionGroup.tsx ===

import React from 'react';
import { useInView } from '../../hooks/useInView';
import { cn } from '../../utils/cn';

interface MotionGroupProps extends React.HTMLAttributes<HTMLDivElement> {
  children: React.ReactNode;
  stagger?: number; // Delay between items in ms
  delay?: number;   // Initial delay in ms
}

export function MotionGroup({ 
  children, 
  stagger = 100, 
  delay = 0, 
  className, 
  ...props 
}: MotionGroupProps) {
  const { ref, hasAnimated } = useInView({ threshold: 0.1 });

  return (
    <div ref={ref} className={cn('relative', className)} {...props}>
      {React.Children.map(children, (child, index) => {
        if (React.isValidElement(child)) {
          return React.cloneElement(child as React.ReactElement<any>, {
            // Force child to wait for group
            visible: hasAnimated,
            // Disable child's internal observer to save resources
            viewport: false,
            // Calculate stagger delay
            delay: delay + (index * stagger),
          });
        }
        return child;
      })}
    </div>
  );
}



=== FILE: packages\ui\src\components\feedback\NumberTicker.tsx ===

import React, { useEffect, useState, useRef } from 'react';
import { cn } from '../../utils/cn';
import { useInView } from '../../hooks/useInView';

export interface NumberTickerProps extends React.HTMLAttributes<HTMLSpanElement> {
  value: number;
  duration?: number;
  delay?: number;
  decimalPlaces?: number;
}

export function NumberTicker({
  value,
  duration = 2000,
  delay = 0,
  decimalPlaces = 0,
  className,
  ...props
}: NumberTickerProps) {
  const [displayValue, setDisplayValue] = useState(0);
  const { ref, hasAnimated } = useInView({ threshold: 0.1 });
  const startTimeRef = useRef<number | null>(null);

  useEffect(() => {
    if (!hasAnimated) return;

    const animate = (timestamp: number) => {
      if (!startTimeRef.current) startTimeRef.current = timestamp;
      const progress = Math.min((timestamp - startTimeRef.current - delay) / duration, 1);
      
      if (progress >= 0) {
        const current = progress * value;
        setDisplayValue(current);
      }

      if (progress < 1) {
        requestAnimationFrame(animate);
      }
    };

    const timeout = setTimeout(() => {
      requestAnimationFrame(animate);
    }, delay);

    return () => clearTimeout(timeout);
  }, [hasAnimated, value, duration, delay]);

  return (
    <span
      ref={ref}
      className={cn("tabular-nums tracking-tighter", className)}
      {...props}
    >
      {displayValue.toFixed(decimalPlaces)}
    </span>
  );
}



=== FILE: packages\ui\src\components\feedback\PageLoader.tsx ===

import React from 'react';
import { Loader2 } from 'lucide-react';
import { cn } from '../../utils/cn';

export interface PageLoaderProps extends React.HTMLAttributes<HTMLDivElement> {
  variant?: 'spinner' | 'bar' | 'dots' | 'logo' | 'glass';
  text?: string;
  fullscreen?: boolean;
}

export function PageLoader({
  variant = 'spinner',
  text,
  fullscreen = true,
  className,
  ...props
}: PageLoaderProps) {
  const baseStyles = fullscreen
    ? 'fixed inset-0 z-50 flex items-center justify-center bg-white/80 dark:bg-black/80 backdrop-blur-sm'
    : 'flex items-center justify-center p-8 w-full h-full min-h-[200px]';

  if (variant === 'bar') {
    return (
      <div className={cn('fixed top-0 left-0 right-0 z-50 h-1 bg-transparent', className)} {...props}>
        <div className="h-full bg-blue-500 animate-indeterminate-progress origin-left" />
      </div>
    );
  }

  if (variant === 'dots') {
    return (
      <div className={cn(baseStyles, className)} {...props}>
        <div className="flex space-x-2">
          <div className="h-3 w-3 rounded-full bg-blue-500 animate-bounce [animation-delay:-0.3s]" />
          <div className="h-3 w-3 rounded-full bg-blue-500 animate-bounce [animation-delay:-0.15s]" />
          <div className="h-3 w-3 rounded-full bg-blue-500 animate-bounce" />
        </div>
        {text && <span className="ml-4 text-sm font-medium text-gray-500 dark:text-white/70">{text}</span>}
      </div>
    );
  }

  if (variant === 'logo') {
    return (
      <div className={cn(baseStyles, className)} {...props}>
        <div className="flex flex-col items-center gap-4">
          <div className="relative flex h-16 w-16 items-center justify-center rounded-full bg-white dark:bg-white/10 shadow-lg ring-1 ring-black/5">
            <div className="absolute inset-0 rounded-full animate-ping bg-blue-500/20" />
            <div className="h-8 w-8 rounded bg-blue-500" />
          </div>
          {text && <span className="text-sm font-medium text-gray-500 dark:text-white/70 animate-pulse">{text}</span>}
        </div>
      </div>
    );
  }

  if (variant === 'glass') {
    return (
      <div className={cn(baseStyles, 'bg-white/30 dark:bg-black/30 backdrop-blur-md', className)} {...props}>
        <div className="flex flex-col items-center gap-3">
          <Loader2 className="h-8 w-8 animate-spin text-white" />
          {text && <span className="text-sm font-medium text-white tracking-wider">{text}</span>}
        </div>
      </div>
    );
  }

  // Default: spinner
  return (
    <div className={cn(baseStyles, className)} {...props}>
      <div className="flex flex-col items-center gap-3">
        <Loader2 className="h-8 w-8 animate-spin text-blue-500" />
        {text && <span className="text-sm font-medium text-gray-500 dark:text-white/70">{text}</span>}
      </div>
    </div>
  );
}



=== FILE: packages\ui\src\components\feedback\PageTransition.tsx ===

import React, { useEffect, useState } from 'react';
import { cn } from '../../utils/cn';

export interface PageTransitionProps extends React.HTMLAttributes<HTMLDivElement> {
  preset?: 'fade' | 'slide-up' | 'scale' | 'blur' | 'none';
  duration?: number;
  useViewTransition?: boolean;
}

export function PageTransition({
  preset = 'fade',
  duration = 300,
  useViewTransition = false,
  className,
  children,
  ...props
}: PageTransitionProps) {
  const [isVisible, setIsVisible] = useState(false);

  useEffect(() => {
    if (useViewTransition && (document as any).startViewTransition) {
      (document as any).startViewTransition(() => {
        setIsVisible(true);
      });
    } else {
      const timer = requestAnimationFrame(() => {
        setIsVisible(true);
      });
      return () => cancelAnimationFrame(timer);
    }
  }, [useViewTransition]);

  const presets = {
    fade: {
      initial: 'opacity-0',
      animate: 'opacity-100',
    },
    'slide-up': {
      initial: 'opacity-0 translate-y-8',
      animate: 'opacity-100 translate-y-0',
    },
    scale: {
      initial: 'opacity-0 scale-95',
      animate: 'opacity-100 scale-100',
    },
    blur: {
      initial: 'opacity-0 blur-sm',
      animate: 'opacity-100 blur-0',
    },
    none: {
      initial: '',
      animate: '',
    }
  };

  const currentPreset = presets[preset];

  return (
    <div
      className={cn(
        'transition-all ease-out',
        isVisible ? currentPreset.animate : currentPreset.initial,
        className
      )}
      style={{ 
        transitionDuration: `${duration}ms`,
        viewTransitionName: useViewTransition ? 'page-content' : undefined
      } as any}
      {...props}
    >
      {children}
    </div>
  );
}



=== FILE: packages\ui\src\components\feedback\Parallax.tsx ===

import React, { useEffect, useRef } from 'react';
import { cn } from '../../utils/cn';

interface ParallaxProps extends React.HTMLAttributes<HTMLDivElement> {
  speed?: number; // -1 to 1. Positive = moves slower (depth), Negative = moves faster.
  direction?: 'vertical' | 'horizontal';
}

export function Parallax({ 
  children, 
  speed = 0.1, 
  direction = 'vertical',
  className,
  ...props 
}: ParallaxProps) {
  const ref = useRef<HTMLDivElement>(null);

  useEffect(() => {
    const element = ref.current;
    if (!element) return;

    const handleScroll = () => {
      const rect = element.getBoundingClientRect();
      const windowHeight = window.innerHeight;
      
      // Optimization: Only animate if roughly in view
      if (rect.top > windowHeight || rect.bottom < 0) return;

      // Calculate distance from center of viewport
      // 0 = center, -val = above center, +val = below center
      const centerOffset = (windowHeight / 2) - (rect.top + rect.height / 2);
      
      const translate = centerOffset * speed;

      if (direction === 'vertical') {
        element.style.transform = `translate3d(0, ${translate}px, 0)`;
      } else {
        element.style.transform = `translate3d(${translate}px, 0, 0)`;
      }
    };

    window.addEventListener('scroll', handleScroll, { passive: true });
    handleScroll(); // Initial calculation

    return () => window.removeEventListener('scroll', handleScroll);
  }, [speed, direction]);

  return (
    <div 
      ref={ref} 
      className={cn('will-change-transform', className)} 
      {...props}
    >
      {children}
    </div>
  );
}



=== FILE: packages\ui\src\components\feedback\Progress.tsx ===

import React from 'react';
import { cn } from '../../utils/cn';

export type ProgressVariant = 'default' | 'success' | 'warning' | 'danger' | 'gradient';
export type ProgressSize = 'sm' | 'md' | 'lg';

export interface ProgressProps extends React.HTMLAttributes<HTMLDivElement> {
  value?: number;
  max?: number;
  variant?: ProgressVariant;
  size?: ProgressSize;
  isIndeterminate?: boolean;
  hasStripe?: boolean;
  indicatorClassName?: string;
}

export const Progress = React.forwardRef<HTMLDivElement, ProgressProps>(
  ({ 
    className, 
    value = 0, 
    max = 100, 
    variant = 'default',
    size = 'md',
    isIndeterminate = false,
    hasStripe = false,
    indicatorClassName, 
    ...props 
  }, ref) => {
    const percentage = isIndeterminate ? 0 : Math.min(Math.max((value || 0) / max, 0), 1) * 100;

    const variants = {
      default: 'bg-gray-900 dark:bg-white dark:shadow-[0_0_10px_rgba(255,255,255,0.5)]',
      success: 'bg-emerald-500 shadow-sm dark:shadow-[0_0_10px_rgba(16,185,129,0.5)]',
      warning: 'bg-amber-500 shadow-sm dark:shadow-[0_0_10px_rgba(245,158,11,0.5)]',
      danger: 'bg-rose-500 shadow-sm dark:shadow-[0_0_10px_rgba(244,63,94,0.5)]',
      gradient: 'bg-gradient-to-r from-blue-600 via-purple-600 to-blue-600 shadow-sm dark:shadow-[0_0_15px_rgba(99,102,241,0.5)]'
    };

    const sizes = {
      sm: 'h-1',
      md: 'h-2',
      lg: 'h-4'
    };

    return (
      <div
        ref={ref}
        role="progressbar"
        aria-valuemin={0}
        aria-valuemax={max}
        aria-valuenow={isIndeterminate ? undefined : value}
        className={cn(
          "relative w-full overflow-hidden rounded-full bg-gray-200 dark:bg-white/5 border border-gray-200 dark:border-white/5 backdrop-blur-sm",
          sizes[size],
          className
        )}
        {...props}
      >
        <div
          className={cn(
            "h-full w-full flex-1 transition-all duration-500 ease-in-out relative overflow-hidden",
            variants[variant],
            isIndeterminate && "absolute inset-0 w-full origin-left animate-indeterminate-progress",
            indicatorClassName
          )}
          style={{ 
            transform: isIndeterminate ? undefined : `translateX(-${100 - percentage}%)` 
          }}
        >
          {hasStripe && !isIndeterminate && (
            <div className="absolute inset-0 w-full h-full animate-progress-stripe" 
                 style={{
                   backgroundImage: 'linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent)',
                   backgroundSize: '1rem 1rem'
                 }} 
            />
          )}
        </div>
      </div>
    );
  }
);

Progress.displayName = "Progress";



=== FILE: packages\ui\src\components\feedback\Rating.tsx ===

import React, { useState } from 'react';
import { Star } from 'lucide-react';
import { cn } from '../../utils/cn';

export interface RatingProps extends Omit<React.HTMLAttributes<HTMLDivElement>, 'onChange'> {
  max?: number;
  value?: number;
  onChange?: (value: number) => void;
  readOnly?: boolean;
  size?: 'sm' | 'md' | 'lg';
}

export const Rating = React.forwardRef<HTMLDivElement, RatingProps>(
  ({ className, max = 5, value = 0, onChange, readOnly = false, size = 'md', ...props }, ref) => {
    const [hoverValue, setHoverValue] = useState<number | null>(null);

    const sizes = {
      sm: "h-4 w-4",
      md: "h-5 w-5",
      lg: "h-6 w-6",
    };

    return (
      <div ref={ref} className={cn("flex items-center gap-1", className)} {...props}>
        {Array.from({ length: max }).map((_, i) => {
          const index = i + 1;
          const isFilled = (hoverValue !== null ? hoverValue : value) >= index;
          
          return (
            <button
              key={i}
              type="button"
              disabled={readOnly}
              onClick={() => onChange?.(index)}
              onMouseEnter={() => !readOnly && setHoverValue(index)}
              onMouseLeave={() => !readOnly && setHoverValue(null)}
              className={cn(
                "transition-transform hover:scale-110 focus:outline-none",
                readOnly && "cursor-default hover:scale-100"
              )}
            >
              <Star
                className={cn(
                  sizes[size],
                  "transition-colors duration-200",
                  isFilled 
                    ? "fill-amber-400 text-amber-400" 
                    : "fill-transparent text-gray-300 dark:text-white/20"
                )}
              />
            </button>
          );
        })}
      </div>
    );
  }
);
Rating.displayName = "Rating";



=== FILE: packages\ui\src\components\feedback\Reveal.tsx ===

import React from 'react';
import { cn } from '../../utils/cn';
import { useInView } from '../../hooks/useInView';

export interface RevealProps extends React.HTMLAttributes<HTMLDivElement> {
  children: React.ReactNode;
  direction?: 'up' | 'down' | 'left' | 'right';
  duration?: number;
  delay?: number;
  boxColor?: string;
}

export function Reveal({
  children,
  direction = 'up',
  duration = 0.5,
  delay = 0,
  boxColor = 'bg-blue-500',
  className,
  ...props
}: RevealProps) {
  const { ref, hasAnimated } = useInView({ threshold: 0.2 });

  const directionClasses = {
    up: 'translate-y-full',
    down: '-translate-y-full',
    left: 'translate-x-full',
    right: '-translate-x-full',
  };

  return (
    <div
      ref={ref}
      className={cn("relative overflow-hidden inline-block", className)}
      {...props}
    >
      <div
        className={cn(
          "transition-all ease-out",
          hasAnimated ? "translate-x-0 translate-y-0 opacity-100" : cn("opacity-0", directionClasses[direction])
        )}
        style={{ 
          transitionDuration: `${duration}s`,
          transitionDelay: `${delay}s`
        }}
      >
        {children}
      </div>
      
      {/* Reveal Box Overlay */}
      <div
        className={cn(
          "absolute inset-0 z-10 transition-transform ease-in-out",
          boxColor,
          hasAnimated ? (direction === 'left' || direction === 'right' ? 'scale-x-0' : 'scale-y-0') : 'scale-100'
        )}
        style={{ 
          transitionDuration: `${duration}s`,
          transitionDelay: `${delay}s`,
          transformOrigin: direction === 'up' ? 'top' : direction === 'down' ? 'bottom' : direction === 'left' ? 'left' : 'right'
        }}
      />
    </div>
  );
}



=== FILE: packages\ui\src\components\feedback\Skeleton.tsx ===

import React from 'react';
import { cn } from '../../utils/cn';

export interface SkeletonProps extends React.HTMLAttributes<HTMLDivElement> {
  variant?: 'default' | 'circle' | 'text';
}

export function Skeleton({ className, variant = 'default', ...props }: SkeletonProps) {
  return (
    <div
      className={cn(
        "animate-pulse bg-gray-200 dark:bg-white/10",
        variant === 'circle' && "rounded-full",
        variant === 'default' && "rounded-xl",
        variant === 'text' && "rounded h-4 w-full",
        className
      )}
      {...props}
    />
  );
}



=== FILE: packages\ui\src\components\feedback\TextMotion.tsx ===

import React from 'react';
import { useInView } from '../../hooks/useInView';
import { cn } from '../../utils/cn';

interface TextMotionProps extends React.HTMLAttributes<HTMLDivElement> {
  text: string;
  type?: 'char' | 'word';
  stagger?: number;
  delay?: number;
}

export function TextMotion({ 
  text, 
  type = 'char', 
  stagger = 30, 
  delay = 0,
  className,
  ...props 
}: TextMotionProps) {
  const { ref, hasAnimated } = useInView({ threshold: 0.2 });
  
  const items = type === 'char' ? text.split('') : text.split(' ');

  return (
    <div 
      ref={ref} 
      className={cn('flex flex-wrap', className)} 
      aria-label={text}
      {...props}
    >
      {items.map((item, i) => (
        <span
          key={i}
          className={cn(
            'inline-block whitespace-pre transition-all duration-500 ease-out will-change-transform',
            hasAnimated 
              ? 'opacity-100 translate-y-0 blur-0' 
              : 'opacity-0 translate-y-4 blur-sm'
          )}
          style={{ 
            transitionDelay: `${delay + (i * stagger)}ms` 
          }}
        >
          {item}{type === 'word' && i !== items.length - 1 ? ' ' : ''}
        </span>
      ))}
    </div>
  );
}



=== FILE: packages\ui\src\components\feedback\Toast.tsx ===

import React, { useEffect } from 'react';
import { cn } from '../../utils/cn';

export type ToastVariant = 'default' | 'success' | 'error' | 'warning' | 'info';

export interface ToastProps {
  id: string;
  title?: string;
  description?: React.ReactNode;
  variant?: ToastVariant;
  duration?: number;
  onDismiss: (id: string) => void;
}

const Icons = {
  success: (
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-emerald-400">
      <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
      <polyline points="22 4 12 14.01 9 11.01" />
    </svg>
  ),
  error: (
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-rose-400">
      <circle cx="12" cy="12" r="10" />
      <line x1="12" y1="8" x2="12" y2="12" />
      <line x1="12" y1="16" x2="12.01" y2="16" />
    </svg>
  ),
  warning: (
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-amber-400">
      <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" />
      <line x1="12" y1="9" x2="12" y2="13" />
      <line x1="12" y1="17" x2="12.01" y2="17" />
    </svg>
  ),
  info: (
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-blue-400">
      <circle cx="12" cy="12" r="10" />
      <line x1="12" y1="16" x2="12" y2="12" />
      <line x1="12" y1="8" x2="12.01" y2="8" />
    </svg>
  ),
};

export const Toast = ({
  id,
  title,
  description,
  variant = 'default',
  duration = 5000,
  onDismiss,
}: ToastProps) => {
  useEffect(() => {
    if (duration === Infinity) return;

    const timer = setTimeout(() => {
      onDismiss(id);
    }, duration);

    return () => clearTimeout(timer);
  }, [duration, id, onDismiss]);

  return (
    <div
      role="alert"
      className={cn(
        "pointer-events-auto relative flex w-full max-w-sm items-start gap-4 overflow-hidden rounded-xl border p-4 shadow-lg transition-all",
        "animate-in slide-in-from-right-full fade-in duration-300",
        "bg-white dark:bg-[#0A0A0A]/90 backdrop-blur-md border-gray-200 dark:border-white/10",
        variant === 'error' && "border-rose-200 dark:border-rose-500/30 bg-rose-50 dark:bg-rose-500/10",
        variant === 'success' && "border-emerald-200 dark:border-emerald-500/20 bg-emerald-50 dark:bg-emerald-950/10",
        variant === 'warning' && "border-amber-200 dark:border-amber-500/20 bg-amber-50 dark:bg-amber-950/10",
        variant === 'info' && "border-blue-200 dark:border-blue-500/20 bg-blue-50 dark:bg-blue-950/10"
      )}
    >
      {variant !== 'default' && Icons[variant] && (
        <div className="shrink-0 pt-0.5">
          {Icons[variant]}
        </div>
      )}
      
      <div className="flex-1 gap-1">
        {title && <div className="text-sm font-semibold text-gray-900 dark:text-white">{title}</div>}
        {description && <div className="text-sm text-gray-600 dark:text-white/80">{description}</div>}
      </div>

      <button
        onClick={() => onDismiss(id)}
        className="shrink-0 rounded-md p-1 text-gray-400 dark:text-white/50 opacity-0 transition-opacity hover:text-gray-900 dark:hover:text-white group-hover:opacity-100 focus:opacity-100 focus:outline-none focus:ring-2 focus:ring-gray-400 dark:focus:ring-white/20"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
          <line x1="18" y1="6" x2="6" y2="18" />
          <line x1="6" y1="6" x2="18" y2="18" />
        </svg>
      </button>
    </div>
  );
};



=== FILE: packages\ui\src\components\feedback\ToastProvider.tsx ===

import React, { createContext, useState, useCallback, useContext } from 'react';
import { Toast, ToastProps, ToastVariant } from './Toast';

export type ToastOptions = Omit<ToastProps, 'id' | 'onDismiss'>;

export interface ToastContextType {
  toast: (options: ToastOptions) => void;
  dismiss: (id: string) => void;
}

export const ToastContext = createContext<ToastContextType | undefined>(undefined);

export function ToastProvider({ children }: { children: React.ReactNode }) {
  const [toasts, setToasts] = useState<ToastProps[]>([]);

  const dismiss = useCallback((id: string) => {
    setToasts((prev) => prev.filter((toast) => toast.id !== id));
  }, []);

  const toast = useCallback((options: ToastOptions) => {
    const id = Math.random().toString(36).substring(2, 9);
    setToasts((prev) => [...prev, { ...options, id, onDismiss: dismiss }]);
    return id;
  }, [dismiss]);

  return (
    <ToastContext.Provider value={{ toast, dismiss }}>
      {children}
      <div className="fixed bottom-0 right-0 z-[100] flex max-h-screen w-full flex-col-reverse gap-2 p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]">
        {toasts.map((toast) => (
          <Toast key={toast.id} {...toast} />
        ))}
      </div>
    </ToastContext.Provider>
  );
}



=== FILE: packages\ui\src\components\form\Checkbox.tsx ===

import React from 'react';
import { cn } from '../../utils/cn';
import { Label } from './Label';

export interface CheckboxProps extends Omit<React.ButtonHTMLAttributes<HTMLButtonElement>, 'onChange'> {
  label?: string;
  error?: string;
  checked?: boolean;
  defaultChecked?: boolean;
  onChange?: (event: { target: { checked: boolean } }) => void;
}

export const Checkbox = React.forwardRef<HTMLButtonElement, CheckboxProps>(
  ({ className, label, error, id, disabled, checked, defaultChecked, onChange, ...props }, ref) => {
    const inputId = id || React.useId();
    const [isChecked, setIsChecked] = React.useState(defaultChecked || checked || false);

    React.useEffect(() => {
      if (checked !== undefined) {
        setIsChecked(checked);
      }
    }, [checked]);

    const handleClick = () => {
      if (disabled) return;
      const newValue = !isChecked;
      setIsChecked(newValue);
      if (onChange) {
        onChange({ target: { checked: newValue } } as any);
      }
    };

    return (
      <div className={cn("flex flex-col gap-1.5", className)}>
        <button
          ref={ref}
          type="button"
          id={inputId}
          role="checkbox"
          aria-checked={isChecked}
          aria-label={label}
          onClick={handleClick}
          disabled={disabled}
          className={cn(
            'flex items-center gap-3 rounded-2xl border border-gray-200 dark:border-white/10 bg-gray-50 dark:bg-white/[0.03] px-4 py-3',
            'hover:bg-gray-100 dark:hover:bg-white/[0.04] transition-colors',
            disabled && 'opacity-50 cursor-not-allowed'
          )}
          {...props}
        >
          <span
            aria-hidden="true"
            className={cn(
              'grid h-6 w-6 place-items-center rounded-lg border',
              isChecked 
                ? 'border-emerald-400/30 bg-emerald-400/15' 
                : 'border-gray-300 dark:border-white/10 bg-white dark:bg-white/[0.02]'
            )}
          >
            {isChecked ? (
              <svg className="h-4 w-4 text-emerald-200" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={3}>
                <path strokeLinecap="round" strokeLinejoin="round" d="M4.5 12.75l6 6 9-13.5" />
              </svg>
            ) : null}
          </span>
          {label && (
            <span className="text-sm text-gray-700 dark:text-white/70">{label}</span>
          )}
        </button>
        {error && (
          <p className="text-xs text-rose-500 mt-1 ml-1">{error}</p>
        )}
      </div>
    );
  }
);

Checkbox.displayName = 'Checkbox';



=== FILE: packages\ui\src\components\form\Combobox.tsx ===

import React, { createContext, useContext, useState, useMemo, useEffect } from 'react';
import { Popover, PopoverContent, PopoverTrigger } from '../overlay/Popover';
import { cn } from '../../utils/cn';

interface ComboboxContextValue {
  value: string;
  onValueChange: (value: string) => void;
  searchTerm: string;
  setSearchTerm: (term: string) => void;
  isOpen: boolean;
  setIsOpen: (isOpen: boolean) => void;
  registerItem: (id: string, text: string) => () => void;
  isItemVisible: (id: string, text: string) => boolean;
  hasVisibleItems: boolean;
}

const ComboboxContext = createContext<ComboboxContextValue | undefined>(undefined);

export interface ComboboxProps {
  children: React.ReactNode;
  value?: string;
  defaultValue?: string;
  onValueChange?: (value: string) => void;
  filter?: (value: string, search: string) => boolean;
  usePopover?: boolean;
}

export function Combobox({ 
  children, 
  value: controlledValue, 
  defaultValue = '', 
  onValueChange,
  filter = (text, search) => text.toLowerCase().includes(search.toLowerCase()),
  usePopover = true
}: ComboboxProps) {
  const [internalValue, setInternalValue] = useState(defaultValue);
  const [searchTerm, setSearchTerm] = useState('');
  const [isOpen, setIsOpen] = useState(false);
  const [items, setItems] = useState<Map<string, string>>(new Map());

  const isControlled = controlledValue !== undefined;
  const value = isControlled ? controlledValue : internalValue;

  const handleValueChange = (newValue: string) => {
    if (!isControlled) setInternalValue(newValue);
    onValueChange?.(newValue);
    setIsOpen(false);
  };

  const registerItem = React.useCallback((id: string, text: string) => {
    setItems(prev => {
      const next = new Map(prev);
      next.set(id, text);
      return next;
    });
    return () => {
      setItems(prev => {
        const next = new Map(prev);
        next.delete(id);
        return next;
      });
    };
  }, []);

  const isItemVisible = React.useCallback((id: string, text: string) => {
    return filter(text, searchTerm);
  }, [filter, searchTerm]);

  const hasVisibleItems = useMemo(() => {
    for (const [id, text] of items.entries()) {
      if (filter(text, searchTerm)) return true;
    }
    return false;
  }, [items, searchTerm, filter]);

  return (
    <ComboboxContext.Provider value={{ 
      value, 
      onValueChange: handleValueChange, 
      searchTerm, 
      setSearchTerm, 
      isOpen, 
      setIsOpen,
      registerItem,
      isItemVisible,
      hasVisibleItems
    }}>
      {usePopover ? (
        <Popover open={isOpen} onOpenChange={setIsOpen}>
          {children}
        </Popover>
      ) : (
        children
      )}
    </ComboboxContext.Provider>
  );
}

export function ComboboxTrigger({ className, children, ...props }: React.ButtonHTMLAttributes<HTMLButtonElement>) {
  return (
    <PopoverTrigger
      className={cn(
        "flex h-10 w-full items-center justify-between rounded-2xl border border-gray-200 bg-gray-50 px-3 py-2 text-sm text-gray-900 placeholder:text-gray-500 focus:border-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500/20 disabled:cursor-not-allowed disabled:opacity-50 dark:border-white/10 dark:bg-white/[0.03] dark:text-white dark:placeholder:text-white/40 dark:focus:border-white/20 dark:focus:ring-white/10",
        className
      )}
      {...props}
      {...props}
    >
      {children}
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="16"
        height="16"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
        className="ml-2 opacity-50"
      >
        <path d="m6 9 6 6 6-6"/>
      </svg>
    </PopoverTrigger>
  );
}

export function ComboboxContent({ className, children, ...props }: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <PopoverContent className={cn("p-0 w-[200px]", className)} align="start" {...props}>
      {children}
    </PopoverContent>
  );
}

export function ComboboxInput({ className, placeholder = "Search...", ...props }: React.InputHTMLAttributes<HTMLInputElement>) {
  const context = useContext(ComboboxContext);
  if (!context) throw new Error('ComboboxInput must be used within Combobox');

  return (
    <div className="flex items-center border-b border-gray-200 dark:border-white/10 px-3">
      <svg
        className="mr-2 h-4 w-4 shrink-0 opacity-50"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      >
        <circle cx="11" cy="11" r="8" />
        <path d="m21 21-4.3-4.3" />
      </svg>
      <input
        className={cn(
          "flex h-10 w-full rounded-md bg-transparent py-3 text-sm text-gray-900 dark:text-white outline-none placeholder:text-gray-400 dark:placeholder:text-white/40 disabled:cursor-not-allowed disabled:opacity-50",
          className
        )}
        placeholder={placeholder}
        value={context.searchTerm}
        onChange={(e) => context.setSearchTerm(e.target.value)}
        {...props}
      />
    </div>
  );
}

export function ComboboxList({ className, children, ...props }: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div className={cn("max-h-[300px] overflow-y-auto overflow-x-hidden p-1", className)} {...props}>
      {children}
    </div>
  );
}

export function ComboboxEmpty({ className, children, ...props }: React.HTMLAttributes<HTMLDivElement>) {
  const context = useContext(ComboboxContext);
  if (!context) throw new Error('ComboboxEmpty must be used within Combobox');

  if (context.hasVisibleItems) return null;

  return (
    <div className={cn("py-6 text-center text-sm text-gray-500 dark:text-white/40", className)} {...props}>
      {children}
    </div>
  );
}

export interface ComboboxItemProps extends React.HTMLAttributes<HTMLDivElement> {
  value: string;
  children: React.ReactNode;
  textValue?: string;
}

export function ComboboxItem({ className, value, children, textValue, ...props }: ComboboxItemProps) {
  const context = useContext(ComboboxContext);
  if (!context) throw new Error('ComboboxItem must be used within Combobox');

  const id = React.useId();
  const text = textValue || (typeof children === 'string' ? children : value);
  const isVisible = context.isItemVisible(id, text);
  const isSelected = context.value === value;

  useEffect(() => {
    return context.registerItem(id, text);
  }, [id, text, context.registerItem]);

  if (!isVisible) return null;

  return (
    <div
      onClick={() => context.onValueChange(value)}
      className={cn(
        "relative flex cursor-default select-none items-center rounded-xl px-3 py-2 text-sm outline-none transition-colors",
        "text-gray-700 dark:text-white/80",
        "aria-selected:bg-gray-100 aria-selected:text-gray-900 dark:aria-selected:bg-white/10 dark:aria-selected:text-white",
        "data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
        "hover:bg-gray-100 hover:text-gray-900 dark:hover:bg-white/10 dark:hover:text-white",
        isSelected && "bg-gray-100 text-gray-900 dark:bg-white/10 dark:text-white",
        className
      )}
      {...props}
    >
      <svg
        className={cn(
          "mr-2 h-4 w-4",
          isSelected ? "opacity-100" : "opacity-0"
        )}
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
      >
        <polyline points="20 6 9 17 4 12" />
      </svg>
      {children}
    </div>
  );
}



=== FILE: packages\ui\src\components\form\DatePicker.tsx ===

import React, { useState } from 'react';
import { Popover, PopoverContent, PopoverTrigger } from '../overlay/Popover';
import { Calendar } from '../data-display/Calendar';
import { cn } from '../../utils/cn';
import { Calendar as CalendarIcon } from 'lucide-react';

export interface DatePickerProps {
  value?: Date;
  onChange?: (date: Date) => void;
  placeholder?: string;
  className?: string;
}

export function DatePicker({ value, onChange, placeholder = "Pick a date", className }: DatePickerProps) {
  const [date, setDate] = useState<Date | undefined>(value);
  const [isOpen, setIsOpen] = useState(false);

  const handleSelect = (newDate: Date) => {
    setDate(newDate);
    onChange?.(newDate);
    setIsOpen(false);
  };

  const formatDate = (d: Date) => {
    return d.toLocaleDateString('en-US', {
      month: 'long',
      day: 'numeric',
      year: 'numeric',
    });
  };

  const handleMouseMove = (e: React.MouseEvent<HTMLButtonElement>) => {
    const rect = e.currentTarget.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    e.currentTarget.style.setProperty('--x', `${x}px`);
    e.currentTarget.style.setProperty('--y', `${y}px`);
  };

  return (
    <Popover open={isOpen} onOpenChange={setIsOpen}>
      <PopoverTrigger
        onMouseMove={handleMouseMove}
        className={cn(
          "group relative flex h-11 w-full items-center justify-between rounded-2xl border border-gray-200 dark:border-white/10 bg-gray-50 dark:bg-white/[0.03] px-4 py-2 text-sm text-gray-900 dark:text-white transition-all duration-200 overflow-hidden",
          "hover:bg-gray-100 dark:hover:bg-white/[0.06] focus:outline-none focus:ring-2 focus:ring-gray-400 dark:focus:ring-white/15",
          !date && "text-gray-400 dark:text-white/40",
          className
        )}
      >
        <div className="absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"
             style={{
               background: `radial-gradient(600px circle at var(--x) var(--y), rgba(255,255,255,0.06), transparent 40%)`
             }}
        />
        <span className="relative z-10">{date ? formatDate(date) : placeholder}</span>
        <CalendarIcon className="relative z-10 h-4 w-4 text-white/40" />
      </PopoverTrigger>
      <PopoverContent className="w-auto p-0 border-none bg-transparent shadow-none" align="start">
        <Calendar
          value={date}
          onChange={handleSelect}
          className="shadow-2xl shadow-black/50"
        />
      </PopoverContent>
    </Popover>
  );
}



=== FILE: packages\ui\src\components\form\DateTimePicker.tsx ===

import React, { useState, useEffect } from 'react';
import { Popover, PopoverContent, PopoverTrigger } from '../overlay/Popover';
import { Calendar } from '../data-display/Calendar';
import { ScrollArea } from '../data-display/ScrollArea';
import { cn } from '../../utils/cn';
import { Calendar as CalendarIcon, Clock } from 'lucide-react';

export interface DateTimePickerProps {
  value?: Date;
  onChange?: (date: Date) => void;
  placeholder?: string;
  className?: string;
}

export function DateTimePicker({ value, onChange, placeholder = "Pick date & time", className }: DateTimePickerProps) {
  const [date, setDate] = useState<Date | undefined>(value);
  const [isOpen, setIsOpen] = useState(false);
  
  // Time state
  const [hours, setHours] = useState(value ? value.getHours() : 12);
  const [minutes, setMinutes] = useState(value ? value.getMinutes() : 0);

  useEffect(() => {
    if (value) {
      setDate(value);
      setHours(value.getHours());
      setMinutes(value.getMinutes());
    }
  }, [value]);

  const handleDateSelect = (newDate: Date) => {
    const updatedDate = new Date(newDate);
    updatedDate.setHours(hours);
    updatedDate.setMinutes(minutes);
    setDate(updatedDate);
    onChange?.(updatedDate);
  };

  const handleTimeChange = (type: 'hours' | 'minutes', val: string) => {
    let num = parseInt(val, 10);
    if (isNaN(num)) return;

    let newHours = hours;
    let newMinutes = minutes;

    if (type === 'hours') {
      num = Math.max(0, Math.min(23, num));
      setHours(num);
      newHours = num;
    } else {
      num = Math.max(0, Math.min(59, num));
      setMinutes(num);
      newMinutes = num;
    }

    const baseDate = date || new Date();
    const updatedDate = new Date(baseDate);
    updatedDate.setHours(newHours);
    updatedDate.setMinutes(newMinutes);
    setDate(updatedDate);
    onChange?.(updatedDate);
  };

  const formatDateTime = (d: Date) => {
    return d.toLocaleDateString('en-US', {
      month: 'short',
      day: 'numeric',
      year: 'numeric',
      hour: '2-digit',
      minute: '2-digit',
    });
  };

  const handleMouseMove = (e: React.MouseEvent<HTMLButtonElement>) => {
    const rect = e.currentTarget.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    e.currentTarget.style.setProperty('--x', `${x}px`);
    e.currentTarget.style.setProperty('--y', `${y}px`);
  };

  return (
    <Popover open={isOpen} onOpenChange={setIsOpen}>
      <PopoverTrigger
        onMouseMove={handleMouseMove}
        className={cn(
          "group relative flex h-11 w-full items-center justify-between rounded-2xl border border-gray-200 dark:border-white/10 bg-gray-50 dark:bg-white/[0.03] px-4 py-2 text-sm text-gray-900 dark:text-white transition-all duration-200 overflow-hidden",
          "hover:bg-gray-100 dark:hover:bg-white/[0.06] focus:outline-none focus:ring-2 focus:ring-gray-400 dark:focus:ring-white/15",
          !date && "text-gray-400 dark:text-white/40",
          className
        )}
      >
        <div className="absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none"
             style={{
               background: `radial-gradient(600px circle at var(--x) var(--y), rgba(0,0,0,0.06), transparent 40%)`
             }}
        />
        <span className="relative z-10">{date ? formatDateTime(date) : placeholder}</span>
        <div className="flex items-center gap-2 text-gray-400 dark:text-white/40">
          <CalendarIcon className="h-4 w-4" />
          <Clock className="h-4 w-4" />
        </div>
      </PopoverTrigger>
      <PopoverContent className="w-auto p-0 border-none bg-transparent shadow-none" align="start">
        <div className="flex flex-col rounded-2xl border border-gray-200 dark:border-white/10 bg-white dark:bg-black/40 backdrop-blur-xl shadow-2xl dark:shadow-black/50">
          <div className="flex">
            <div className="p-4 border-r border-gray-200 dark:border-white/10">
              <Calendar
                value={date}
                onChange={handleDateSelect}
                className="border-0 p-0 bg-transparent backdrop-blur-none shadow-none rounded-none"
              />
            </div>
            
            <div className="flex flex-col p-4 w-[160px] h-[340px]">
              <div className="mb-3 text-sm font-medium text-gray-700 dark:text-white/70">Time</div>
              <div className="flex flex-1 gap-2 min-h-0 overflow-hidden">
                <ScrollArea className="flex-1 flex flex-col gap-1" scrollbarSize="sm">
                  <div className="text-xs text-gray-400 dark:text-white/40 text-center mb-1 sticky top-0 bg-white dark:bg-[#0A0A0A] py-1 z-10">Hr</div>
                  <div className="flex flex-col gap-1">
                    {Array.from({ length: 24 }).map((_, i) => (
                      <button
                        key={i}
                        onClick={() => handleTimeChange('hours', i.toString())}
                        className={cn(
                          "w-full rounded-lg px-1 py-1.5 text-sm transition-colors text-center shrink-0",
                          hours === i 
                            ? "bg-emerald-500 dark:bg-emerald-600/80 text-white font-medium" 
                            : "text-gray-700 dark:text-white/70 hover:bg-gray-100 dark:hover:bg-white/10 hover:text-gray-900 dark:hover:text-white"
                        )}
                      >
                        {i.toString().padStart(2, '0')}
                      </button>
                    ))}
                  </div>
                </ScrollArea>
                <div className="w-[1px] bg-gray-200 dark:bg-white/10" />
                <ScrollArea className="flex-1 flex flex-col gap-1" scrollbarSize="sm">
                  <div className="text-xs text-gray-400 dark:text-white/40 text-center mb-1 sticky top-0 bg-white dark:bg-[#0A0A0A] py-1 z-10">Min</div>
                  <div className="flex flex-col gap-1">
                    {Array.from({ length: 60 }).map((_, i) => (
                      <button
                        key={i}
                        onClick={() => handleTimeChange('minutes', i.toString())}
                        className={cn(
                          "w-full rounded-lg px-1 py-1.5 text-sm transition-colors text-center shrink-0",
                          minutes === i 
                            ? "bg-emerald-500 dark:bg-emerald-600/80 text-white font-medium" 
                            : "text-gray-700 dark:text-white/70 hover:bg-gray-100 dark:hover:bg-white/10 hover:text-gray-900 dark:hover:text-white"
                        )}
                      >
                        {i.toString().padStart(2, '0')}
                      </button>
                    ))}
                  </div>
                </ScrollArea>
              </div>
            </div>
          </div>
        </div>
      </PopoverContent>
    </Popover>
  );
}



=== FILE: packages\ui\src\components\form\FileDropzone.tsx ===

import React, { useState } from 'react';
import { cva, type VariantProps } from 'class-variance-authority';
import { Upload, X, File as FileIcon } from 'lucide-react';
import { cn } from '../../utils/cn';

const dropzoneVariants = cva(
  "relative flex flex-col items-center justify-center rounded-2xl border-2 border-dashed transition-all duration-200 text-center",
  {
    variants: {
      isDragActive: {
        true: "border-blue-500 bg-blue-50 dark:bg-blue-500/10",
        false: "border-gray-200 bg-gray-50 hover:bg-gray-100 dark:border-white/10 dark:bg-white/[0.02] dark:hover:bg-white/[0.05]",
      },
      error: {
        true: "border-rose-500 bg-rose-50 dark:bg-rose-500/10",
        false: "",
      }
    },
    defaultVariants: {
      isDragActive: false,
      error: false,
    },
  }
);

export interface FileDropzoneProps extends Omit<React.HTMLAttributes<HTMLDivElement>, 'onDrop'> {
  onDrop?: (files: File[]) => void;
  accept?: Record<string, string[]>; // e.g. { 'image/*': ['.png', '.jpg'] }
  maxFiles?: number;
  maxSize?: number; // in bytes
  label?: string;
  description?: string;
}

export const FileDropzone = React.forwardRef<HTMLDivElement, FileDropzoneProps>(
  ({ className, onDrop, maxFiles = 1, maxSize, label = "Upload files", description = "Drag & drop or click to upload", ...props }, ref) => {
    const [isDragActive, setIsDragActive] = useState(false);
    const [files, setFiles] = useState<File[]>([]);
    const [error, setError] = useState<string | null>(null);
    const inputRef = React.useRef<HTMLInputElement>(null);

    const handleDragOver = (e: React.DragEvent) => {
      e.preventDefault();
      setIsDragActive(true);
    };

    const handleDragLeave = (e: React.DragEvent) => {
      e.preventDefault();
      setIsDragActive(false);
    };

    const validateFiles = (fileList: File[]) => {
      if (maxFiles && fileList.length > maxFiles) {
        setError(`Max ${maxFiles} files allowed`);
        return false;
      }
      if (maxSize) {
        const oversized = fileList.some(f => f.size > maxSize);
        if (oversized) {
          setError(`File too large (max ${maxSize / 1024 / 1024}MB)`);
          return false;
        }
      }
      setError(null);
      return true;
    };

    const handleDrop = (e: React.DragEvent) => {
      e.preventDefault();
      setIsDragActive(false);
      
      const droppedFiles = Array.from(e.dataTransfer.files);
      if (validateFiles(droppedFiles)) {
        setFiles(droppedFiles);
        onDrop?.(droppedFiles);
      }
    };

    const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
      if (e.target.files) {
        const selectedFiles = Array.from(e.target.files);
        if (validateFiles(selectedFiles)) {
          setFiles(selectedFiles);
          onDrop?.(selectedFiles);
        }
      }
    };

    const removeFile = (index: number, e: React.MouseEvent) => {
      e.stopPropagation();
      const newFiles = files.filter((_, i) => i !== index);
      setFiles(newFiles);
      onDrop?.(newFiles);
    };

    return (
      <div className="w-full space-y-4">
        <div
          ref={ref}
          className={cn(dropzoneVariants({ isDragActive, error: !!error, className }), "p-8 cursor-pointer")}
          onDragOver={handleDragOver}
          onDragLeave={handleDragLeave}
          onDrop={handleDrop}
          onClick={() => inputRef.current?.click()}
          {...props}
        >
          <input 
            ref={inputRef}
            type="file" 
            className="hidden" 
            multiple={maxFiles > 1} 
            onChange={handleChange} 
          />
          
          <div className="mb-4 rounded-full bg-gray-100 p-3 dark:bg-white/10">
            <Upload className="h-6 w-6 text-gray-500 dark:text-white/70" />
          </div>
          <div className="text-sm font-medium text-gray-900 dark:text-white">
            {label}
          </div>
          <div className="mt-1 text-xs text-gray-500 dark:text-white/50">
            {description}
          </div>
          {error && (
            <div className="mt-2 text-xs font-medium text-rose-500">
              {error}
            </div>
          )}
        </div>

        {files.length > 0 && (
          <div className="grid gap-2">
            {files.map((file, i) => (
              <div key={i} className="flex items-center justify-between rounded-lg border border-gray-200 bg-white p-3 dark:border-white/10 dark:bg-white/5">
                <div className="flex items-center gap-3">
                  <div className="flex h-8 w-8 items-center justify-center rounded-lg bg-gray-100 dark:bg-white/10">
                    <FileIcon className="h-4 w-4 text-gray-500 dark:text-white/70" />
                  </div>
                  <div className="flex flex-col">
                    <span className="text-sm font-medium text-gray-900 dark:text-white truncate max-w-[200px]">{file.name}</span>
                    <span className="text-xs text-gray-500 dark:text-white/50">{(file.size / 1024).toFixed(1)} KB</span>
                  </div>
                </div>
                <button 
                  onClick={(e) => removeFile(i, e)}
                  className="rounded-full p-1 hover:bg-gray-100 dark:hover:bg-white/10 text-gray-500 dark:text-white/50"
                >
                  <X className="h-4 w-4" />
                </button>
              </div>
            ))}
          </div>
        )}
      </div>
    );
  }
);
FileDropzone.displayName = 'FileDropzone';



=== FILE: packages\ui\src\components\form\Form.tsx ===

import React from 'react';
import { cn } from '../../utils/cn';
import { Label } from './Label';

type FormItemContextValue = {
  id: string;
};

const FormItemContext = React.createContext<FormItemContextValue>({} as FormItemContextValue);

export const FormItem = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => {
    const id = React.useId();
    return (
      <FormItemContext.Provider value={{ id }}>
        <div ref={ref} className={cn("space-y-2", className)} {...props} />
      </FormItemContext.Provider>
    );
  }
);
FormItem.displayName = "FormItem";

export const FormLabel = React.forwardRef<React.ElementRef<typeof Label>, React.ComponentPropsWithoutRef<typeof Label>>(
  ({ className, ...props }, ref) => {
    const { id } = React.useContext(FormItemContext);
    return (
      <Label
        ref={ref}
        className={cn("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70", className)}
        htmlFor={id}
        {...props}
      />
    );
  }
);
FormLabel.displayName = "FormLabel";

export const FormControl = React.forwardRef<React.ElementRef<"div">, React.HTMLAttributes<HTMLDivElement>>(
  ({ ...props }, ref) => {
    const { id } = React.useContext(FormItemContext);
    const { children, ...rest } = props;
    
    if (React.isValidElement(children)) {
        return React.cloneElement(children as React.ReactElement, {
            id,
            "aria-describedby": `${id}-description ${id}-message`,
            ...rest,
            ...(children.props as any)
        });
    }
    return <div ref={ref} {...props} />;
  }
);
FormControl.displayName = "FormControl";

export const FormDescription = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLParagraphElement>>(
  ({ className, ...props }, ref) => {
    const { id } = React.useContext(FormItemContext);
    return (
      <p
        ref={ref}
        id={`${id}-description`}
        className={cn("text-xs text-white/50", className)}
        {...props}
      />
    );
  }
);
FormDescription.displayName = "FormDescription";

export const FormMessage = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLParagraphElement>>(
  ({ className, children, ...props }, ref) => {
    const { id } = React.useContext(FormItemContext);
    
    if (!children) {
      return null;
    }

    return (
      <p
        ref={ref}
        id={`${id}-message`}
        className={cn("text-xs font-medium text-rose-500", className)}
        {...props}
      >
        {children}
      </p>
    );
  }
);
FormMessage.displayName = "FormMessage";



=== FILE: packages\ui\src\components\form\Label.tsx ===

import React from 'react';
import { cn } from '../../utils/cn';

export interface LabelProps extends React.LabelHTMLAttributes<HTMLLabelElement> {
  required?: boolean;
}

export const Label = React.forwardRef<HTMLLabelElement, LabelProps>(
  ({ className, children, required, ...props }, ref) => {
    return (
      <label
        ref={ref}
        className={cn(
          'text-sm font-medium leading-none text-gray-700 dark:text-white/80 peer-disabled:cursor-not-allowed peer-disabled:opacity-70',
          className
        )}
        {...props}
      >
        {children}
        {required && <span className="ml-1 text-rose-500">*</span>}
      </label>
    );
  }
);

Label.displayName = 'Label';



=== FILE: packages\ui\src\components\form\NumberInput.tsx ===

import React from 'react';
import { cva, type VariantProps } from 'class-variance-authority';
import { Minus, Plus } from 'lucide-react';
import { cn } from '../../utils/cn';
import { Button } from '../button/Button';

const numberInputVariants = cva(
  "flex items-center rounded-2xl border bg-gray-50 dark:bg-white/5 dark:border-white/10",
  {
    variants: {
      size: {
        sm: "h-8",
        md: "h-10",
        lg: "h-12",
      },
      error: {
        true: "border-rose-500",
        false: "border-gray-200",
      }
    },
    defaultVariants: {
      size: "md",
      error: false
    }
  }
);

export interface NumberInputProps extends Omit<React.InputHTMLAttributes<HTMLInputElement>, 'size' | 'onChange'>, VariantProps<typeof numberInputVariants> {
  value?: number;
  onChange?: (value: number) => void;
  min?: number;
  max?: number;
  step?: number;
}

export const NumberInput = React.forwardRef<HTMLInputElement, NumberInputProps>(
  ({ className, size, error, value = 0, onChange, min = -Infinity, max = Infinity, step = 1, disabled, ...props }, ref) => {
    
    const handleDecrement = () => {
      if (value - step >= min) {
        onChange?.(value - step);
      }
    };

    const handleIncrement = () => {
      if (value + step <= max) {
        onChange?.(value + step);
      }
    };

    const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
      const val = parseFloat(e.target.value);
      if (!isNaN(val)) {
        onChange?.(val);
      }
    };

    return (
      <div className={cn(numberInputVariants({ size, error, className }))}>
        <button
          type="button"
          onClick={handleDecrement}
          disabled={disabled || value <= min}
          className="flex h-full items-center justify-center px-3 text-gray-500 hover:text-gray-900 disabled:opacity-50 dark:text-white/50 dark:hover:text-white"
        >
          <Minus className="h-3.5 w-3.5" />
        </button>
        
        <div className="h-full w-px bg-gray-200 dark:bg-white/10" />
        
        <input
          ref={ref}
          type="number"
          value={value}
          onChange={handleChange}
          disabled={disabled}
          className="h-full w-full min-w-[3rem] bg-transparent text-center text-sm font-medium text-gray-900 focus:outline-none dark:text-white"
          {...props}
        />
        
        <div className="h-full w-px bg-gray-200 dark:bg-white/10" />
        
        <button
          type="button"
          onClick={handleIncrement}
          disabled={disabled || value >= max}
          className="flex h-full items-center justify-center px-3 text-gray-500 hover:text-gray-900 disabled:opacity-50 dark:text-white/50 dark:hover:text-white"
        >
          <Plus className="h-3.5 w-3.5" />
        </button>
      </div>
    );
  }
);
NumberInput.displayName = "NumberInput";



=== FILE: packages\ui\src\components\form\OTPInput.tsx ===

import React, { useState, useRef, useEffect } from 'react';
import { cva, type VariantProps } from 'class-variance-authority';
import { cn } from '../../utils/cn';

const otpInputVariants = cva(
  "flex items-center gap-2",
  {
    variants: {
      size: {
        sm: "[&>input]:h-8 [&>input]:w-8 [&>input]:text-sm",
        md: "[&>input]:h-10 [&>input]:w-10 [&>input]:text-base",
        lg: "[&>input]:h-12 [&>input]:w-12 [&>input]:text-lg",
      }
    },
    defaultVariants: {
      size: "md"
    }
  }
);

export interface OTPInputProps extends Omit<React.HTMLAttributes<HTMLDivElement>, 'onChange'>, VariantProps<typeof otpInputVariants> {
  length?: number;
  value?: string;
  onChange?: (value: string) => void;
  onComplete?: (value: string) => void;
  disabled?: boolean;
  error?: boolean;
}

export const OTPInput = React.forwardRef<HTMLDivElement, OTPInputProps>(
  ({ className, size, length = 6, value = "", onChange, onComplete, disabled, error, ...props }, ref) => {
    const [localValue, setLocalValue] = useState<string[]>(new Array(length).fill(""));
    const inputsRef = useRef<(HTMLInputElement | null)[]>([]);

    useEffect(() => {
      const val = value.split("").slice(0, length);
      const newVal = [...val, ...new Array(length - val.length).fill("")];
      setLocalValue(newVal);
    }, [value, length]);

    const handleChange = (e: React.ChangeEvent<HTMLInputElement>, index: number) => {
      const val = e.target.value;
      if (isNaN(Number(val))) return;

      const newLocalValue = [...localValue];
      // Take the last character if multiple (paste scenario handled separately usually, but simple here)
      newLocalValue[index] = val.substring(val.length - 1);
      
      setLocalValue(newLocalValue);
      const stringValue = newLocalValue.join("");
      onChange?.(stringValue);

      if (val && index < length - 1) {
        inputsRef.current[index + 1]?.focus();
      }

      if (stringValue.length === length) {
        onComplete?.(stringValue);
      }
    };

    const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>, index: number) => {
      if (e.key === "Backspace" && !localValue[index] && index > 0) {
        inputsRef.current[index - 1]?.focus();
      }
    };

    const handlePaste = (e: React.ClipboardEvent) => {
      e.preventDefault();
      const pastedData = e.clipboardData.getData("text/plain").slice(0, length);
      if (!/^\d+$/.test(pastedData)) return;

      const newLocalValue = [...localValue];
      pastedData.split("").forEach((char, i) => {
        newLocalValue[i] = char;
      });
      setLocalValue(newLocalValue);
      const stringValue = newLocalValue.join("");
      onChange?.(stringValue);
      if (stringValue.length === length) onComplete?.(stringValue);
      inputsRef.current[Math.min(pastedData.length, length - 1)]?.focus();
    };

    return (
      <div ref={ref} className={cn(otpInputVariants({ size, className }))} {...props}>
        {localValue.map((digit, index) => (
          <input
            key={index}
            ref={el => inputsRef.current[index] = el}
            type="text"
            inputMode="numeric"
            maxLength={1}
            value={digit}
            disabled={disabled}
            onChange={(e) => handleChange(e, index)}
            onKeyDown={(e) => handleKeyDown(e, index)}
            onPaste={handlePaste}
            className={cn(
              "rounded-xl border bg-gray-50 text-center font-semibold transition-all duration-200",
              "focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 focus:outline-none",
              "disabled:opacity-50 disabled:cursor-not-allowed",
              "dark:bg-white/5 dark:text-white",
              error 
                ? "border-rose-500 text-rose-500 focus:border-rose-500 focus:ring-rose-500/20" 
                : "border-gray-200 dark:border-white/10"
            )}
          />
        ))}
      </div>
    );
  }
);
OTPInput.displayName = "OTPInput";



=== FILE: packages\ui\src\components\form\RadioGroup.tsx ===

import React, { createContext, useContext } from 'react';
import { cn } from '../../utils/cn';
import { Label } from './Label';

interface RadioGroupContextValue {
  value?: string;
  onChange?: (value: string) => void;
  name?: string;
  disabled?: boolean;
}

const RadioGroupContext = createContext<RadioGroupContextValue>({});

export interface RadioGroupProps extends Omit<React.HTMLAttributes<HTMLDivElement>, 'onChange'> {
  value?: string;
  onChange?: (value: string) => void;
  name?: string;
  disabled?: boolean;
  label?: string;
}

export const RadioGroup = React.forwardRef<HTMLDivElement, RadioGroupProps>(
  ({ className, value, onChange, name, disabled, label, children, ...props }, ref) => {
    const id = React.useId();
    
    return (
      <div ref={ref} className={cn("flex flex-col gap-2", className)} {...props}>
        {label && (
          <Label className={cn(disabled && "opacity-50 cursor-not-allowed")}>
            {label}
          </Label>
        )}
        <div className="flex flex-col gap-2" role="radiogroup">
          <RadioGroupContext.Provider value={{ value, onChange, name: name || id, disabled }}>
            {children}
          </RadioGroupContext.Provider>
        </div>
      </div>
    );
  }
);

RadioGroup.displayName = 'RadioGroup';

export interface RadioGroupItemProps extends React.InputHTMLAttributes<HTMLInputElement> {
  value: string;
  label?: string;
}

export const RadioGroupItem = React.forwardRef<HTMLInputElement, RadioGroupItemProps>(
  ({ className, value, label, disabled, ...props }, ref) => {
    const context = useContext(RadioGroupContext);
    const isChecked = context.value === value;
    const isDisabled = context.disabled || disabled;
    const id = React.useId();

    return (
      <label
        htmlFor={id}
        className={cn(
          "flex items-center gap-3 cursor-pointer group",
          isDisabled && "cursor-not-allowed opacity-50",
          className
        )}
      >
        <div className="relative flex items-center justify-center">
          <input
            ref={ref}
            id={id}
            type="radio"
            name={context.name}
            value={value}
            checked={isChecked}
            disabled={isDisabled}
            onChange={(e) => {
              if (e.target.checked) {
                context.onChange?.(value);
              }
            }}
            className="peer sr-only"
            {...props}
          />
          <div
            className={cn(
              "h-5 w-5 rounded-full border border-gray-300 dark:border-white/20 bg-gray-50 dark:bg-white/[0.03] transition-all duration-200",
              "peer-focus-visible:ring-2 peer-focus-visible:ring-gray-400 dark:peer-focus-visible:ring-white/20 peer-focus-visible:ring-offset-2 peer-focus-visible:ring-offset-white dark:peer-focus-visible:ring-offset-[#0A0A0A]",
              "group-hover:bg-gray-100 dark:group-hover:bg-white/[0.05]",
              isChecked && "border-gray-900 bg-gray-900 dark:border-white dark:bg-white"
            )}
          >
            {isChecked && (
              <div className="absolute inset-0 flex items-center justify-center">
                <div className="h-2 w-2 rounded-full bg-white dark:bg-black" />
              </div>
            )}
          </div>
        </div>
        {label && (
          <span className="text-sm text-gray-900 dark:text-white/90 select-none font-medium">
            {label}
          </span>
        )}
      </label>
    );
  }
);

RadioGroupItem.displayName = 'RadioGroupItem';



=== FILE: packages\ui\src\components\form\Select.tsx ===

import React, { useState, useRef, useEffect } from 'react';
import { cn } from '../../utils/cn';
import { Label } from './Label';

export interface SelectOption {
  label: string;
  value: string;
}

export interface SelectProps {
  label?: string;
  name?: string;
  options: SelectOption[];
  value?: string;
  defaultValue?: string;
  onChange?: (value: string) => void;
  placeholder?: string;
  error?: string;
  disabled?: boolean;
  className?: string;
}

export const Select = React.forwardRef<HTMLDivElement, SelectProps>(
  ({ label, name, options, value, defaultValue, onChange, placeholder = 'Select an option', error, disabled, className }, ref) => {
    const [isOpen, setIsOpen] = useState(false);
    const [internalValue, setInternalValue] = useState(defaultValue);
    const containerRef = useRef<HTMLDivElement>(null);
    const id = React.useId();

    const isControlled = value !== undefined;
    const currentValue = isControlled ? value : internalValue;
    const selectedOption = options.find((opt) => opt.value === currentValue);

    useEffect(() => {
      const handleClickOutside = (event: MouseEvent) => {
        if (containerRef.current && !containerRef.current.contains(event.target as Node)) {
          setIsOpen(false);
        }
      };

      document.addEventListener('mousedown', handleClickOutside);
      return () => document.removeEventListener('mousedown', handleClickOutside);
    }, []);

    const handleSelect = (optionValue: string) => {
      if (disabled) return;
      if (!isControlled) {
        setInternalValue(optionValue);
      }
      onChange?.(optionValue);
      setIsOpen(false);
    };

    const handleKeyDown = (e: React.KeyboardEvent) => {
      if (disabled) return;
      
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        setIsOpen(!isOpen);
      } else if (e.key === 'Escape') {
        setIsOpen(false);
      }
    };

    return (
      <div 
        ref={containerRef} 
        className={cn("flex flex-col gap-1.5 relative", className)}
      >
        {label && (
          <Label 
            htmlFor={id}
            className={cn(disabled && "opacity-50 cursor-not-allowed")}
          >
            {label}
          </Label>
        )}

        <div
          ref={ref}
          id={id}
          role="combobox"
          aria-expanded={isOpen}
          aria-haspopup="listbox"
          aria-controls={`${id}-listbox`}
          aria-disabled={disabled}
          tabIndex={disabled ? -1 : 0}
          onClick={() => !disabled && setIsOpen(!isOpen)}
          onKeyDown={handleKeyDown}
          className={cn(
            'w-full appearance-none rounded-2xl bg-gray-50 dark:bg-white/[0.04] px-4 py-3',
            'border border-gray-200 dark:border-white/[0.10]',
            'text-gray-900 dark:text-white flex items-center',
            'focus:outline-none focus:ring-2 focus:ring-purple-400/30',
            'hover:bg-gray-100 dark:hover:bg-white/[0.05] cursor-pointer',
            disabled && 'cursor-not-allowed opacity-50 hover:bg-gray-50 dark:hover:bg-white/[0.04]',
            isOpen && 'border-gray-300 dark:border-white/20 ring-2 ring-purple-400/20',
            error && 'border-rose-400/25 focus:ring-rose-300/25'
          )}
        >
          <span className={cn("block truncate", !selectedOption && "text-gray-400 dark:text-white/20")}>
            {selectedOption ? selectedOption.label : placeholder}
          </span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth="2"
            strokeLinecap="round"
            strokeLinejoin="round"
            className={cn(
              "absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 dark:text-white/40 transition-transform duration-200",
              isOpen && "rotate-180"
            )}
          >
            <path d="m6 9 6 6 6-6"/>
          </svg>
        </div>

        {isOpen && (
          <div className="absolute top-full left-0 z-50 mt-1 w-full overflow-hidden rounded-2xl border border-gray-200 dark:border-white/10 bg-white dark:bg-[#0A0A0A] p-1 shadow-xl animate-in fade-in zoom-in-95 duration-100">
            <ul
              id={`${id}-listbox`}
              role="listbox"
              className="max-h-60 overflow-auto p-1 flex flex-col gap-2"
            >
              {options.map((option) => (
                <li
                  key={option.value}
                  role="option"
                  aria-selected={currentValue === option.value}
                  onClick={() => handleSelect(option.value)}
                  className={cn(
                    'w-full rounded-xl px-3 py-2 text-left text-sm transition-colors cursor-pointer',
                    'hover:bg-gray-100 dark:hover:bg-white/10 hover:text-gray-900 dark:hover:text-white',
                    currentValue === option.value 
                      ? 'bg-gray-100 dark:bg-white/10 text-gray-900 dark:text-white/90' 
                      : 'text-gray-700 dark:text-white/80'
                  )}
                >
                  <div className="flex items-center justify-between gap-3">
                    <span className="flex-1 truncate">{option.label}</span>
                    {currentValue === option.value && (
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="14"
                        height="14"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        strokeWidth="2"
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        className="text-gray-900 dark:text-white"
                      >
                        <polyline points="20 6 9 17 4 12" />
                      </svg>
                    )}
                  </div>
                </li>
              ))}
            </ul>
          </div>
        )}

        {error && (
          <p className="text-xs text-rose-400 animate-in slide-in-from-top-1 fade-in duration-200">
            {error}
          </p>
        )}
        <input type="hidden" name={name} value={currentValue || ''} />
      </div>
    );
  }
);

Select.displayName = 'Select';



=== FILE: packages\ui\src\components\form\Slider.tsx ===

import React, { useState, useRef, useEffect, useCallback } from 'react';
import { cn } from '../../utils/cn';

export interface SliderProps extends Omit<React.HTMLAttributes<HTMLDivElement>, 'onChange'> {
  value?: number;
  defaultValue?: number;
  min?: number;
  max?: number;
  step?: number;
  onChange?: (value: number) => void;
  disabled?: boolean;
}

export const Slider = React.forwardRef<HTMLDivElement, SliderProps>(
  ({ className, value: controlledValue, defaultValue = 0, min = 0, max = 100, step = 1, onChange, disabled, ...props }, ref) => {
    const [internalValue, setInternalValue] = useState(defaultValue);
    const isControlled = controlledValue !== undefined;
    const value = isControlled ? controlledValue : internalValue;
    const trackRef = useRef<HTMLDivElement>(null);

    const percentage = ((value - min) / (max - min)) * 100;

    const handleMove = useCallback((clientX: number) => {
      if (disabled || !trackRef.current) return;

      const rect = trackRef.current.getBoundingClientRect();
      const width = rect.width;
      const left = rect.left;
      
      let newValue = ((clientX - left) / width) * (max - min) + min;
      
      // Clamp
      newValue = Math.min(Math.max(newValue, min), max);
      
      // Step
      const steps = Math.round((newValue - min) / step);
      newValue = min + steps * step;

      // Precision fix
      newValue = Number(newValue.toFixed(10)); // Avoid floating point errors

      if (!isControlled) {
        setInternalValue(newValue);
      }
      onChange?.(newValue);
    }, [disabled, isControlled, max, min, onChange, step]);

    const handleMouseDown = (e: React.MouseEvent) => {
      if (disabled) return;
      handleMove(e.clientX);

      const handleMouseMove = (e: MouseEvent) => {
        handleMove(e.clientX);
      };

      const handleMouseUp = () => {
        document.removeEventListener('mousemove', handleMouseMove);
        document.removeEventListener('mouseup', handleMouseUp);
      };

      document.addEventListener('mousemove', handleMouseMove);
      document.addEventListener('mouseup', handleMouseUp);
    };

    const handleTouchStart = (e: React.TouchEvent) => {
      if (disabled) return;
      const startTouch = e.touches[0];
      if (startTouch) {
        handleMove(startTouch.clientX);
      }

      const handleTouchMove = (e: TouchEvent) => {
        const moveTouch = e.touches[0];
        if (moveTouch) {
          handleMove(moveTouch.clientX);
        }
      };

      const handleTouchEnd = () => {
        document.removeEventListener('touchmove', handleTouchMove);
        document.removeEventListener('touchend', handleTouchEnd);
      };

      document.addEventListener('touchmove', handleTouchMove, { passive: false });
      document.addEventListener('touchend', handleTouchEnd);
    };

    const handleKeyDown = (e: React.KeyboardEvent) => {
      if (disabled) return;

      let newValue = value;
      if (e.key === 'ArrowRight' || e.key === 'ArrowUp') {
        newValue = Math.min(value + step, max);
      } else if (e.key === 'ArrowLeft' || e.key === 'ArrowDown') {
        newValue = Math.max(value - step, min);
      } else if (e.key === 'Home') {
        newValue = min;
      } else if (e.key === 'End') {
        newValue = max;
      } else {
        return;
      }

      e.preventDefault();
      if (newValue !== value) {
        if (!isControlled) {
          setInternalValue(newValue);
        }
        onChange?.(newValue);
      }
    };

    return (
      <div
        ref={ref}
        role="slider"
        aria-valuemin={min}
        aria-valuemax={max}
        aria-valuenow={value}
        aria-disabled={disabled}
        tabIndex={disabled ? -1 : 0}
        onKeyDown={handleKeyDown}
        className={cn(
          "relative flex w-full touch-none select-none items-center py-4 group",
          disabled && "opacity-50 cursor-not-allowed",
          className
        )}
        onMouseDown={handleMouseDown}
        onTouchStart={handleTouchStart}
        {...props}
      >
        <div
          ref={trackRef}
          className="relative h-1.5 w-full grow overflow-hidden rounded-full bg-gray-200 dark:bg-white/10 backdrop-blur-sm border border-gray-200 dark:border-white/5"
        >
          <div
            className="absolute h-full bg-gray-900 dark:bg-white transition-none dark:shadow-[0_0_10px_rgba(255,255,255,0.5)]"
            style={{ width: `${percentage}%` }}
          />
        </div>
        <div
          className="absolute h-5 w-5 rounded-full border-2 border-gray-900 dark:border-white bg-white dark:bg-black shadow-md dark:shadow-[0_0_15px_rgba(255,255,255,0.5)] transition-transform hover:scale-110 focus:scale-110"
          style={{ left: `calc(${percentage}% - 10px)` }}
        />
      </div>
    );
  }
);



=== FILE: packages\ui\src\components\form\Switch.tsx ===

import React from 'react';
import { cn } from '../../utils/cn';
import { Label } from './Label';

export interface SwitchProps extends Omit<React.ButtonHTMLAttributes<HTMLButtonElement>, 'onChange' | 'type'> {
  label?: string;
  error?: string;
  checked?: boolean;
  defaultChecked?: boolean;
  onChange?: (event: { target: { checked: boolean } }) => void;
}

export const Switch = React.forwardRef<HTMLButtonElement, SwitchProps>(
  ({ className, label, error, id, disabled, checked, defaultChecked, onChange, ...props }, ref) => {
    const inputId = id || React.useId();
    const [isChecked, setIsChecked] = React.useState(defaultChecked || checked || false);

    React.useEffect(() => {
      if (checked !== undefined) {
        setIsChecked(checked);
      }
    }, [checked]);

    const handleClick = () => {
      if (disabled) return;
      const newValue = !isChecked;
      setIsChecked(newValue);
      if (onChange) {
        onChange({ target: { checked: newValue } } as any);
      }
    };

    return (
      <div className={cn("flex flex-col gap-1.5", className)}>
        <div className="flex items-center gap-2">
          <button
            type="button"
            id={inputId}
            role="switch"
            aria-checked={isChecked}
            onClick={handleClick}
            disabled={disabled}
            className={cn(
              'peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-black disabled:cursor-not-allowed disabled:opacity-50',
              isChecked ? 'bg-emerald-500' : 'bg-gray-200 dark:bg-white/10'
            )}
            {...props}
          >
            <span
              className={cn(
                'pointer-events-none block h-5 w-5 rounded-full bg-white shadow-lg ring-0 transition-transform',
                isChecked ? 'translate-x-5' : 'translate-x-0'
              )}
            />
          </button>
          {label && (
            <Label 
              htmlFor={inputId} 
              className="cursor-pointer select-none text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
              onClick={handleClick}
            >
              {label}
            </Label>
          )}
        </div>
        {error && (
          <p className="text-xs text-rose-500 mt-1 ml-1">{error}</p>
        )}
      </div>
    );
  }
);

Switch.displayName = 'Switch';



=== FILE: packages\ui\src\components\form\Textarea.tsx ===

import React from 'react';
import { cn } from '../../utils/cn';
import { Label } from './Label';

export interface TextareaProps extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {
  label?: string;
  error?: string;
}

export const Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(
  ({ className, label, error, id, disabled, ...props }, ref) => {
    const generatedId = React.useId();
    const inputId = id || generatedId;

    return (
      <div className="flex flex-col gap-1.5">
        {label && (
          <Label 
            htmlFor={inputId}
            className={cn(disabled && "opacity-50 cursor-not-allowed")}
          >
            {label}
          </Label>
        )}
        
        <textarea
          ref={ref}
          id={inputId}
          disabled={disabled}
          className={cn(
            'w-full rounded-2xl bg-gray-50 dark:bg-white/[0.04] px-4 py-3',
            'border border-gray-200 dark:border-white/[0.10]',
            'text-gray-900 dark:text-white placeholder:text-gray-400 dark:placeholder:text-white/30',
            'focus:outline-none focus:ring-2 focus:ring-purple-400/30',
            'resize-none',
            'disabled:cursor-not-allowed disabled:opacity-50',
            error && 'border-rose-400/25 focus:ring-rose-300/25',
            className
          )}
          {...props}
        />

        {error && (
          <p className="text-xs text-rose-400 animate-in slide-in-from-top-1 fade-in duration-200">
            {error}
          </p>
        )}
      </div>
    );
  }
);

Textarea.displayName = 'Textarea';



=== FILE: packages\ui\src\components\form\TextInput.tsx ===

import React from 'react';
import { cva, type VariantProps } from 'class-variance-authority';
import { cn } from '../../utils/cn';
import { Label } from './Label';

const inputVariants = cva(
  "w-full rounded-2xl bg-gray-50 dark:bg-white/[0.04] px-4 py-3 border border-gray-200 dark:border-white/[0.10] text-gray-900 dark:text-white placeholder:text-gray-400 dark:placeholder:text-white/30 focus:outline-none focus:ring-2 focus:ring-purple-400/30 disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-200",
  {
    variants: {
      hasError: {
        true: "border-rose-400/25 focus:ring-rose-300/25",
        false: "",
      },
      hasLeftIcon: {
        true: "pl-10",
        false: "",
      },
      hasRightIcon: {
        true: "pr-10",
        false: "",
      },
    },
    defaultVariants: {
      hasError: false,
      hasLeftIcon: false,
      hasRightIcon: false,
    },
  }
);

export interface TextInputProps 
  extends Omit<React.InputHTMLAttributes<HTMLInputElement>, 'size'>,
    Omit<VariantProps<typeof inputVariants>, 'hasError'> {
  label?: string;
  error?: string;
  leftIcon?: React.ReactNode;
  rightIcon?: React.ReactNode;
  containerClassName?: string;
}

export const TextInput = React.forwardRef<HTMLInputElement, TextInputProps>(
  ({ className, containerClassName, label, error: errorMsg, leftIcon, rightIcon, id, ...props }, ref) => {
    const inputId = id || React.useId();
    const hasError = !!errorMsg;

    return (
      <div className={cn('flex flex-col gap-1.5', containerClassName)}>
        {label && <Label htmlFor={inputId} required={props.required}>{label}</Label>}
        
        <div className="relative flex items-center">
          {leftIcon && (
            <div className="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 dark:text-white/35">
              {leftIcon}
            </div>
          )}
          
          <input
            ref={ref}
            id={inputId}
            className={cn(inputVariants({ 
              hasError: hasError, 
              hasLeftIcon: !!leftIcon, 
              hasRightIcon: !!rightIcon, 
              className 
            }))}
            {...props}
          />

          {rightIcon && (
            <div className="absolute right-2 top-1/2 -translate-y-1/2">
              {rightIcon}
            </div>
          )}
        </div>

        {errorMsg && (
          <p className="text-xs text-rose-400 animate-in slide-in-from-top-1 fade-in duration-200">
            {errorMsg}
          </p>
        )}
      </div>
    );
  }
);

TextInput.displayName = 'TextInput';



=== FILE: packages\ui\src\components\form\ToggleGroup.tsx ===

import React from 'react';
import { cva, type VariantProps } from 'class-variance-authority';
import { cn } from '../../utils/cn';

const toggleGroupVariants = cva(
  "inline-flex items-center rounded-xl border border-gray-200 bg-gray-50 p-1 dark:border-white/10 dark:bg-white/5",
  {
    variants: {
      size: {
        sm: "h-8",
        md: "h-10",
        lg: "h-12",
      },
      fullWidth: {
        true: "w-full flex",
        false: "",
      }
    },
    defaultVariants: {
      size: "md",
      fullWidth: false
    }
  }
);

const toggleItemVariants = cva(
  "inline-flex items-center justify-center whitespace-nowrap rounded-lg px-3 py-1.5 text-sm font-medium ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-950 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 dark:ring-offset-gray-950 dark:focus-visible:ring-gray-300",
  {
    variants: {
      selected: {
        true: "bg-white text-gray-950 shadow-sm dark:bg-gray-800 dark:text-gray-50",
        false: "text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-50",
      },
      fullWidth: {
        true: "flex-1",
        false: "",
      }
    },
    defaultVariants: {
      selected: false,
      fullWidth: false
    }
  }
);

export interface ToggleGroupProps extends Omit<React.HTMLAttributes<HTMLDivElement>, 'onChange'>, VariantProps<typeof toggleGroupVariants> {
  value?: string;
  onChange?: (value: string) => void;
  options: { label: string; value: string; icon?: React.ReactNode }[];
}

export const ToggleGroup = React.forwardRef<HTMLDivElement, ToggleGroupProps>(
  ({ className, size, fullWidth, value, onChange, options, ...props }, ref) => {
    return (
      <div ref={ref} className={cn(toggleGroupVariants({ size, fullWidth, className }))} {...props}>
        {options.map((option) => (
          <button
            key={option.value}
            type="button"
            onClick={() => onChange?.(option.value)}
            className={cn(toggleItemVariants({ selected: value === option.value, fullWidth }))}
          >
            {option.icon && <span className="mr-2">{option.icon}</span>}
            {option.label}
          </button>
        ))}
      </div>
    );
  }
);
ToggleGroup.displayName = "ToggleGroup";



=== FILE: packages\ui\src\components\layout\Container.tsx ===

import React from 'react';
import { cn } from '../../utils/cn';

export interface ContainerProps extends React.HTMLAttributes<HTMLDivElement> {
  size?: 'sm' | 'md' | 'lg' | 'xl' | 'full';
}

export const Container = React.forwardRef<HTMLDivElement, ContainerProps>(
  ({ className, size = 'lg', ...props }, ref) => {
    const sizes = {
      sm: 'max-w-screen-sm',
      md: 'max-w-screen-md',
      lg: 'max-w-screen-lg',
      xl: 'max-w-screen-xl',
      full: 'max-w-full',
    };

    return (
      <div
        ref={ref}
        className={cn('mx-auto w-full px-4', sizes[size], className)}
        {...props}
      />
    );
  }
);
Container.displayName = 'Container';



=== FILE: packages\ui\src\components\layout\Grid.tsx ===

import React from 'react';
import { cn } from '../../utils/cn';

export interface GridProps extends React.HTMLAttributes<HTMLDivElement> {
  cols?: number;
  gap?: number | string;
}

export const Grid = React.forwardRef<HTMLDivElement, GridProps>(
  ({ className, cols = 1, gap = 4, style, ...props }, ref) => {
    return (
      <div
        ref={ref}
        className={cn('grid', className)}
        style={{
            gridTemplateColumns: `repeat(${cols}, minmax(0, 1fr))`,
            gap: typeof gap === 'number' ? `${gap * 0.25}rem` : gap,
            ...style
        }}
        {...props}
      />
    );
  }
);
Grid.displayName = 'Grid';



=== FILE: packages\ui\src\components\layout\Spotlight.tsx ===

import React, { useState, useRef, useEffect } from 'react';
import { cn } from '../../utils/cn';

export interface SpotlightProps extends React.HTMLAttributes<HTMLDivElement> {
  children: React.ReactNode;
  size?: number;
  color?: string;
}

export const Spotlight = ({ 
  children, 
  className, 
  size = 300, 
  color = "rgba(255, 255, 255, 0.1)",
  ...props 
}: SpotlightProps) => {
  const divRef = useRef<HTMLDivElement>(null);
  const [position, setPosition] = useState({ x: 0, y: 0 });
  const [opacity, setOpacity] = useState(0);

  const handleMouseMove = (e: React.MouseEvent<HTMLDivElement>) => {
    if (!divRef.current) return;

    const rect = divRef.current.getBoundingClientRect();
    setPosition({ x: e.clientX - rect.left, y: e.clientY - rect.top });
  };

  const handleMouseEnter = () => {
    setOpacity(1);
  };

  const handleMouseLeave = () => {
    setOpacity(0);
  };

  return (
    <div
      ref={divRef}
      onMouseMove={handleMouseMove}
      onMouseEnter={handleMouseEnter}
      onMouseLeave={handleMouseLeave}
      className={cn(
        "relative overflow-hidden rounded-xl border border-gray-200 bg-white dark:border-white/10 dark:bg-black",
        className
      )}
      {...props}
    >
      <div
        className="pointer-events-none absolute -inset-px transition-opacity duration-300"
        style={{
          opacity,
          background: `radial-gradient(${size}px circle at ${position.x}px ${position.y}px, ${color}, transparent 80%)`,
        }}
      />
      <div className="relative h-full">{children}</div>
    </div>
  );
};



=== FILE: packages\ui\src\components\layout\Stack.tsx ===

import React from 'react';
import { cn } from '../../utils/cn';

export interface StackProps extends React.HTMLAttributes<HTMLDivElement> {
  direction?: 'row' | 'col' | 'row-reverse' | 'col-reverse';
  gap?: number | string;
  align?: 'start' | 'end' | 'center' | 'baseline' | 'stretch';
  justify?: 'start' | 'end' | 'center' | 'between' | 'around' | 'evenly';
  wrap?: boolean;
}

export const Stack = React.forwardRef<HTMLDivElement, StackProps>(
  ({ className, direction = 'col', gap = 4, align, justify, wrap, style, ...props }, ref) => {
    return (
      <div
        ref={ref}
        className={cn(
          'flex',
          {
            'flex-row': direction === 'row',
            'flex-col': direction === 'col',
            'flex-row-reverse': direction === 'row-reverse',
            'flex-col-reverse': direction === 'col-reverse',
            'flex-wrap': wrap,
            'items-start': align === 'start',
            'items-end': align === 'end',
            'items-center': align === 'center',
            'items-baseline': align === 'baseline',
            'items-stretch': align === 'stretch',
            'justify-start': justify === 'start',
            'justify-end': justify === 'end',
            'justify-center': justify === 'center',
            'justify-between': justify === 'between',
            'justify-around': justify === 'around',
            'justify-evenly': justify === 'evenly',
          },
          className
        )}
        style={{
            gap: typeof gap === 'number' ? `${gap * 0.25}rem` : gap,
            ...style
        }}
        {...props}
      />
    );
  }
);
Stack.displayName = 'Stack';



=== FILE: packages\ui\src\components\navigation\Breadcrumb.tsx ===

import React from 'react';
import { cn } from '../../utils/cn';

const Breadcrumb = React.forwardRef<
  HTMLElement,
  React.ComponentPropsWithoutRef<"nav"> & {
    separator?: React.ReactNode
  }
>(({ ...props }, ref) => <nav ref={ref} aria-label="breadcrumb" {...props} />)
Breadcrumb.displayName = "Breadcrumb"

const BreadcrumbList = React.forwardRef<
  HTMLOListElement,
  React.ComponentPropsWithoutRef<"ol">
>(({ className, ...props }, ref) => (
  <ol
    ref={ref}
    className={cn(
      "flex flex-wrap items-center gap-1.5 break-words text-sm text-gray-500 dark:text-white/50 sm:gap-2.5",
      className
    )}
    {...props}
  />
))
BreadcrumbList.displayName = "BreadcrumbList"

const BreadcrumbItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentPropsWithoutRef<"li">
>(({ className, ...props }, ref) => (
  <li
    ref={ref}
    className={cn("inline-flex items-center gap-1.5", className)}
    {...props}
  />
))
BreadcrumbItem.displayName = "BreadcrumbItem"

const BreadcrumbLink = React.forwardRef<
  HTMLAnchorElement,
  React.ComponentPropsWithoutRef<"a"> & {
    asChild?: boolean
  }
>(({ className, ...props }, ref) => {
  return (
    <a
      ref={ref}
      className={cn("transition-colors hover:text-gray-900 dark:hover:text-white", className)}
      {...props}
    />
  )
})
BreadcrumbLink.displayName = "BreadcrumbLink"

const BreadcrumbPage = React.forwardRef<
  HTMLSpanElement,
  React.ComponentPropsWithoutRef<"span">
>(({ className, ...props }, ref) => (
  <span
    ref={ref}
    role="link"
    aria-disabled="true"
    aria-current="page"
    className={cn("font-normal text-gray-900 dark:text-white", className)}
    {...props}
  />
))
BreadcrumbPage.displayName = "BreadcrumbPage"

const BreadcrumbSeparator = ({
  children,
  className,
  ...props
}: React.ComponentProps<"li">) => (
  <li
    role="presentation"
    aria-hidden="true"
    className={cn("[&>svg]:size-3.5", className)}
    {...props}
  >
    {children ?? (
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        strokeWidth="2"
        strokeLinecap="round"
        strokeLinejoin="round"
        className="h-4 w-4"
      >
        <path d="m9 18 6-6-6-6" />
      </svg>
    )}
  </li>
)
BreadcrumbSeparator.displayName = "BreadcrumbSeparator"

const BreadcrumbEllipsis = ({
  className,
  ...props
}: React.ComponentProps<"span">) => (
  <span
    role="presentation"
    aria-hidden="true"
    className={cn("flex h-9 w-9 items-center justify-center", className)}
    {...props}
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      strokeWidth="2"
      strokeLinecap="round"
      strokeLinejoin="round"
      className="h-4 w-4"
    >
      <circle cx="12" cy="12" r="1" />
      <circle cx="19" cy="12" r="1" />
      <circle cx="5" cy="12" r="1" />
    </svg>
    <span className="sr-only">More</span>
  </span>
)
BreadcrumbEllipsis.displayName = "BreadcrumbElipssis"

export {
  Breadcrumb,
  BreadcrumbList,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbPage,
  BreadcrumbSeparator,
  BreadcrumbEllipsis,
}



=== FILE: packages\ui\src\components\navigation\Pagination.tsx ===

import React from 'react';
import { cn } from '../../utils/cn';
import { PrimaryButton } from '../button/PrimaryButton';

const Pagination = ({ className, ...props }: React.ComponentProps<"nav">) => (
  <nav
    role="navigation"
    aria-label="pagination"
    className={cn("mx-auto flex w-full justify-center", className)}
    {...props}
  />
)
Pagination.displayName = "Pagination"

const PaginationContent = React.forwardRef<
  HTMLUListElement,
  React.ComponentProps<"ul">
>(({ className, ...props }, ref) => (
  <ul
    ref={ref}
    className={cn("flex flex-row items-center gap-1", className)}
    {...props}
  />
))
PaginationContent.displayName = "PaginationContent"

const PaginationItem = React.forwardRef<
  HTMLLIElement,
  React.ComponentProps<"li">
>(({ className, ...props }, ref) => (
  <li ref={ref} className={cn("", className)} {...props} />
))
PaginationItem.displayName = "PaginationItem"

type PaginationLinkProps = {
  isActive?: boolean
} & React.ComponentProps<"a">

const PaginationLink = ({
  className,
  isActive,
  ...props
}: PaginationLinkProps) => (
  <a
    aria-current={isActive ? "page" : undefined}
    className={cn(
      "inline-flex h-9 w-9 items-center justify-center rounded-xl text-sm font-medium transition-colors",
      "hover:bg-gray-100 dark:hover:bg-white/5 hover:text-gray-900 dark:hover:text-white",
      isActive ? "bg-gray-100 text-gray-900 dark:bg-white/10 dark:text-white" : "text-gray-500 dark:text-white/60",
      className
    )}
    {...props}
  />
)
PaginationLink.displayName = "PaginationLink"

const PaginationPrevious = ({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) => (
  <PaginationLink
    aria-label="Go to previous page"
    className={cn("w-auto gap-1 px-2.5", className)}
    {...props}
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      strokeWidth="2"
      strokeLinecap="round"
      strokeLinejoin="round"
      className="h-4 w-4"
    >
      <path d="m15 18-6-6 6-6" />
    </svg>
    <span>Previous</span>
  </PaginationLink>
)
PaginationPrevious.displayName = "PaginationPrevious"

const PaginationNext = ({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) => (
  <PaginationLink
    aria-label="Go to next page"
    className={cn("w-auto gap-1 px-2.5", className)}
    {...props}
  >
    <span>Next</span>
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      strokeWidth="2"
      strokeLinecap="round"
      strokeLinejoin="round"
      className="h-4 w-4"
    >
      <path d="m9 18 6-6-6-6" />
    </svg>
  </PaginationLink>
)
PaginationNext.displayName = "PaginationNext"

const PaginationEllipsis = ({
  className,
  ...props
}: React.ComponentProps<"span">) => (
  <span
    aria-hidden
    className={cn("flex h-9 w-9 items-center justify-center", className)}
    {...props}
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      strokeWidth="2"
      strokeLinecap="round"
      strokeLinejoin="round"
      className="h-4 w-4"
    >
      <circle cx="12" cy="12" r="1" />
      <circle cx="19" cy="12" r="1" />
      <circle cx="5" cy="12" r="1" />
    </svg>
    <span className="sr-only">More pages</span>
  </span>
)
PaginationEllipsis.displayName = "PaginationEllipsis"

export {
  Pagination,
  PaginationContent,
  PaginationEllipsis,
  PaginationItem,
  PaginationLink,
  PaginationNext,
  PaginationPrevious,
}



=== FILE: packages\ui\src\components\navigation\Sidebar.tsx ===

import React from 'react';
import { cn } from '../../utils/cn';

export interface SidebarProps extends React.HTMLAttributes<HTMLDivElement> {
  children: React.ReactNode;
}

export const Sidebar = React.forwardRef<HTMLDivElement, SidebarProps>(
  ({ className, children, ...props }, ref) => {
    return (
      <aside
        ref={ref}
        className={cn(
          "flex h-full w-64 flex-col border-r backdrop-blur-xl transition-colors duration-200",
          "border-gray-200 bg-white/50",
          "dark:border-white/10 dark:bg-black/20",
          className
        )}
        {...props}
      >
        {children}
      </aside>
    );
  }
);

export interface SidebarHeaderProps extends React.HTMLAttributes<HTMLDivElement> {}

export const SidebarHeader = React.forwardRef<HTMLDivElement, SidebarHeaderProps>(
  ({ className, children, ...props }, ref) => {
    return (
      <div
        ref={ref}
        className={cn("flex h-16 items-center px-6 border-b border-gray-200 dark:border-white/5", className)}
        {...props}
      >
        {children}
      </div>
    );
  }
);

export interface SidebarContentProps extends React.HTMLAttributes<HTMLDivElement> {}

export const SidebarContent = React.forwardRef<HTMLDivElement, SidebarContentProps>(
  ({ className, children, ...props }, ref) => {
    return (
      <div
        ref={ref}
        className={cn("flex-1 overflow-y-auto py-4 px-3 space-y-1", className)}
        {...props}
      >
        {children}
      </div>
    );
  }
);

export interface SidebarFooterProps extends React.HTMLAttributes<HTMLDivElement> {}

export const SidebarFooter = React.forwardRef<HTMLDivElement, SidebarFooterProps>(
  ({ className, children, ...props }, ref) => {
    return (
      <div
        ref={ref}
        className={cn("p-4 border-t border-gray-200 dark:border-white/5", className)}
        {...props}
      >
        {children}
      </div>
    );
  }
);

export interface SidebarItemProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  active?: boolean;
  icon?: React.ReactNode;
  badge?: React.ReactNode;
}

export const SidebarItem = React.forwardRef<HTMLButtonElement, SidebarItemProps>(
  ({ className, children, active, icon, badge, ...props }, ref) => {
    return (
      <button
        ref={ref}
        className={cn(
          "flex w-full items-center gap-3 rounded-xl px-3 py-2 text-sm font-medium transition-colors",
          "hover:bg-gray-100 hover:text-gray-900 dark:hover:bg-white/5 dark:hover:text-white",
          active 
            ? "bg-gray-200 text-gray-900 dark:bg-white/10 dark:text-white" 
            : "text-gray-600 dark:text-white/60",
          className
        )}
        {...props}
      >
        {icon && <span className={cn("flex h-4 w-4 items-center justify-center", active ? "text-gray-900 dark:text-white" : "text-gray-500 dark:text-white/60")}>{icon}</span>}
        <span className="flex-1 text-left">{children}</span>
        {badge && (
          <span className="flex h-5 min-w-5 items-center justify-center rounded-full bg-gray-200 dark:bg-white/10 px-1.5 text-[10px] font-bold text-gray-900 dark:text-white">
            {badge}
          </span>
        )}
      </button>
    );
  }
);

export interface SidebarGroupProps extends React.HTMLAttributes<HTMLDivElement> {
  label?: string;
}

export const SidebarGroup = React.forwardRef<HTMLDivElement, SidebarGroupProps>(
  ({ className, children, label, ...props }, ref) => {
    return (
      <div ref={ref} className={cn("mb-6", className)} {...props}>
        {label && (
          <div className="mb-2 px-3 text-xs font-semibold uppercase tracking-wider text-gray-500 dark:text-white/40">
            {label}
          </div>
        )}
        <div className="space-y-1">{children}</div>
      </div>
    );
  }
);



=== FILE: packages\ui\src\components\navigation\Stepper.tsx ===

import React from 'react';
import { Check } from 'lucide-react';
import { cn } from '../../utils/cn';

export interface StepperProps {
  steps: { title: string; description?: string }[];
  currentStep: number;
  className?: string;
  onStepClick?: (step: number) => void;
}

export const Stepper = ({ steps, currentStep, className, onStepClick }: StepperProps) => {
  return (
    <div className={cn("flex w-full flex-col gap-4 md:flex-row", className)}>
      {steps.map((step, index) => {
        const isCompleted = currentStep > index;
        const isCurrent = currentStep === index;
        const isClickable = !!onStepClick;

        return (
          <div 
            key={index} 
            className={cn(
              "flex flex-1 flex-col gap-2 md:flex-row md:items-center md:gap-4",
              isClickable && "cursor-pointer"
            )}
            onClick={() => isClickable && onStepClick(index)}
          >
            <div className="flex items-center gap-4 md:flex-col md:gap-2">
              <div className="flex items-center">
                <div
                  className={cn(
                    "flex h-8 w-8 items-center justify-center rounded-full border-2 text-sm font-semibold transition-colors",
                    isCompleted
                      ? "border-blue-600 bg-blue-600 text-white dark:border-blue-500 dark:bg-blue-500"
                      : isCurrent
                      ? "border-blue-600 text-blue-600 dark:border-blue-500 dark:text-blue-500"
                      : "border-gray-300 text-gray-500 dark:border-white/20 dark:text-white/40"
                  )}
                >
                  {isCompleted ? <Check className="h-4 w-4" /> : index + 1}
                </div>
                {/* Connector Line (Mobile: Right of circle, Desktop: Right of content) */}
                {index < steps.length - 1 && (
                  <div 
                    className={cn(
                      "ml-4 h-px flex-1 bg-gray-200 md:hidden dark:bg-white/10",
                      isCompleted && "bg-blue-600 dark:bg-blue-500"
                    )} 
                  />
                )}
              </div>
              
              <div className="flex flex-col">
                <span className={cn(
                  "text-sm font-medium",
                  isCurrent || isCompleted ? "text-gray-900 dark:text-white" : "text-gray-500 dark:text-white/50"
                )}>
                  {step.title}
                </span>
                {step.description && (
                  <span className="text-xs text-gray-500 dark:text-white/40 hidden md:block">
                    {step.description}
                  </span>
                )}
              </div>
            </div>

            {/* Connector Line (Desktop) */}
            {index < steps.length - 1 && (
              <div 
                className={cn(
                  "hidden h-px flex-1 bg-gray-200 md:block dark:bg-white/10",
                  isCompleted && "bg-blue-600 dark:bg-blue-500"
                )} 
              />
            )}
          </div>
        );
      })}
    </div>
  );
};



=== FILE: packages\ui\src\components\navigation\Tabs.tsx ===

import React, { createContext, useContext, useState } from 'react';
import { cn } from '../../utils/cn';

interface TabsContextValue {
  value: string;
  onValueChange: (value: string) => void;
}

const TabsContext = createContext<TabsContextValue | undefined>(undefined);

export interface TabsProps extends React.HTMLAttributes<HTMLDivElement> {
  defaultValue: string;
  value?: string;
  onValueChange?: (value: string) => void;
  children: React.ReactNode;
}

export function Tabs({
  defaultValue,
  value,
  onValueChange,
  className,
  children,
  ...props
}: TabsProps) {
  const [internalValue, setInternalValue] = useState(defaultValue);

  const handleValueChange = (newValue: string) => {
    if (value === undefined) {
      setInternalValue(newValue);
    }
    onValueChange?.(newValue);
  };

  const currentValue = value !== undefined ? value : internalValue;

  return (
    <TabsContext.Provider value={{ value: currentValue, onValueChange: handleValueChange }}>
      <div className={cn("w-full", className)} {...props}>
        {children}
      </div>
    </TabsContext.Provider>
  );
}

export interface TabsListProps extends React.HTMLAttributes<HTMLDivElement> {
  children: React.ReactNode;
}

export function TabsList({ className, children, ...props }: TabsListProps) {
  return (
    <div
      className={cn(
        "inline-flex h-10 items-center justify-center rounded-lg bg-gray-100 p-1 text-gray-500 dark:bg-white/5 dark:text-white/60",
        className
      )}
      {...props}
    >
      {children}
    </div>
  );
}

export interface TabsTriggerProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  value: string;
  children: React.ReactNode;
}

export function TabsTrigger({ className, value, children, ...props }: TabsTriggerProps) {
  const context = useContext(TabsContext);
  if (!context) throw new Error('TabsTrigger must be used within Tabs');

  const isActive = context.value === value;

  return (
    <button
      type="button"
      role="tab"
      aria-selected={isActive}
      onClick={() => context.onValueChange(value)}
      className={cn(
        "inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-gray-400 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 dark:ring-offset-zinc-950 dark:focus-visible:ring-white/20",
        isActive
          ? "bg-white text-gray-900 shadow-sm dark:bg-white/10 dark:text-white dark:backdrop-blur-sm"
          : "hover:bg-gray-200 hover:text-gray-900 dark:hover:bg-white/5 dark:hover:text-white",
        className
      )}
      {...props}
    >
      {children}
    </button>
  );
}

export interface TabsContentProps extends React.HTMLAttributes<HTMLDivElement> {
  value: string;
  children: React.ReactNode;
}

export function TabsContent({ className, value, children, ...props }: TabsContentProps) {
  const context = useContext(TabsContext);
  if (!context) throw new Error('TabsContent must be used within Tabs');

  if (context.value !== value) return null;

  return (
    <div
      role="tabpanel"
      className={cn(
        "mt-2 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/20 focus-visible:ring-offset-2",
        className
      )}
      {...props}
    >
      {children}
    </div>
  );
}



=== FILE: packages\ui\src\components\navigation\UserMenu.tsx ===

import React from 'react';
import { Settings, LogOut, User } from 'lucide-react';
import { Avatar } from '../data-display/Avatar';
import { 
  DropdownMenu, 
  DropdownMenuTrigger, 
  DropdownMenuContent, 
  DropdownMenuItem, 
  DropdownMenuSeparator,
  DropdownMenuLabel
} from '../overlay/DropdownMenu';
import { cn } from '../../utils/cn';

export interface UserMenuProps {
  name: string;
  description?: string;
  avatarSrc?: string;
  avatarFallback?: string;
  className?: string;
  side?: 'top' | 'bottom' | 'left' | 'right';
  align?: 'start' | 'end' | 'center';
}

export function UserMenu({ 
  name, 
  description, 
  avatarSrc, 
  avatarFallback,
  className,
  side = 'top',
  align = 'start'
}: UserMenuProps) {
  return (
    <DropdownMenu>
      <DropdownMenuTrigger className={cn("w-full outline-none", className)}>
        <div className="group flex w-full items-center gap-3 rounded-xl border border-gray-200 dark:border-white/5 bg-white dark:bg-white/5 p-3 transition-colors hover:bg-gray-50 dark:hover:bg-white/10">
          <Avatar src={avatarSrc} fallback={avatarFallback || name.charAt(0)} size="sm" />
          <div className="flex flex-1 flex-col items-start text-left">
            <span className="text-xs font-medium text-gray-900 dark:text-white">{name}</span>
            {description && <span className="text-[10px] text-gray-500 dark:text-white/50">{description}</span>}
          </div>
          <Settings className="h-4 w-4 text-gray-400 dark:text-white/50 transition-colors group-hover:text-gray-900 dark:group-hover:text-white" />
        </div>
      </DropdownMenuTrigger>
      <DropdownMenuContent className="w-56" align={align} side={side}>
        <DropdownMenuLabel>My Account</DropdownMenuLabel>
        <DropdownMenuSeparator />
        <DropdownMenuItem>
          <User className="mr-2 h-4 w-4" />
          <span>Profile</span>
        </DropdownMenuItem>
        <DropdownMenuItem>
          <Settings className="mr-2 h-4 w-4" />
          <span>Settings</span>
        </DropdownMenuItem>
        <DropdownMenuSeparator />
        <DropdownMenuItem className="text-rose-400 focus:text-rose-400">
          <LogOut className="mr-2 h-4 w-4" />
          <span>Log out</span>
        </DropdownMenuItem>
      </DropdownMenuContent>
    </DropdownMenu>
  );
}



=== FILE: packages\ui\src\components\overlay\Command.tsx ===

import React, { useEffect, useRef, useState } from 'react';
import { createPortal } from 'react-dom';
import { cn } from '../../utils/cn';
import { Combobox, ComboboxInput, ComboboxList, ComboboxItem, ComboboxEmpty, ComboboxProps } from '../form/Combobox';
import { Search } from 'lucide-react';

export interface CommandDialogProps extends ComboboxProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
}

export function Command({ children, ...props }: ComboboxProps) {
  return (
    <div className="flex h-full w-full flex-col overflow-hidden rounded-xl bg-white dark:bg-black/90 text-gray-900 dark:text-white">
      <Combobox usePopover={false} {...props}>
        {children}
      </Combobox>
    </div>
  );
}

export function CommandDialog({ 
  children, 
  open, 
  onOpenChange,
  ...props 
}: CommandDialogProps) {
  const overlayRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    const handleEscape = (e: KeyboardEvent) => {
      if (e.key === 'Escape') onOpenChange(false);
    };

    if (open) {
      document.addEventListener('keydown', handleEscape);
      document.body.style.overflow = 'hidden';
    }

    return () => {
      document.removeEventListener('keydown', handleEscape);
      document.body.style.overflow = 'unset';
    };
  }, [open, onOpenChange]);

  const handleBackdropClick = (e: React.MouseEvent) => {
    if (e.target === overlayRef.current) {
      onOpenChange(false);
    }
  };

  if (!open) return null;

  return createPortal(
    <div
      ref={overlayRef}
      onClick={handleBackdropClick}
      className="fixed inset-0 z-50 flex items-start justify-center bg-black/60 backdrop-blur-sm animate-in fade-in duration-200 pt-[20vh]"
    >
      <div className="relative w-full max-w-lg overflow-hidden rounded-2xl border border-gray-200 dark:border-white/10 bg-white dark:bg-black/90 shadow-2xl animate-in zoom-in-95 duration-200">
        <Combobox usePopover={false} {...props}>
          {children}
        </Combobox>
      </div>
    </div>,
    document.body
  );
}

export function CommandInput({ className, ...props }: React.InputHTMLAttributes<HTMLInputElement>) {
  return (
    <div className="flex items-center border-b border-gray-200 dark:border-white/10 px-3" cmdk-input-wrapper="">
      <Search className="mr-2 h-4 w-4 shrink-0 opacity-50" />
      <ComboboxInput 
        className={cn(
          "flex h-12 w-full rounded-md bg-transparent py-3 text-sm text-gray-900 dark:text-white outline-none placeholder:text-gray-400 dark:placeholder:text-white/50 disabled:cursor-not-allowed disabled:opacity-50 border-none focus:ring-0 px-0",
          className
        )}
        {...props}
      />
    </div>
  );
}

export function CommandList({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <ComboboxList 
      className={cn("max-h-[300px] overflow-y-auto overflow-x-hidden p-2", className)} 
      {...props} 
    />
  );
}

export function CommandEmpty(props: React.HTMLAttributes<HTMLDivElement>) {
  return <ComboboxEmpty className="py-6 text-center text-sm" {...props} />;
}

export function CommandGroup({ 
  children, 
  heading, 
  className, 
  ...props 
}: React.HTMLAttributes<HTMLDivElement> & { heading?: React.ReactNode }) {
  return (
    <div className={cn("overflow-hidden p-1 text-gray-900 dark:text-white", className)} {...props}>
      {heading && (
        <div className="px-2 py-1.5 text-xs font-medium text-gray-500 dark:text-white/50">
          {heading}
        </div>
      )}
      {children}
    </div>
  );
}

export function CommandItem({ 
  className, 
  ...props 
}: React.ComponentProps<typeof ComboboxItem>) {
  return (
    <ComboboxItem 
      className={cn(
        "relative flex cursor-default select-none items-center rounded-lg px-2 py-1.5 text-sm outline-none text-gray-900 dark:text-white aria-selected:bg-gray-100 dark:aria-selected:bg-white/10 aria-selected:text-gray-900 dark:aria-selected:text-white data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
        className
      )} 
      {...props} 
    />
  );
}

export function CommandShortcut({ className, ...props }: React.HTMLAttributes<HTMLSpanElement>) {
  return (
    <span
      className={cn(
        "ml-auto text-xs tracking-widest text-gray-400 dark:text-white/50",
        className
      )}
      {...props}
    />
  );
}



=== FILE: packages\ui\src\components\overlay\Dialog.tsx ===

import React, { useEffect, useRef } from 'react';
import { createPortal } from 'react-dom';
import { cn } from '../../utils/cn';
import { Heading } from '../typography/Heading';

export interface DialogProps {
  isOpen: boolean;
  onClose: () => void;
  children: React.ReactNode;
  className?: string;
}

export function Dialog({ isOpen, onClose, children, className }: DialogProps) {
  const dialogRef = useRef<HTMLDialogElement>(null);

  useEffect(() => {
    const dialog = dialogRef.current;
    if (!dialog) return;

    if (isOpen) {
      if (!dialog.open) {
        dialog.showModal();
      }
    } else {
      if (dialog.open) {
        dialog.close();
      }
    }
  }, [isOpen]);

  useEffect(() => {
    const dialog = dialogRef.current;
    if (!dialog) return;

    const handleCancel = (e: Event) => {
      e.preventDefault();
      onClose();
    };

    dialog.addEventListener('cancel', handleCancel);
    return () => dialog.removeEventListener('cancel', handleCancel);
  }, [onClose]);

  const handleBackdropClick = (e: React.MouseEvent) => {
    if (e.target === dialogRef.current) {
      onClose();
    }
  };

  return createPortal(
    <dialog
      ref={dialogRef}
      onClick={handleBackdropClick}
      className={cn(
        "fixed inset-0 z-50 bg-transparent p-0 backdrop:bg-black/60 backdrop:backdrop-blur-sm",
        "open:animate-in open:fade-in open:duration-200",
        className
      )}
    >
      <div
        className={cn(
          "relative w-full max-w-lg scale-100 gap-4 border border-gray-200 dark:border-white/10 bg-white dark:bg-[#0A0A0A]/90 p-6 shadow-2xl backdrop-blur-xl transition-all sm:rounded-2xl",
          "animate-in fade-in zoom-in-95 duration-200 slide-in-from-bottom-2"
        )}
      >
        {children}
        <button
          onClick={onClose}
          className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-gray-400 dark:focus:ring-white/20 disabled:pointer-events-none"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-gray-900 dark:text-white">
            <line x1="18" y1="6" x2="6" y2="18" />
            <line x1="6" y1="6" x2="18" y2="18" />
          </svg>
          <span className="sr-only">Close</span>
        </button>
      </div>
    </dialog>,
    document.body
  );
}

export function DialogHeader({ className, children }: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div className={cn("flex flex-col space-y-1.5 text-center sm:text-left mb-4", className)}>
      {children}
    </div>
  );
}

export function DialogFooter({ className, children }: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div className={cn("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2 mt-6", className)}>
      {children}
    </div>
  );
}

export function DialogTitle({ className, children }: React.HTMLAttributes<HTMLHeadingElement>) {
  return (
    <Heading as="h2" className={cn("text-lg font-semibold leading-none tracking-tight", className)}>
      {children}
    </Heading>
  );
}

export function DialogDescription({ className, children }: React.HTMLAttributes<HTMLParagraphElement>) {
  return (
    <p className={cn("text-sm text-gray-500 dark:text-gray-400", className)}>
      {children}
    </p>
  );
}



=== FILE: packages\ui\src\components\overlay\Drawer.tsx ===

import React, { useEffect, useState, useRef } from 'react';
import { createPortal } from 'react-dom';
import { cn } from '../../utils/cn';
import { Heading } from '../typography/Heading';
import { Text } from '../typography/Text';

export interface DrawerProps {
  isOpen: boolean;
  onClose: () => void;
  position?: 'left' | 'right' | 'bottom';
  children: React.ReactNode;
  className?: string;
}

export function Drawer({ 
  isOpen, 
  onClose, 
  position = 'right', 
  children, 
  className 
}: DrawerProps) {
  const [isVisible, setIsVisible] = useState(false);
  const [shouldRender, setShouldRender] = useState(false);
  const overlayRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    if (isOpen) {
      setShouldRender(true);
      // Small delay to allow render before animating in
      requestAnimationFrame(() => {
        requestAnimationFrame(() => {
          setIsVisible(true);
        });
      });
      document.body.style.overflow = 'hidden';
    } else {
      setIsVisible(false);
      const timer = setTimeout(() => {
        setShouldRender(false);
        document.body.style.overflow = 'unset';
      }, 300); // Match transition duration
      return () => clearTimeout(timer);
    }
  }, [isOpen]);

  useEffect(() => {
    const handleEscape = (e: KeyboardEvent) => {
      if (e.key === 'Escape') onClose();
    };

    if (isOpen) {
      document.addEventListener('keydown', handleEscape);
    }

    return () => {
      document.removeEventListener('keydown', handleEscape);
    };
  }, [isOpen, onClose]);

  const handleBackdropClick = (e: React.MouseEvent) => {
    if (e.target === overlayRef.current) {
      onClose();
    }
  };

  if (!shouldRender) return null;

  const positionClasses = {
    left: "left-0 h-full w-3/4 max-w-sm border-r",
    right: "right-0 h-full w-3/4 max-w-sm border-l",
    bottom: "bottom-0 w-full h-auto max-h-[90vh] border-t rounded-t-2xl",
  };

  const translateClasses = {
    left: isVisible ? "translate-x-0" : "-translate-x-full",
    right: isVisible ? "translate-x-0" : "translate-x-full",
    bottom: isVisible ? "translate-y-0" : "translate-y-full",
  };

  return createPortal(
    <div
      ref={overlayRef}
      onClick={handleBackdropClick}
      className={cn(
        "fixed inset-0 z-50 flex bg-black/60 backdrop-blur-sm transition-opacity duration-300",
        isVisible ? "opacity-100" : "opacity-0"
      )}
      role="dialog"
      aria-modal="true"
    >
      <div
        className={cn(
          "absolute bg-white dark:bg-[#0A0A0A] border-gray-200 dark:border-white/10 p-6 shadow-2xl transition-transform duration-300 ease-in-out",
          positionClasses[position],
          translateClasses[position],
          className
        )}
      >
        {children}
      </div>
    </div>,
    document.body
  );
}

export function DrawerHeader({ className, children, ...props }: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div className={cn("flex flex-col space-y-1.5 text-center sm:text-left mb-6", className)} {...props}>
      {children}
    </div>
  );
}

export function DrawerFooter({ className, children, ...props }: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div className={cn("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2 mt-auto pt-6", className)} {...props}>
      {children}
    </div>
  );
}

export function DrawerTitle({ className, children, ...props }: React.HTMLAttributes<HTMLHeadingElement>) {
  return (
    <Heading as="h2" className={cn("text-lg font-semibold leading-none tracking-tight", className)} {...props}>
      {children}
    </Heading>
  );
}

export function DrawerDescription({ className, children, ...props }: React.HTMLAttributes<HTMLParagraphElement>) {
  return (
    <Text variant="muted" className={cn("text-sm", className)} {...props}>
      {children}
    </Text>
  );
}



=== FILE: packages\ui\src\components\overlay\DropdownMenu.tsx ===

import React, { createContext, useContext, useState, useRef, useEffect, useLayoutEffect } from 'react';
import { createPortal } from 'react-dom';
import { cn } from '../../utils/cn';import { useFloating } from '../../hooks/useFloating';
interface DropdownMenuContextValue {
  isOpen: boolean;
  setIsOpen: (isOpen: boolean) => void;
  triggerRef: React.RefObject<HTMLElement>;
}

const DropdownMenuContext = createContext<DropdownMenuContextValue | undefined>(undefined);

export interface DropdownMenuProps {
  children: React.ReactNode;
}

export function DropdownMenu({ children }: DropdownMenuProps) {
  const [isOpen, setIsOpen] = useState(false);
  const triggerRef = useRef<HTMLElement>(null);

  return (
    <DropdownMenuContext.Provider value={{ isOpen, setIsOpen, triggerRef }}>
      <div className="relative inline-block text-left">
        {children}
      </div>
    </DropdownMenuContext.Provider>
  );
}

export interface DropdownMenuTriggerProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  children: React.ReactNode;
}

export function DropdownMenuTrigger({ className, children, ...props }: DropdownMenuTriggerProps) {
  const context = useContext(DropdownMenuContext);
  if (!context) throw new Error('DropdownMenuTrigger must be used within DropdownMenu');

  const handleClick = (e: React.MouseEvent) => {
    context.setIsOpen(!context.isOpen);
    props.onClick?.(e as any);
  };

  return (
    <button
      ref={context.triggerRef as any}
      type="button"
      aria-haspopup="menu"
      aria-expanded={context.isOpen}
      onClick={handleClick}
      className={cn("inline-flex items-center justify-center", className)}
      {...props}
    >
      {children}
    </button>
  );
}

export interface DropdownMenuContentProps extends React.HTMLAttributes<HTMLDivElement> {
  children: React.ReactNode;
  align?: 'start' | 'end' | 'center';
  side?: 'top' | 'bottom' | 'left' | 'right';
}

export function DropdownMenuContent({ className, children, align = 'start', side = 'bottom', ...props }: DropdownMenuContentProps) {
  const context = useContext(DropdownMenuContext);
  if (!context) throw new Error('DropdownMenuContent must be used within DropdownMenu');

  const contentRef = useRef<HTMLDivElement>(null);
  const { position, isPositioned } = useFloating(context.triggerRef, contentRef, {
    side,
    align,
    isOpen: context.isOpen,
  });

  useEffect(() => {
    if (context.isOpen) {
      const handleOutsideClick = (e: MouseEvent) => {
        if (
          contentRef.current &&
          !contentRef.current.contains(e.target as Node) &&
          context.triggerRef.current &&
          !context.triggerRef.current.contains(e.target as Node)
        ) {
          context.setIsOpen(false);
        }
      };

      const handleKeyDown = (e: KeyboardEvent) => {
        if (e.key === 'Escape') {
          context.setIsOpen(false);
          context.triggerRef.current?.focus();
        }
        
        if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
          e.preventDefault();
          const items = contentRef.current?.querySelectorAll('[role="menuitem"]') as NodeListOf<HTMLElement>;
          if (!items.length) return;
          
          const currentIndex = Array.from(items).indexOf(document.activeElement as HTMLElement);
          let nextIndex = 0;
          
          if (e.key === 'ArrowDown') {
            nextIndex = (currentIndex + 1) % items.length;
          } else {
            nextIndex = (currentIndex - 1 + items.length) % items.length;
          }
          
          items[nextIndex]?.focus();
        }
      };

      document.addEventListener('mousedown', handleOutsideClick);
      document.addEventListener('keydown', handleKeyDown);
      return () => {
        document.removeEventListener('mousedown', handleOutsideClick);
        document.removeEventListener('keydown', handleKeyDown);
      };
    }
  }, [context.isOpen, context.setIsOpen, context.triggerRef]);

  if (!context.isOpen) return null;

  const getTransformOrigin = () => {
    if (side === 'bottom') {
      if (align === 'start') return 'top left';
      if (align === 'end') return 'top right';
      return 'top center';
    }
    if (side === 'top') {
      if (align === 'start') return 'bottom left';
      if (align === 'end') return 'bottom right';
      return 'bottom center';
    }
    if (side === 'left') {
      if (align === 'start') return 'top right';
      if (align === 'end') return 'bottom right';
      return 'center right';
    }
    if (side === 'right') {
      if (align === 'start') return 'top left';
      if (align === 'end') return 'bottom left';
      return 'center left';
    }
    return 'center center';
  };

  return createPortal(
    <div
      ref={contentRef}
      role="menu"
      aria-orientation="vertical"
      style={{ 
        top: position.top, 
        left: position.left,
        transformOrigin: getTransformOrigin(),
      }}
      className={cn(
        "fixed z-50 min-w-[8rem] overflow-hidden rounded-2xl border border-gray-200 dark:border-white/10 bg-white/80 dark:bg-white/[0.03] backdrop-blur-xl p-1 shadow-md duration-100",
        isPositioned ? "animate-in fade-in zoom-in-95 opacity-100" : "opacity-0",
        className
      )}
      {...props}
    >
      {children}
    </div>,
    document.body
  );
}

export interface DropdownMenuItemProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  children: React.ReactNode;
}

export function DropdownMenuItem({ className, children, ...props }: DropdownMenuItemProps) {
  const context = useContext(DropdownMenuContext);
  
  const handleClick = (e: React.MouseEvent) => {
    context?.setIsOpen(false);
    props.onClick?.(e as any);
  };

  return (
    <button
      type="button"
      role="menuitem"
      onClick={handleClick}
      className={cn(
        "relative flex w-full cursor-pointer select-none items-center rounded-xl px-3 py-2 text-sm outline-none transition-colors",
        "text-gray-700 dark:text-white/80",
        "hover:bg-gray-100 hover:text-gray-900 dark:hover:bg-white/10 dark:hover:text-white",
        "focus:bg-gray-100 focus:text-gray-900 dark:focus:bg-white/10 dark:focus:text-white",
        "data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
        className
      )}
      {...props}
    >
      {children}
    </button>
  );
}

export function DropdownMenuLabel({ className, children, ...props }: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div className={cn("px-2 py-1.5 text-sm font-semibold text-gray-900 dark:text-white", className)} {...props}>
      {children}
    </div>
  );
}

export function DropdownMenuSeparator({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div className={cn("-mx-1 my-1 h-px bg-gray-200 dark:bg-white/10", className)} {...props} />
  );
}



=== FILE: packages\ui\src\components\overlay\Modal.tsx ===

import React, { useEffect, useRef } from 'react';
import { createPortal } from 'react-dom';
import { cn } from '../../utils/cn';
import { Heading } from '../typography/Heading';
import { Text } from '../typography/Text';

export interface ModalProps {
  isOpen: boolean;
  onClose: () => void;
  children: React.ReactNode;
  className?: string;
}

export function Modal({ isOpen, onClose, children, className }: ModalProps) {
  const overlayRef = useRef<HTMLDivElement>(null);
  const contentRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    const handleEscape = (e: KeyboardEvent) => {
      if (e.key === 'Escape') onClose();
    };

    if (isOpen) {
      document.addEventListener('keydown', handleEscape);
      document.body.style.overflow = 'hidden';
    }

    return () => {
      document.removeEventListener('keydown', handleEscape);
      document.body.style.overflow = 'unset';
    };
  }, [isOpen, onClose]);

  const handleBackdropClick = (e: React.MouseEvent) => {
    if (e.target === overlayRef.current) {
      onClose();
    }
  };

  if (!isOpen) return null;

  return createPortal(
    <div
      ref={overlayRef}
      onClick={handleBackdropClick}
      className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in duration-200"
      role="dialog"
      aria-modal="true"
    >
      <div
        ref={contentRef}
        className={cn(
          "relative w-full max-w-lg scale-100 gap-4 border border-gray-200 dark:border-white/10 bg-white dark:bg-[#0A0A0A]/90 p-6 shadow-2xl backdrop-blur-xl transition-all sm:rounded-2xl",
          "animate-in fade-in zoom-in-95 duration-200 slide-in-from-bottom-2",
          className
        )}
      >
        {children}
        <button
          onClick={onClose}
          className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-gray-400 dark:focus:ring-white/20 disabled:pointer-events-none"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-gray-900 dark:text-white">
            <line x1="18" y1="6" x2="6" y2="18" />
            <line x1="6" y1="6" x2="18" y2="18" />
          </svg>
          <span className="sr-only">Close</span>
        </button>
      </div>
    </div>,
    document.body
  );
}

export function ModalHeader({ className, children }: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div className={cn("flex flex-col space-y-1.5 text-center sm:text-left mb-4", className)}>
      {children}
    </div>
  );
}

export function ModalFooter({ className, children }: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div className={cn("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2 mt-6", className)}>
      {children}
    </div>
  );
}

export function ModalTitle({ className, children }: React.HTMLAttributes<HTMLHeadingElement>) {
  return (
    <Heading as="h2" className={cn("text-lg font-semibold leading-none tracking-tight", className)}>
      {children}
    </Heading>
  );
}

export function ModalDescription({ className, children }: React.HTMLAttributes<HTMLParagraphElement>) {
  return (
    <Text variant="muted" className={cn("text-sm", className)}>
      {children}
    </Text>
  );
}



=== FILE: packages\ui\src\components\overlay\Popover.tsx ===

import React, { createContext, useContext, useState, useRef, useEffect, useLayoutEffect } from 'react';
import { createPortal } from 'react-dom';
import { cn } from '../../utils/cn';
import { useFloating } from '../../hooks/useFloating';

interface PopoverContextValue {
  isOpen: boolean;
  setIsOpen: (isOpen: boolean) => void;
  triggerRef: React.RefObject<HTMLElement>;
}

const PopoverContext = createContext<PopoverContextValue | undefined>(undefined);

export interface PopoverProps {
  children: React.ReactNode;
  open?: boolean;
  onOpenChange?: (open: boolean) => void;
}

export function Popover({ children, open, onOpenChange }: PopoverProps) {
  const [internalOpen, setInternalOpen] = useState(false);
  const triggerRef = useRef<HTMLElement>(null);

  const isControlled = open !== undefined;
  const isOpen = isControlled ? open : internalOpen;
  const setIsOpen = (newOpen: boolean) => {
    if (!isControlled) {
      setInternalOpen(newOpen);
    }
    onOpenChange?.(newOpen);
  };

  return (
    <PopoverContext.Provider value={{ isOpen, setIsOpen, triggerRef }}>
      <div className="relative inline-block">
        {children}
      </div>
    </PopoverContext.Provider>
  );
}

export interface PopoverTriggerProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  children: React.ReactNode;
}

export function PopoverTrigger({ className, children, ...props }: PopoverTriggerProps) {
  const context = useContext(PopoverContext);
  if (!context) throw new Error('PopoverTrigger must be used within Popover');

  const handleClick = (e: React.MouseEvent) => {
    context.setIsOpen(!context.isOpen);
    props.onClick?.(e as any);
  };

  return (
    <button
      ref={context.triggerRef as any}
      type="button"
      aria-haspopup="dialog"
      aria-expanded={context.isOpen}
      onClick={handleClick}
      className={cn("inline-flex items-center justify-center", className)}
      {...props}
    >
      {children}
    </button>
  );
}

export interface PopoverContentProps extends React.HTMLAttributes<HTMLDivElement> {
  children: React.ReactNode;
  align?: 'start' | 'end' | 'center';
  sideOffset?: number;
}

export function PopoverContent({ className, children, align = 'center', sideOffset = 4, ...props }: PopoverContentProps) {
  const context = useContext(PopoverContext);
  if (!context) throw new Error('PopoverContent must be used within Popover');

  const contentRef = useRef<HTMLDivElement>(null);
  const { position, isPositioned } = useFloating(context.triggerRef, contentRef, {
    side: 'bottom',
    align,
    sideOffset,
    isOpen: context.isOpen,
  });

  useEffect(() => {
    if (context.isOpen) {
      const handleOutsideClick = (e: MouseEvent) => {
        if (
          contentRef.current &&
          !contentRef.current.contains(e.target as Node) &&
          context.triggerRef.current &&
          !context.triggerRef.current.contains(e.target as Node)
        ) {
          context.setIsOpen(false);
        }
      };

      document.addEventListener('mousedown', handleOutsideClick);
      return () => {
        document.removeEventListener('mousedown', handleOutsideClick);
      };
    }
  }, [context.isOpen, context.setIsOpen, context.triggerRef]);

  if (!context.isOpen) return null;

  const getTransformOrigin = () => {
    // Popover currently only supports top/bottom in its logic, but let's make it robust
    const side = position.top > (context.triggerRef.current?.getBoundingClientRect().top || 0) ? 'bottom' : 'top';
    
    if (side === 'bottom') {
      if (align === 'start') return 'top left';
      if (align === 'end') return 'top right';
      return 'top center';
    }
    if (side === 'top') {
      if (align === 'start') return 'bottom left';
      if (align === 'end') return 'bottom right';
      return 'bottom center';
    }
    return 'center center';
  };

  return createPortal(
    <div
      ref={contentRef}
      style={{ 
        top: position.top, 
        left: position.left,
        transformOrigin: getTransformOrigin(),
      }}
      className={cn(
        "fixed z-50 min-w-[12rem] rounded-2xl border border-gray-200 dark:border-white/10 bg-white/80 dark:bg-white/[0.03] backdrop-blur-xl p-4 shadow-xl outline-none duration-200",
        isPositioned ? "animate-in fade-in zoom-in-95 opacity-100" : "opacity-0",
        className
      )}
      {...props}
    >
      {children}
    </div>,
    document.body
  );
}



=== FILE: packages\ui\src\components\overlay\Tooltip.tsx ===

import React, { useState, useRef, useEffect } from 'react';
import { createPortal } from 'react-dom';
import { cn } from '../../utils/cn';
import { useFloating } from '../../hooks/useFloating';

export type TooltipPosition = 'top' | 'bottom' | 'left' | 'right';

export interface TooltipProps {
  content: React.ReactNode;
  children: React.ReactNode;
  position?: TooltipPosition;
  delay?: number;
  className?: string;
}

export function Tooltip({ 
  content, 
  children, 
  position = 'top', 
  delay = 200,
  className 
}: TooltipProps) {
  const [isVisible, setIsVisible] = useState(false);
  const timeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);
  const triggerRef = useRef<HTMLDivElement>(null);
  const contentRef = useRef<HTMLDivElement>(null);

  const { position: floatingPosition, isPositioned } = useFloating(triggerRef, contentRef, {
    side: position,
    align: 'center',
    sideOffset: 8,
    isOpen: isVisible,
  });

  const showTooltip = () => {
    if (timeoutRef.current) clearTimeout(timeoutRef.current);
    timeoutRef.current = setTimeout(() => setIsVisible(true), delay);
  };

  const hideTooltip = () => {
    if (timeoutRef.current) clearTimeout(timeoutRef.current);
    setIsVisible(false);
  };

  useEffect(() => {
    return () => {
      if (timeoutRef.current) clearTimeout(timeoutRef.current);
    };
  }, []);

  const animationClasses = {
    top: 'slide-in-from-bottom-2',
    bottom: 'slide-in-from-top-2',
    left: 'slide-in-from-right-2',
    right: 'slide-in-from-left-2',
  };

  return (
    <div 
      ref={triggerRef}
      className="relative inline-flex" 
      onMouseEnter={showTooltip} 
      onMouseLeave={hideTooltip}
      onFocus={showTooltip}
      onBlur={hideTooltip}
    >
      {children}
      {isVisible && createPortal(
        <div
          ref={contentRef}
          role="tooltip"
          style={{
            top: floatingPosition.top,
            left: floatingPosition.left,
          }}
          className={cn(
            "fixed z-[100] min-w-max max-w-xs rounded-xl border border-gray-200 dark:border-white/10 bg-white dark:bg-[#0A0A0A]/90 px-3 py-1.5 text-xs text-gray-900 dark:text-white shadow-xl backdrop-blur-md",
            "duration-200",
            isPositioned ? "animate-in fade-in opacity-100" : "opacity-0",
            animationClasses[position],
            className
          )}
        >
          {content}
        </div>,
        document.body
      )}
    </div>
  );
}



=== FILE: packages\ui\src\components\theme\ThemeProvider.tsx ===

import React, { createContext, useContext, useEffect, useState } from "react"

type Theme = "dark" | "light" | "system"

type ThemeProviderProps = {
  children: React.ReactNode
  defaultTheme?: Theme
  storageKey?: string
}

type ThemeProviderState = {
  theme: Theme
  setTheme: (theme: Theme) => void
}

const initialState: ThemeProviderState = {
  theme: "system",
  setTheme: () => null,
}

const ThemeProviderContext = createContext<ThemeProviderState>(initialState)

export function ThemeProvider({
  children,
  defaultTheme = "system",
  storageKey = "pixonui-ui-theme",
  ...props
}: ThemeProviderProps) {
  const [theme, setTheme] = useState<Theme>(
    () => (localStorage.getItem(storageKey) as Theme) || defaultTheme
  )

  useEffect(() => {
    const root = window.document.documentElement

    root.classList.remove("light", "dark")

    if (theme === "system") {
      const systemTheme = window.matchMedia("(prefers-color-scheme: dark)")
        .matches
        ? "dark"
        : "light"

      root.classList.add(systemTheme)
      return
    }

    root.classList.add(theme)
  }, [theme])

  const value = {
    theme,
    setTheme: (theme: Theme) => {
      localStorage.setItem(storageKey, theme)
      setTheme(theme)
    },
  }

  return (
    <ThemeProviderContext.Provider {...props} value={value}>
      {children}
    </ThemeProviderContext.Provider>
  )
}

export const useTheme = () => {
  const context = useContext(ThemeProviderContext)

  if (context === undefined)
    throw new Error("useTheme must be used within a ThemeProvider")

  return context
}



=== FILE: packages\ui\src\components\theme\ThemeToggle.tsx ===

import React from "react"
import { Moon, Sun } from "lucide-react"
import { Button } from "../button/Button"
import { useTheme } from "./ThemeProvider"

export function ThemeToggle() {
  const { setTheme, theme } = useTheme()

  return (
    <Button
      variant="ghost"
      size="icon"
      onClick={() => setTheme(theme === "light" ? "dark" : "light")}
      className="relative"
    >
      <Sun className="h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0 text-gray-900 dark:text-white" />
      <Moon className="absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100 text-gray-900 dark:text-white" />
      <span className="sr-only">Toggle theme</span>
    </Button>
  )
}



=== FILE: packages\ui\src\components\typography\Heading.tsx ===

import React from 'react';
import { cn } from '../../utils/cn';

interface HeadingProps extends React.HTMLAttributes<HTMLHeadingElement> {
  as?: 'h1' | 'h2' | 'h3' | 'h4' | 'h5' | 'h6';
  children: React.ReactNode;
}

export const Heading = React.forwardRef<HTMLHeadingElement, HeadingProps>(
  ({ as: Component = 'h2', className, children, ...props }, ref) => {
    return (
      <Component
        ref={ref}
        className={cn(
          'font-bold tracking-tight text-gray-900 dark:text-white',
          {
            'text-4xl': Component === 'h1',
            'text-3xl': Component === 'h2',
            'text-2xl': Component === 'h3',
            'text-xl': Component === 'h4',
            'text-lg': Component === 'h5',
            'text-base': Component === 'h6',
          },
          className
        )}
        {...props}
      >
        {children}
      </Component>
    );
  }
);

Heading.displayName = 'Heading';



=== FILE: packages\ui\src\components\typography\Text.tsx ===

import React from 'react';
import { cn } from '../../utils/cn';

interface TextProps extends React.HTMLAttributes<HTMLElement> {
  as?: 'p' | 'span' | 'div' | 'label';
  variant?: 'default' | 'muted' | 'subtle';
  size?: 'xs' | 'sm' | 'base' | 'lg';
  children: React.ReactNode;
}

export const Text = React.forwardRef<HTMLElement, TextProps>(
  ({ as: Component = 'p', variant = 'default', size = 'base', className, children, ...props }, ref) => {
    return (
      <Component
        ref={ref as any}
        className={cn(
          'leading-relaxed',
          {
            'text-gray-900 dark:text-white': variant === 'default',
            'text-gray-500 dark:text-white/80': variant === 'muted',
            'text-gray-400 dark:text-white/50': variant === 'subtle',
            'text-xs': size === 'xs',
            'text-sm': size === 'sm',
            'text-base': size === 'base',
            'text-lg': size === 'lg',
          },
          className
        )}
        {...props}
      >
        {children}
      </Component>
    );
  }
);

Text.displayName = 'Text';



=== FILE: packages\ui\src\hooks\useFloating.ts ===

import { useState, useLayoutEffect, useCallback, RefObject } from 'react';

export type Side = 'top' | 'bottom' | 'left' | 'right';
export type Align = 'start' | 'center' | 'end';

interface UseFloatingOptions {
  side?: Side;
  align?: Align;
  sideOffset?: number;
  alignOffset?: number;
  isOpen?: boolean;
}

interface Position {
  top: number;
  left: number;
}

export function useFloating(
  triggerRef: RefObject<HTMLElement>,
  contentRef: RefObject<HTMLElement>,
  options: UseFloatingOptions = {}
) {
  const {
    side = 'bottom',
    align = 'center',
    sideOffset = 4,
    alignOffset = 0,
    isOpen = false,
  } = options;

  const [position, setPosition] = useState<Position>({ top: 0, left: 0 });
  const [isPositioned, setIsPositioned] = useState(false);

  const updatePosition = useCallback(() => {
    if (!triggerRef.current || !contentRef.current || !isOpen) return;

    const triggerRect = triggerRef.current.getBoundingClientRect();
    const contentRect = contentRef.current.getBoundingClientRect();
    
    let top = 0;
    let left = 0;

    // Calculate base position based on side
    switch (side) {
      case 'top':
        top = triggerRect.top - contentRect.height - sideOffset;
        break;
      case 'bottom':
        top = triggerRect.bottom + sideOffset;
        break;
      case 'left':
        left = triggerRect.left - contentRect.width - sideOffset;
        break;
      case 'right':
        left = triggerRect.right + sideOffset;
        break;
    }

    // Calculate alignment
    if (side === 'top' || side === 'bottom') {
      switch (align) {
        case 'start':
          left = triggerRect.left + alignOffset;
          break;
        case 'center':
          left = triggerRect.left + (triggerRect.width / 2) - (contentRect.width / 2) + alignOffset;
          break;
        case 'end':
          left = triggerRect.right - contentRect.width + alignOffset;
          break;
      }
    } else {
      switch (align) {
        case 'start':
          top = triggerRect.top + alignOffset;
          break;
        case 'center':
          top = triggerRect.top + (triggerRect.height / 2) - (contentRect.height / 2) + alignOffset;
          break;
        case 'end':
          top = triggerRect.bottom - contentRect.height + alignOffset;
          break;
      }
    }

    // Boundary checks (simple viewport containment)
    const padding = 8;
    const viewportWidth = window.innerWidth;
    const viewportHeight = window.innerHeight;

    if (left < padding) left = padding;
    if (left + contentRect.width > viewportWidth - padding) {
      left = viewportWidth - contentRect.width - padding;
    }
    if (top < padding) top = padding;
    if (top + contentRect.height > viewportHeight - padding) {
      top = viewportHeight - contentRect.height - padding;
    }

    setPosition({ top, left });
    setIsPositioned(true);
  }, [triggerRef, contentRef, side, align, sideOffset, alignOffset, isOpen]);

  useLayoutEffect(() => {
    if (!isOpen) {
      setIsPositioned(false);
      return;
    }

    updatePosition();

    // Use ResizeObserver for more robust updates
    const resizeObserver = new ResizeObserver(() => updatePosition());
    if (triggerRef.current) resizeObserver.observe(triggerRef.current);
    if (contentRef.current) resizeObserver.observe(contentRef.current);

    window.addEventListener('resize', updatePosition);
    window.addEventListener('scroll', updatePosition, true);

    return () => {
      resizeObserver.disconnect();
      window.removeEventListener('resize', updatePosition);
      window.removeEventListener('scroll', updatePosition, true);
    };
  }, [isOpen, updatePosition, triggerRef, contentRef]);

  return {
    position,
    isPositioned,
    updatePosition,
  };
}



=== FILE: packages\ui\src\hooks\useForm.ts ===

import { useState, useCallback, FormEvent } from 'react';

interface UseFormOptions<T> {
  initialValues: T;
  onSubmit: (values: T) => void | Promise<void>;
}

export function useForm<T extends Record<string, unknown>>({
  initialValues,
  onSubmit,
}: UseFormOptions<T>) {
  const [values, setValues] = useState<T>(initialValues);
  const [errors, setErrors] = useState<Partial<Record<keyof T, string>>>({});
  const [isSubmitting, setIsSubmitting] = useState(false);

  const handleChange = useCallback((
    e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>
  ) => {
    const { name, value, type } = e.target;
    const val = type === 'checkbox' ? (e.target as HTMLInputElement).checked : value;

    setValues((prev) => ({ ...prev, [name]: val }));
    
    // Clear error when user starts typing
    if (errors[name as keyof T]) {
      setErrors((prev) => ({ ...prev, [name]: '' }));
    }
  }, [errors]);

  const handleSubmit = useCallback(async (e: FormEvent<HTMLFormElement>) => {
    e.preventDefault();
    const form = e.currentTarget;
    
    if (!form.checkValidity()) {
      const newErrors: Partial<Record<keyof T, string>> = {};
      Array.from(form.elements).forEach((element) => {
        const input = element as HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement;
        if (input.name && !input.validity.valid) {
          newErrors[input.name as keyof T] = input.validationMessage;
        }
      });
      setErrors(newErrors);
      return;
    }

    setIsSubmitting(true);
    try {
      await onSubmit(values);
    } finally {
      setIsSubmitting(false);
    }
  }, [values, onSubmit]);

  const register = useCallback((name: keyof T) => ({
    name: name as string,
    value: values[name] as string | number | readonly string[] | undefined,
    onChange: handleChange,
    error: errors[name],
  }), [values, errors, handleChange]);

  return {
    values,
    errors,
    isSubmitting,
    handleChange,
    handleSubmit,
    register,
    setValues,
    setErrors,
  };
}



=== FILE: packages\ui\src\hooks\useIntersection.ts ===

import { useState, useEffect, useRef, RefObject } from 'react';

interface UseIntersectionOptions extends IntersectionObserverInit {
  freezeOnceVisible?: boolean;
}

export function useIntersection(
  elementRef: RefObject<Element>,
  {
    threshold = 0,
    root = null,
    rootMargin = '0%',
    freezeOnceVisible = false,
  }: UseIntersectionOptions = {}
): IntersectionObserverEntry | undefined {
  const [entry, setEntry] = useState<IntersectionObserverEntry>();

  const frozen = entry?.isIntersecting && freezeOnceVisible;

  const updateEntry = ([entry]: IntersectionObserverEntry[]): void => {
    setEntry(entry);
  };

  useEffect(() => {
    const node = elementRef?.current;
    const hasIOSupport = !!window.IntersectionObserver;

    if (!hasIOSupport || frozen || !node) return;

    const observerParams = { threshold, root, rootMargin };
    const observer = new IntersectionObserver(updateEntry, observerParams);

    observer.observe(node);

    return () => observer.disconnect();
  }, [elementRef, threshold, root, rootMargin, frozen]);

  return entry;
}



=== FILE: packages\ui\src\hooks\useInView.ts ===

import { useEffect, useState, useRef } from 'react';

export interface UseInViewOptions {
  threshold?: number | number[];
  rootMargin?: string;
  root?: Element | null;
  enabled?: boolean;
}

export function useInView(options: UseInViewOptions = { threshold: 0.1, rootMargin: '0px', enabled: true }) {
  const ref = useRef<HTMLDivElement>(null);
  const [isInView, setIsInView] = useState(false);
  const [hasAnimated, setHasAnimated] = useState(false);
  const { enabled = true } = options;

  useEffect(() => {
    if (!enabled) return;
    
    const element = ref.current;
    if (!element) return;

    const observer = new IntersectionObserver(([entry]) => {
      if (entry && entry.isIntersecting) {
        setIsInView(true);
        setHasAnimated(true);
      } else {
        setIsInView(false);
      }
    }, options);

    observer.observe(element);

    return () => {
      observer.disconnect();
    };
  }, [options.threshold, options.rootMargin, options.root, enabled]);

  return { ref, isInView, hasAnimated };
}



=== FILE: packages\ui\src\hooks\useResponsive.ts ===

import { useState, useEffect, useLayoutEffect, RefObject } from 'react';

export type Breakpoint = 'sm' | 'md' | 'lg' | 'xl' | '2xl';

const breakpoints: Record<Breakpoint, number> = {
  sm: 640,
  md: 768,
  lg: 1024,
  xl: 1280,
  '2xl': 1536,
};

export function useMediaQuery(query: string): boolean {
  const [matches, setMatches] = useState(false);

  useEffect(() => {
    const media = window.matchMedia(query);
    if (media.matches !== matches) {
      setMatches(media.matches);
    }
    const listener = () => setMatches(media.matches);
    media.addEventListener('change', listener);
    return () => media.removeEventListener('change', listener);
  }, [matches, query]);

  return matches;
}

export function useBreakpoint(breakpoint: Breakpoint): boolean {
  return useMediaQuery(`(min-width: ${breakpoints[breakpoint]}px)`);
}

interface ContainerSize {
  width: number;
  height: number;
}

export function useContainerQuery(ref: RefObject<HTMLElement>): ContainerSize {
  const [size, setSize] = useState<ContainerSize>({ width: 0, height: 0 });

  useLayoutEffect(() => {
    if (!ref.current) return;

    const observer = new ResizeObserver((entries) => {
      for (const entry of entries) {
        setSize({
          width: entry.contentRect.width,
          height: entry.contentRect.height,
        });
      }
    });

    observer.observe(ref.current);
    return () => observer.disconnect();
  }, [ref]);

  return size;
}



=== FILE: packages\ui\src\hooks\useScroll.ts ===

import { useState, useEffect, useCallback } from 'react';

export interface ScrollValues {
  scrollX: number;
  scrollY: number;
  scrollProgressX: number;
  scrollProgressY: number;
}

export function useScroll(): ScrollValues {
  const [values, setValues] = useState<ScrollValues>({
    scrollX: 0,
    scrollY: 0,
    scrollProgressX: 0,
    scrollProgressY: 0,
  });

  const handleScroll = useCallback(() => {
    const x = window.scrollX;
    const y = window.scrollY;
    
    const width = document.documentElement.scrollWidth - document.documentElement.clientWidth;
    const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
    
    setValues({
      scrollX: x,
      scrollY: y,
      scrollProgressX: width > 0 ? x / width : 0,
      scrollProgressY: height > 0 ? y / height : 0,
    });
  }, []);

  useEffect(() => {
    window.addEventListener('scroll', handleScroll, { passive: true });
    handleScroll(); // Initial call
    
    return () => window.removeEventListener('scroll', handleScroll);
  }, [handleScroll]);

  return values;
}



=== FILE: packages\ui\src\hooks\useTimer.ts ===

import { useState, useEffect, useCallback, useRef } from 'react';

export function useTimer(initialSeconds: number = 0) {
  const [seconds, setSeconds] = useState(initialSeconds);
  const [isActive, setIsActive] = useState(false);
  const intervalRef = useRef<any>(null);

  const start = useCallback(() => {
    if (!isActive) {
      setIsActive(true);
      intervalRef.current = setInterval(() => {
        setSeconds((prev) => prev + 1);
      }, 1000);
    }
  }, [isActive]);

  const pause = useCallback(() => {
    if (isActive && intervalRef.current) {
      clearInterval(intervalRef.current);
      setIsActive(false);
    }
  }, [isActive]);

  const reset = useCallback(() => {
    if (intervalRef.current) {
      clearInterval(intervalRef.current);
    }
    setIsActive(false);
    setSeconds(0);
  }, []);

  useEffect(() => {
    return () => {
      if (intervalRef.current) {
        clearInterval(intervalRef.current);
      }
    };
  }, []);

  const formatTime = (totalSeconds: number) => {
    const hours = Math.floor(totalSeconds / 3600);
    const minutes = Math.floor((totalSeconds % 3600) / 60);
    const secs = totalSeconds % 60;
    return [hours, minutes, secs]
      .map((v) => (v < 10 ? '0' + v : v))
      .filter((v, i) => v !== '00' || i > 0)
      .join(':');
  };

  return {
    seconds,
    isActive,
    start,
    pause,
    reset,
    formattedTime: formatTime(seconds),
  };
}



=== FILE: packages\ui\src\hooks\useToast.ts ===

import { useContext } from 'react';
import { ToastContext } from '../components/feedback/ToastProvider';

export function useToast() {
  const context = useContext(ToastContext);
  if (!context) {
    throw new Error('useToast must be used within a ToastProvider');
  }
  return context;
}

